<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: utils/distortioncorrector/distortionWidget.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">utils/distortioncorrector/distortionWidget.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="distortionWidget_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;QtGui/QTableWidgetItem&gt;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;<a class="code" href="log_8h.html" title="This class will be used for logging.">log.h</a>&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="rgb24Buffer_8h.html" title="a header for GRGB24buffer.cpp">rgb24Buffer.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="straightFunc_8h.html">straightFunc.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;<a class="code" href="curvatureFunc_8h.html">curvatureFunc.h</a>&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="radialFunc_8h.html">radialFunc.h</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;<a class="code" href="camerasCalibrationFunc_8h.html">camerasCalibration/camerasCalibrationFunc.h</a>&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="g12Image_8h.html">g12Image.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="displacementBuffer_8h.html" title="This file hold the class DisplacementBuffer.">displacementBuffer.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="angleFunction_8h.html">angleFunction.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="anglePointsFunction_8h.html">anglePointsFunction.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="distortionWidget_8h.html">distortionWidget.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;ui_distortionWidget.h&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="distPointsFunction_8h.html">distPointsFunction.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="keyword">using</span> <a class="code" href="classcorecvs_1_1DistPointsFunction.html" title="This class describes the cost function that shows how a set of lines differ from the model...">corecvs::DistPointsFunction</a>;
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">00022</a> <span class="keyword">typedef</span> QPair&lt;Vector3dd, Vector2dd&gt; <a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">Points</a>;
<a name="l00023"></a><a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">00023</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a> = 0.0005;
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="classDistortionWidget.html#a7148efd44fa4c805f0d42fec375a7870">00025</a> <a class="code" href="classDistortionWidget.html#a7148efd44fa4c805f0d42fec375a7870">DistortionWidget::DistortionWidget</a>(QWidget *parent) :
<a name="l00026"></a>00026       QWidget(parent)
<a name="l00027"></a>00027     , mBufferInput(NULL)
<a name="l00028"></a>00028     , mBufferWithCorners(NULL)
<a name="l00029"></a>00029     , mDistortionParameters(NULL)
<a name="l00030"></a>00030     , mDistortionCorrectTransform(NULL)
<a name="l00031"></a>00031     , mResult(NULL)
<a name="l00032"></a>00032     , mUi(new Ui::<a class="code" href="classDistortionWidget.html">DistortionWidget</a>)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;setupUi(<span class="keyword">this</span>);
<a name="l00035"></a>00035     this-&gt;setWindowTitle(<span class="stringliteral">&quot;Distortion correction&quot;</span>);
<a name="l00036"></a>00036     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageXSpinBox-&gt;setMaximum(2000);
<a name="l00037"></a>00037     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageYSpinBox-&gt;setMaximum(2000);
<a name="l00038"></a>00038     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;xCoordSpinBox-&gt;setMaximum(2000);
<a name="l00039"></a>00039     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;yCoordSpinBox-&gt;setMaximum(2000);
<a name="l00040"></a>00040     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;zCoordSpinBox-&gt;setMaximum(2000);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget, SIGNAL(newPolygonPointSelected(<span class="keywordtype">int</span>,QPointF)), <span class="keyword">this</span>, SLOT(tryAddPointToPolygon(<span class="keywordtype">int</span>,QPointF)));
<a name="l00043"></a>00043     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget, SIGNAL(newPointFSelected(<span class="keywordtype">int</span>, QPointF)), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a987ab5001cdd1bd31591b453f5308a32">tryAddPoint</a>(<span class="keywordtype">int</span>, QPointF)));
<a name="l00044"></a>00044     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget, SIGNAL(existedPointSelected(<span class="keywordtype">int</span>, QPointF)), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a58deb6480e2af09b12b5faae9c258676">initExistingPoint</a>(<span class="keywordtype">int</span>,QPointF)));
<a name="l00045"></a>00045     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget, SIGNAL(<a class="code" href="classDistortionWidget.html#a7977583220451f123886327a5b24d930">editPoint</a>(QPointF, QPointF)), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a7977583220451f123886327a5b24d930">editPoint</a>(QPointF,QPointF)));
<a name="l00046"></a>00046 
<a name="l00047"></a>00047     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget, SIGNAL(cellDoubleClicked(<span class="keywordtype">int</span>,<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a9788089954e930460b2b84f4021641be">choosePoint</a>(<span class="keywordtype">int</span>,<span class="keywordtype">int</span>)));
<a name="l00048"></a>00048     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;recalculateButton,      SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#abc0b1c06bd5aff2d12de71bec8e28558">initTransform</a>()));
<a name="l00049"></a>00049     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;resetButton,            SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a2555c0af89ba468f08bdc1996acd4779">resetParameters</a>()));
<a name="l00050"></a>00050     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;setParamsButton,        SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a81bfb1c7be110f2f88a9e5afa675f59c">setParams</a>()));
<a name="l00051"></a>00051     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;saveButton,             SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a5d7c0943e9e96416516e2940717730a4">addVector</a>()));
<a name="l00052"></a>00052     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;cornerDetectorButton,   SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a8f45fe404d6d77b574f7f2e94fdbb04e" title="Distortion reconstruction with 3D template.">detectCorners</a>()));
<a name="l00053"></a>00053     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;updateScoreButton,      SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a1f91c72ac0fb5b47dc766f8f850c8bd9">updateScore</a>()));
<a name="l00054"></a>00054     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;deleteButton,           SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a6796887461341fbd45081f0bcea3519b">deletePointPair</a>()));
<a name="l00055"></a>00055     <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a> = <span class="keyword">new</span> <a class="code" href="classDistortionParameters.html">DistortionParameters</a>();
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">/* Additional subwidgets */</span>
<a name="l00058"></a>00058     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;graphButton, SIGNAL(released()), &amp;<a class="code" href="classDistortionWidget.html#a1cb8aceee93b2f34804de153ecdb2186">mGraphDialog</a>, SLOT(show()));
<a name="l00059"></a>00059     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;levelGraphButton, SIGNAL(released()), &amp;<a class="code" href="classDistortionWidget.html#a364dbb9776b0ae2e9a1a596716043ded">mLevelGraphDialog</a>, SLOT(show()));
<a name="l00060"></a>00060 
<a name="l00061"></a>00061     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;addPowerButton, SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#acd0a6baf382ed08a2e57de62b82bb5ce">addPower</a>()));
<a name="l00062"></a>00062     connect(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;delPowerButton, SIGNAL(released()), <span class="keyword">this</span>, SLOT(<a class="code" href="classDistortionWidget.html#a463f43ca659f3be87b5e8272595b2a9f">delPower</a>()));
<a name="l00063"></a>00063 
<a name="l00064"></a>00064     <a class="code" href="classDistortionWidget.html#a762c42384a71b91391fb7e010e625719">loadPoints</a>();
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="classDistortionWidget.html#a2555c0af89ba468f08bdc1996acd4779">00067</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a2555c0af89ba468f08bdc1996acd4779">DistortionWidget::resetParameters</a>()
<a name="l00068"></a>00068 {
<a name="l00069"></a>00069     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;bufferSelectorBox-&gt;setCurrentIndex(0);
<a name="l00070"></a>00070     <a class="code" href="classDistortionWidget.html#a0982e5f3f97f2981bc05f8c647a4d160">clearParameters</a>();
<a name="l00071"></a>00071     <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(
<a name="l00072"></a>00072             <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>)
<a name="l00073"></a>00073     );
<a name="l00074"></a>00074     emit <a class="code" href="classDistortionWidget.html#abebe67bd53d81c2e3cf555eb26b31c6a">recalculationFinished</a>(<a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>);
<a name="l00075"></a>00075 }
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="classDistortionWidget.html#a5cac093df25894d1c3c0abd71aba2f49">00077</a> <a class="code" href="classDistortionWidget.html#a5cac093df25894d1c3c0abd71aba2f49">DistortionWidget::~DistortionWidget</a>()
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079     <a class="code" href="classDistortionWidget.html#aaf0d0497e8456730e85fd213731efd75" title="Saving/loading state.">savePoints</a>();
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>.clear();
<a name="l00082"></a>00082     delete_safe(<a class="code" href="classDistortionWidget.html#a7aea0d80bb82595b1bf094f2e3abde9d">mResult</a>);
<a name="l00083"></a>00083     delete_safe(<a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>);
<a name="l00084"></a>00084     delete_safe(<a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a>);
<a name="l00085"></a>00085     delete_safe(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>);
<a name="l00086"></a>00086     delete_safe(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>);
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="classDistortionWidget.html#a81bfb1c7be110f2f88a9e5afa675f59c">00089</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a81bfb1c7be110f2f88a9e5afa675f59c">DistortionWidget::setParams</a>()
<a name="l00090"></a>00090 {
<a name="l00091"></a>00091     <span class="keyword">delete</span> <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>;
<a name="l00092"></a>00092     <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a> = <span class="keyword">new</span> <a class="code" href="classDistortionParameters.html">DistortionParameters</a>(
<a name="l00093"></a>00093             <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;radiusSpinBox-&gt;value(),
<a name="l00094"></a>00094             <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;scaleSpinBox-&gt;value());
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classDistortionWidget.html#abc0b1c06bd5aff2d12de71bec8e28558">00097</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#abc0b1c06bd5aff2d12de71bec8e28558">DistortionWidget::initTransform</a>()
<a name="l00098"></a>00098 {
<a name="l00099"></a>00099     <span class="keywordflow">switch</span> (<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;methodSelectorBox-&gt;currentIndex())
<a name="l00100"></a>00100     {
<a name="l00101"></a>00101     <span class="keywordflow">case</span> 0:
<a name="l00102"></a>00102         <a class="code" href="classDistortionWidget.html#a0b946732bdc012178425b7c80257b8e1">doTransformLM</a>();
<a name="l00103"></a>00103         <span class="keywordflow">break</span>;
<a name="l00104"></a>00104     <span class="keywordflow">case</span> 1:
<a name="l00105"></a>00105         <a class="code" href="classDistortionWidget.html#acc4920eb6035c486c50914f270324921" title="Correction by Maria Osechkina&#39;s algorithm.">doInversionTransform</a>();
<a name="l00106"></a>00106         <span class="keywordflow">break</span>;
<a name="l00107"></a>00107     <span class="keywordflow">case</span> 2:
<a name="l00108"></a>00108         <a class="code" href="classDistortionWidget.html#adac1a0f5ac124afc61c11cc10374b210" title="Correction by algorithm of straight.">doLinesTransform</a>();
<a name="l00109"></a>00109         <span class="keywordflow">break</span>;
<a name="l00110"></a>00110     <span class="keywordflow">case</span> 3:
<a name="l00111"></a>00111         <a class="code" href="classDistortionWidget.html#ab992ca12e76f4269a7aec54c405cde78">doDefaultTransform</a>();
<a name="l00112"></a>00112         <span class="keywordflow">break</span>;
<a name="l00113"></a>00113     <span class="keywordflow">case</span> 4:
<a name="l00114"></a>00114         <a class="code" href="classDistortionWidget.html#ab999e924f68ea2d6e8089ca8f4717c32">doManualTransform</a>();
<a name="l00115"></a>00115         <span class="keywordflow">break</span>;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;bufferSelectorBox-&gt;setCurrentIndex(2);
<a name="l00118"></a>00118     <a class="code" href="classDistortionWidget.html#a96d7805c04ab371285384eda79f0fda7">showBufferChanged</a>();
<a name="l00119"></a>00119     emit <a class="code" href="classDistortionWidget.html#abebe67bd53d81c2e3cf555eb26b31c6a">recalculationFinished</a>(<a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>);
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="classDistortionWidget.html#a0982e5f3f97f2981bc05f8c647a4d160">00122</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a0982e5f3f97f2981bc05f8c647a4d160">DistortionWidget::clearParameters</a>()
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;clear();
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="comment">//    mNewStraight.clear();</span>
<a name="l00127"></a>00127 <span class="comment">//    mStraights.clear();</span>
<a name="l00128"></a>00128     <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.clear();
<a name="l00129"></a>00129     <span class="keywordtype">int</span> row = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;rowCount();
<a name="l00130"></a>00130     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; row; i ++)
<a name="l00131"></a>00131     {
<a name="l00132"></a>00132         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;removeRow(0);
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="keyword">delete</span> <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>;
<a name="l00136"></a>00136     <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a> = <span class="keyword">new</span> <a class="code" href="classDistortionParameters.html">DistortionParameters</a>();
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment"></span>
<a name="l00140"></a>00140 <span class="comment">/**</span>
<a name="l00141"></a>00141 <span class="comment"> *  Distortion reconstruction with 3D template</span>
<a name="l00142"></a>00142 <span class="comment"> **/</span>
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">/**</span>
<a name="l00145"></a>00145 <span class="comment"> *  Using corner detector as a helper</span>
<a name="l00146"></a>00146 <span class="comment"> **/</span>
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="classDistortionWidget.html#a8f45fe404d6d77b574f7f2e94fdbb04e">00148</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a8f45fe404d6d77b574f7f2e94fdbb04e" title="Distortion reconstruction with 3D template.">DistortionWidget::detectCorners</a>()
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150     <span class="keywordflow">if</span>(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a> == NULL) {
<a name="l00151"></a>00151         <span class="keywordflow">return</span>;
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     <a class="code" href="classcorecvs_1_1SpatialGradient.html" title="This class holds the spatial gradient matrix square elements.">SpatialGradient</a> *grad = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1SpatialGradient.html" title="This class holds the spatial gradient matrix square elements.">SpatialGradient</a>(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="keyword">delete</span> <a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a>;
<a name="l00156"></a>00156     <a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a> = grad-&gt;<a class="code" href="classcorecvs_1_1SpatialGradient.html#adcf1483d0b6c36500a5e7d6f8361f316">findCornerPoints</a>(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;lambdaDivisorBox-&gt;value());
<a name="l00157"></a>00157     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;bufferSelectorBox-&gt;setCurrentIndex(1);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <a class="code" href="classcorecvs_1_1CornerSegmentator.html">CornerSegmentator</a> segmentator(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;cornerThresholdBox-&gt;value());
<a name="l00160"></a>00160     <a class="code" href="classDistortionWidget.html#a7aea0d80bb82595b1bf094f2e3abde9d">mResult</a> = segmentator.<a class="code" href="classcorecvs_1_1Segmentator.html#a75082d72fa057adfd0702143e39fc98f">segment</a>&lt;<a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a>&gt;(<a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a>);
<a name="l00161"></a>00161     <span class="keywordflow">foreach</span> (<a class="code" href="classcorecvs_1_1CornerSegment.html">CornerSegment</a> *cornerSegment, *mResult-&gt;segments)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         <a class="code" href="classDistortionWidget.html#abe7f163ecb22928af447159edf53ab5a">addPointPair</a>(<a class="code" href="namespacecorecvs.html#a8c6504d3d8b574bfb908b9fe5a7a3974">Vector3dd</a>(), cornerSegment-&gt;<a class="code" href="classcorecvs_1_1CornerSegment.html#a333f97137ca4902783b34af30ce0e2dd">getMean</a>());
<a name="l00164"></a>00164     }
<a name="l00165"></a>00165     delete_safe(grad);
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 
<a name="l00168"></a><a class="code" href="classDistortionWidget.html#a987ab5001cdd1bd31591b453f5308a32">00168</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a987ab5001cdd1bd31591b453f5308a32">DistortionWidget::tryAddPoint</a>(<span class="keywordtype">int</span> toolID, <span class="keyword">const</span> QPointF &amp;point)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (toolID != 0)
<a name="l00171"></a>00171         <span class="keywordflow">return</span>;
<a name="l00172"></a>00172     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageXSpinBox-&gt;setValue(point.x());
<a name="l00173"></a>00173     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageYSpinBox-&gt;setValue(point.y());
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a><a class="code" href="classDistortionWidget.html#a58deb6480e2af09b12b5faae9c258676">00176</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a58deb6480e2af09b12b5faae9c258676">DistortionWidget::initExistingPoint</a>(<span class="keywordtype">int</span> toolID, <span class="keyword">const</span> QPointF &amp;point)
<a name="l00177"></a>00177 {
<a name="l00178"></a>00178     <span class="keywordflow">if</span> (toolID != 0) {
<a name="l00179"></a>00179         <span class="keywordflow">return</span>;
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;rowCount(); i ++)
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183         QPointF tablePoint(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;item(i, 3)-&gt;text().toDouble(), <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;item(i, 4)-&gt;text().toDouble());
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ((point - tablePoint).manhattanLength() &lt; <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a>)
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             <a class="code" href="classDistortionWidget.html#a9788089954e930460b2b84f4021641be">choosePoint</a>(i, 0);
<a name="l00187"></a>00187             <span class="keywordflow">return</span>;
<a name="l00188"></a>00188         }
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 }
<a name="l00191"></a>00191 
<a name="l00192"></a><a class="code" href="classDistortionWidget.html#ab0bfc379efd826ee371401cb32653b1e">00192</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#ab0bfc379efd826ee371401cb32653b1e">DistortionWidget::setBuffer</a>(<a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a> *buffer)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194     <span class="keywordflow">if</span> (buffer == NULL) {
<a name="l00195"></a>00195         <span class="keywordflow">return</span>;
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     <span class="keyword">delete</span> <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>;
<a name="l00198"></a>00198     <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a> = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a>(buffer);
<a name="l00199"></a>00199     <a class="code" href="classDistortionWidget.html#a96d7805c04ab371285384eda79f0fda7">showBufferChanged</a>();
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="classDistortionWidget.html#a5d7c0943e9e96416516e2940717730a4">00203</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a5d7c0943e9e96416516e2940717730a4">DistortionWidget::addVector</a>()
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205     <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> key(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;xCoordSpinBox-&gt;value(), <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;yCoordSpinBox-&gt;value(), <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;zCoordSpinBox-&gt;value());
<a name="l00206"></a>00206     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> value(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageXSpinBox-&gt;value(), <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageYSpinBox-&gt;value());
<a name="l00207"></a>00207     <a class="code" href="classDistortionWidget.html#abe7f163ecb22928af447159edf53ab5a">addPointPair</a>(key, value);
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="classDistortionWidget.html#a0b946732bdc012178425b7c80257b8e1">00210</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a0b946732bdc012178425b7c80257b8e1">DistortionWidget::doTransformLM</a>()
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2d32</a> center(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;mImage.data()-&gt;width() * 0.5, <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;mImage.data()-&gt;height() * 0.5);
<a name="l00213"></a>00213     vector&lt;double&gt; values;
<a name="l00214"></a>00214     vector&lt;Vector3dd&gt; arguments;
<a name="l00215"></a>00215     <span class="keywordflow">foreach</span> (<a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">Points</a> points, <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>)
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217         values.push_back(points.second.x());
<a name="l00218"></a>00218         values.push_back(points.second.y());
<a name="l00219"></a>00219         arguments.push_back(points.first);
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221     <a class="code" href="classcorecvs_1_1CamerasCalibrationFunc.html">CamerasCalibrationFunc</a> func(&amp;arguments, center);
<a name="l00222"></a>00222     vector&lt;double&gt; bestParams;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordtype">double</span> params[] = {0, 0, 0, 0, -5.09, 11.1, -30.4, 35, 0.12, 0.04, -4.81, 14.6, -11.2, 11.2};
<a name="l00225"></a>00225     vector&lt;double&gt; parameters(params, params + <a class="code" href="global_8h.html#adf7f0f5c34dedd7cc1eca0f7c55a73d2">CORE_COUNT_OF</a>(params));
<a name="l00226"></a>00226     <a class="code" href="classcorecvs_1_1LevenbergMarquardt.html">LevenbergMarquardt</a> LMTransform(10000, 4, 1.2);
<a name="l00227"></a>00227     LMTransform.<a class="code" href="classcorecvs_1_1LevenbergMarquardt.html#a8c7de0abea784407dac957c93d9bdc76">f</a> = &amp;func;
<a name="l00228"></a>00228     func.<a class="code" href="classcorecvs_1_1CamerasCalibrationFunc.html#a3e39e25b1598a2f8221a8dd6cbd19dcc">setIsDistored</a>(<span class="keyword">false</span>);
<a name="l00229"></a>00229     bestParams = LMTransform.<a class="code" href="classcorecvs_1_1LevenbergMarquardt.html#aaf1a9f35927ce33827590ca21895aa34" title="Marquardt-Levenberg algoritim is a fast optimisation algorithm.">fit</a>(parameters,values);
<a name="l00230"></a>00230     func.<a class="code" href="classcorecvs_1_1CamerasCalibrationFunc.html#a3e39e25b1598a2f8221a8dd6cbd19dcc">setIsDistored</a>(<span class="keyword">true</span>);
<a name="l00231"></a>00231     bestParams = LMTransform.<a class="code" href="classcorecvs_1_1LevenbergMarquardt.html#aaf1a9f35927ce33827590ca21895aa34" title="Marquardt-Levenberg algoritim is a fast optimisation algorithm.">fit</a>(bestParams, values);
<a name="l00232"></a>00232     vector&lt;double&gt; polynomKoeff;
<a name="l00233"></a>00233     polynomKoeff.push_back(bestParams.at(0));
<a name="l00234"></a>00234     polynomKoeff.push_back(bestParams.at(1));
<a name="l00235"></a>00235     <a class="code" href="classcorecvs_1_1LensCorrectionParametres.html" title="This structure holds the parameters to correct the image.">LensCorrectionParametres</a> lenCorrectParams(polynomKoeff, bestParams.at(2), bestParams.at(3), center);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <a class="code" href="classcorecvs_1_1RadialCorrection.html">RadialCorrection</a> correction(lenCorrectParams);
<a name="l00238"></a>00238     <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(
<a name="l00239"></a>00239             <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>(&amp;correction, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, <span class="keyword">false</span>)
<a name="l00240"></a>00240     );
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 <span class="comment"></span>
<a name="l00243"></a>00243 <span class="comment">/**</span>
<a name="l00244"></a>00244 <span class="comment"> *   Correction by Maria Osechkina&#39;s algorithm</span>
<a name="l00245"></a>00245 <span class="comment"> **/</span>
<a name="l00246"></a>00246 
<a name="l00247"></a><a class="code" href="classDistortionWidget.html#acc4920eb6035c486c50914f270324921">00247</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#acc4920eb6035c486c50914f270324921" title="Correction by Maria Osechkina&#39;s algorithm.">DistortionWidget::doInversionTransform</a>()
<a name="l00248"></a>00248 {
<a name="l00249"></a>00249     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> centre(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;mImage.data()-&gt;width() * 0.5, <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;mImage.data()-&gt;height() * 0.5);
<a name="l00250"></a>00250     vector&lt;Vector2dd&gt; points = <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>-&gt;<a class="code" href="classDistortionParameters.html#a2cdede0f316211158acbf1049331eb22">getPoints</a>();
<a name="l00251"></a>00251 
<a name="l00252"></a>00252     <a class="code" href="classcorecvs_1_1DistortionCorrectTransform.html">DistortionCorrectTransform</a> *transform = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DistortionCorrectTransform.html">DistortionCorrectTransform</a>(centre);
<a name="l00253"></a>00253     <span class="keywordflow">if</span> (points.size() &lt; 3 || !<a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>-&gt;<a class="code" href="classDistortionParameters.html#ab0d1b0f3633e91b5f35b551658848f66">needCalculateParams</a>())
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255         <span class="keyword">delete</span> transform;
<a name="l00256"></a>00256         transform = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DistortionCorrectTransform.html">DistortionCorrectTransform</a>(
<a name="l00257"></a>00257             centre,
<a name="l00258"></a>00258             <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>-&gt;<a class="code" href="classDistortionParameters.html#a897b81056139d8ae045c12acb96380ed">getRadius</a>(),
<a name="l00259"></a>00259             <a class="code" href="classDistortionWidget.html#a27f745d1c54618dd7bd0b3c7f8eae812">mDistortionParameters</a>-&gt;<a class="code" href="classDistortionParameters.html#aefdd4889879195b0a6137e66b1953347">getScale</a>());
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261     <span class="keywordflow">else</span>
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263         transform-&gt;<a class="code" href="classcorecvs_1_1DistortionCorrectTransform.html#abd621eb01799cb4ccbaac07dcd5e7c43">setRadius</a>(points.at(0), points.at(1), points.at(2));
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(
<a name="l00267"></a>00267             <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>(transform, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>)
<a name="l00268"></a>00268     );
<a name="l00269"></a>00269     delete_safe(transform);
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 <span class="comment"></span>
<a name="l00272"></a>00272 <span class="comment">/**</span>
<a name="l00273"></a>00273 <span class="comment"> *   Correction by algorithm of straight</span>
<a name="l00274"></a>00274 <span class="comment"> **/</span>
<a name="l00275"></a><a class="code" href="classDistortionWidget.html#adac1a0f5ac124afc61c11cc10374b210">00275</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#adac1a0f5ac124afc61c11cc10374b210" title="Correction by algorithm of straight.">DistortionWidget::doLinesTransform</a>()
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277     <span class="keywordtype">double</span> scale = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;lineScaleSpinBox-&gt;value();
<a name="l00278"></a>00278     qDebug() &lt;&lt; <span class="stringliteral">&quot;doLinesTransform: aspectCorrection = &quot;</span>&lt;&lt; scale;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> center(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a> / 2.0, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a> /2.0);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <a class="code" href="classPaintImageWidget.html">PaintImageWidget</a> *editor = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget;
<a name="l00283"></a>00283     vector&lt;vector&lt;Vector2dd&gt; &gt; straights = editor-&gt;<a class="code" href="classPaintImageWidget.html#a422346b5a780cc350796cb6c1cb3d3cb">getPaths</a>();
<a name="l00284"></a>00284     <a class="code" href="log_8h.html#aff28a71db681e4409315ac040e75275f">L_INFO_P</a>(<span class="stringliteral">&quot;Starting distortion calibration on %d lines&quot;</span>, straights.size());
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <a class="code" href="classcorecvs_1_1RadialCorrection.html">RadialCorrection</a> correction(<a class="code" href="align__nonlinear_8h.html#a52770e9002472ac65b3563ecca58455b" title="This structure holds the parameters to correct the image.">LensCorrectionParametres</a>(
<a name="l00287"></a>00287        vector&lt;double&gt;(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;degreeSpinBox-&gt;value()),
<a name="l00288"></a>00288        0.0, 0.0,
<a name="l00289"></a>00289        1.0,
<a name="l00290"></a>00290        center.<a class="code" href="classcorecvs_1_1VectorOperationsBase.html#acfcd4bcc60d1d076b00afcfeba9f9e8b" title="Euclidean distance.">l2Metric</a>(),
<a name="l00291"></a>00291        center
<a name="l00292"></a>00292     ));
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <a class="code" href="classcorecvs_1_1ModelToRadialCorrection.html">ModelToRadialCorrection</a> modelFactory(
<a name="l00295"></a>00295         correction,
<a name="l00296"></a>00296         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;estimateCenterCheckBox-&gt;isChecked(),
<a name="l00297"></a>00297         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;estimateTangentCheckBox-&gt;isChecked(),
<a name="l00298"></a>00298         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;degreeSpinBox-&gt;value()
<a name="l00299"></a>00299     );
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <a class="code" href="classcorecvs_1_1FunctionArgs.html" title="This class is a virtual version of a .">FunctionArgs</a> *costFuntion = NULL;
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;costFunctionComboBox-&gt;currentIndex() == 0) {
<a name="l00303"></a>00303         costFuntion = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1AnglePointsFunction.html" title="This class describes the cost function that shows how a set of lines differ from the model...">AnglePointsFunction</a> (straights, modelFactory);
<a name="l00304"></a>00304         <span class="comment">//straightF.simpleJacobian = mUi-&gt;simpleJacobianCheckBox-&gt;isChecked();</span>
<a name="l00305"></a>00305     } <span class="keywordflow">else</span> {
<a name="l00306"></a>00306         costFuntion = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DistPointsFunction.html" title="This class describes the cost function that shows how a set of lines differ from the model...">DistPointsFunction</a>  (straights, modelFactory);
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <a class="code" href="classcorecvs_1_1LevenbergMarquardt.html">LevenbergMarquardt</a> straightLevMarq(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;iterationsSpinBox-&gt;value(), 2, 1.5);
<a name="l00310"></a>00310     straightLevMarq.<a class="code" href="classcorecvs_1_1LevenbergMarquardt.html#a8c7de0abea784407dac957c93d9bdc76">f</a> = costFuntion;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     <span class="comment">/* First aproximation is zero vector */</span>
<a name="l00313"></a>00313     vector&lt;double&gt; first(costFuntion-&gt;inputs, 0);
<a name="l00314"></a>00314     modelFactory.getModel(correction, &amp;first[0]);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     vector&lt;double&gt; value(costFuntion-&gt;outputs, 0);
<a name="l00317"></a>00317     vector&lt;double&gt; straightParams = straightLevMarq.<a class="code" href="classcorecvs_1_1LevenbergMarquardt.html#aaf1a9f35927ce33827590ca21895aa34" title="Marquardt-Levenberg algoritim is a fast optimisation algorithm.">fit</a>(first, value);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a> = modelFactory.getRadial(&amp;straightParams[0]);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     <a class="code" href="log_8h.html#aff28a71db681e4409315ac040e75275f">L_INFO_P</a>(<span class="stringliteral">&quot;Inverting the distortion buffer&quot;</span>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(DisplacementBuffer::CacheInverse(&amp;<a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>,
<a name="l00324"></a>00324             <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>,
<a name="l00325"></a>00325             0.0,0.0,
<a name="l00326"></a>00326             (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>,
<a name="l00327"></a>00327             0.5, <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;preciseInvertionCheckBox-&gt;isChecked())
<a name="l00328"></a>00328    );
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;isInverseCheckBox-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00331"></a>00331     <a class="code" href="classDistortionWidget.html#ad22920d93b2d23677fc3c5960945eada">updateAdditionalData</a>();
<a name="l00332"></a>00332     <a class="code" href="log_8h.html#aff28a71db681e4409315ac040e75275f">L_INFO_P</a>(<span class="stringliteral">&quot;Ending distortion calibration&quot;</span>);
<a name="l00333"></a>00333     <a class="code" href="classDistortionWidget.html#a1f91c72ac0fb5b47dc766f8f850c8bd9">updateScore</a>();
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="classDistortionWidget.html#a1f91c72ac0fb5b47dc766f8f850c8bd9">00337</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a1f91c72ac0fb5b47dc766f8f850c8bd9">DistortionWidget::updateScore</a>()
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339     <a class="code" href="classPaintImageWidget.html">PaintImageWidget</a> *editor = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget;
<a name="l00340"></a>00340     vector&lt;vector&lt;Vector2dd&gt; &gt; straights = editor-&gt;<a class="code" href="classPaintImageWidget.html#a422346b5a780cc350796cb6c1cb3d3cb">getPaths</a>();
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     <a class="code" href="classcorecvs_1_1ModelToRadialCorrection.html">ModelToRadialCorrection</a> modelFactory(
<a name="l00343"></a>00343         <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>,
<a name="l00344"></a>00344         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;estimateCenterCheckBox-&gt;isChecked(),
<a name="l00345"></a>00345         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;estimateTangentCheckBox-&gt;isChecked(),
<a name="l00346"></a>00346         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;degreeSpinBox-&gt;value()
<a name="l00347"></a>00347     );
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <a class="code" href="classcorecvs_1_1FunctionArgs.html" title="This class is a virtual version of a .">FunctionArgs</a> *costFuntion = NULL;
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;costFunctionComboBox-&gt;currentIndex() == 0) {
<a name="l00351"></a>00351         costFuntion = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1AnglePointsFunction.html" title="This class describes the cost function that shows how a set of lines differ from the model...">AnglePointsFunction</a> (straights, modelFactory);
<a name="l00352"></a>00352            <span class="comment">//straightF.simpleJacobian = mUi-&gt;simpleJacobianCheckBox-&gt;isChecked();</span>
<a name="l00353"></a>00353     } <span class="keywordflow">else</span> {
<a name="l00354"></a>00354         costFuntion = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DistPointsFunction.html" title="This class describes the cost function that shows how a set of lines differ from the model...">DistPointsFunction</a>  (straights, modelFactory);
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     vector&lt;double&gt; modelParameters(costFuntion-&gt;inputs, 0);
<a name="l00358"></a>00358     modelFactory.getModel(<a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>, &amp;modelParameters[0]);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     vector&lt;double&gt; result(costFuntion-&gt;outputs);
<a name="l00361"></a>00361     costFuntion-&gt;operator()(&amp;modelParameters[0], &amp;result[0]);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="keywordtype">double</span> sqSum = 0;
<a name="l00364"></a>00364     <span class="keywordtype">double</span> maxValue = 0.0;
<a name="l00365"></a>00365     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; result.size(); i++) {
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (fabs(result[i]) &gt; maxValue) {
<a name="l00367"></a>00367             maxValue = fabs(result[i]);
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369         sqSum += result[i] * result[i];
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keywordtype">int</span> count = 0;
<a name="l00373"></a>00373     <a class="code" href="classPaintImageWidget.html">PaintImageWidget</a> *canvas = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget;
<a name="l00374"></a>00374     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; (unsigned)canvas-&gt;<a class="code" href="classPaintImageWidget.html#a51a6b31fefd69479f2e281cce4e6e286" title="Pathes.">mPaths</a>.size(); i++)
<a name="l00375"></a>00375     {
<a name="l00376"></a>00376         <a class="code" href="structPaintImageWidget_1_1VertexPath.html">PaintImageWidget::VertexPath</a> &amp;path = canvas-&gt;<a class="code" href="classPaintImageWidget.html#a51a6b31fefd69479f2e281cce4e6e286" title="Pathes.">mPaths</a>[i];
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (path.<a class="code" href="structPaintImageWidget_1_1VertexPath.html#a963f824710e6cf14501ce73de8edddff">vertexes</a>.size() &lt; 3) {
<a name="l00378"></a>00378             <span class="keywordflow">continue</span>;
<a name="l00379"></a>00379         }
<a name="l00380"></a>00380         <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;costFunctionComboBox-&gt;currentIndex() == 0)
<a name="l00381"></a>00381         {
<a name="l00382"></a>00382             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt; path.<a class="code" href="structPaintImageWidget_1_1VertexPath.html#a963f824710e6cf14501ce73de8edddff">vertexes</a>.size() - 1; j++) {
<a name="l00383"></a>00383                 path.<a class="code" href="structPaintImageWidget_1_1VertexPath.html#a963f824710e6cf14501ce73de8edddff">vertexes</a>[j]-&gt;weight = fabs(result[count]) / maxValue;
<a name="l00384"></a>00384                 count++;
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386         } <span class="keywordflow">else</span> {
<a name="l00387"></a>00387             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; path.<a class="code" href="structPaintImageWidget_1_1VertexPath.html#a963f824710e6cf14501ce73de8edddff">vertexes</a>.size(); j++) {
<a name="l00388"></a>00388                 path.<a class="code" href="structPaintImageWidget_1_1VertexPath.html#a963f824710e6cf14501ce73de8edddff">vertexes</a>[j]-&gt;weight = fabs(result[count]) / maxValue;
<a name="l00389"></a>00389                 count++;
<a name="l00390"></a>00390             }
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     canvas-&gt;update();
<a name="l00394"></a>00394 
<a name="l00395"></a>00395     sqSum /= result.size();
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;scoreLabel-&gt;setText(QString::number(sqrt(sqSum)));
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="classDistortionWidget.html#a79577eb6f6044f9a7c6f4b3bfcb83aae">00400</a> QSharedPointer&lt;DisplacementBuffer&gt; <a class="code" href="classDistortionWidget.html#a79577eb6f6044f9a7c6f4b3bfcb83aae">DistortionWidget::distortionCorrectionTransform</a>()
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402     <span class="keywordflow">return</span> <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>;
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="classDistortionWidget.html#a96d7805c04ab371285384eda79f0fda7">00405</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a96d7805c04ab371285384eda79f0fda7">DistortionWidget::showBufferChanged</a>()
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407     <span class="keywordtype">int</span> <span class="keywordtype">id</span> = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;bufferSelectorBox-&gt;currentIndex();
<a name="l00408"></a>00408     <a class="code" href="classG12Image.html">G12Image</a> *image = NULL;
<a name="l00409"></a>00409     <span class="keywordflow">switch</span> (<span class="keywordtype">id</span>)
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411     <span class="keywordflow">case</span> 0:
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a> != NULL)
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414             image = <span class="keyword">new</span> <a class="code" href="classG12Image.html">G12Image</a>(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>);
<a name="l00415"></a>00415             <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;setImage(QSharedPointer&lt;QImage&gt;(image));
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417         <span class="keywordflow">break</span>;
<a name="l00418"></a>00418     <span class="keywordflow">case</span> 1:
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a> != NULL)
<a name="l00420"></a>00420         {
<a name="l00421"></a>00421             image = <span class="keyword">new</span> <a class="code" href="classG12Image.html">G12Image</a>(<a class="code" href="classDistortionWidget.html#a5a607146f02837871f86b997107954eb">mBufferWithCorners</a>);
<a name="l00422"></a>00422             <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;setImage(QSharedPointer&lt;QImage&gt;(image));
<a name="l00423"></a>00423         }
<a name="l00424"></a>00424         <span class="keywordflow">break</span>;
<a name="l00425"></a>00425     <span class="keywordflow">case</span> 2:
<a name="l00426"></a>00426         {
<a name="l00427"></a>00427             <span class="keywordflow">if</span> (<a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> == NULL) {
<a name="l00428"></a>00428                 <span class="keywordflow">break</span>;
<a name="l00429"></a>00429             }
<a name="l00430"></a>00430             <a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a> *buffer = <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractContiniousBuffer.html#a34af819499a45b5dd52fefdbddefe33d" title="This function template is responsible for applying reverse transformation to the abstract buffer...">doReverseDeformationBl</a>&lt;<a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a>, <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>&gt;(
<a name="l00431"></a>00431                         <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>.data(), <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>);
<a name="l00432"></a>00432             image = <span class="keyword">new</span> <a class="code" href="classG12Image.html">G12Image</a>(buffer);
<a name="l00433"></a>00433             QPainter painter(image);
<a name="l00434"></a>00434             vector&lt;vector&lt;Vector2dd&gt; &gt; straights = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;getPaths();
<a name="l00435"></a>00435             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; straights.size(); i++) {
<a name="l00436"></a>00436                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; straights[i].size(); j++) {
<a name="l00437"></a>00437                     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> point = straights[i][j];
<a name="l00438"></a>00438                     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> moved = <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>.<a class="code" href="classcorecvs_1_1RadialCorrection.html#a2f5fa4ae158f8e68bb31a9179d60c8a1">map</a>(point.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>(), point.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>());
<a name="l00439"></a>00439                     painter.setPen(Qt::yellow);
<a name="l00440"></a>00440                     painter.drawLine(moved.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() - 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() - 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() + 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() + 1);
<a name="l00441"></a>00441                     painter.drawLine(moved.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() + 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() - 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() - 1, moved.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() + 1);
<a name="l00442"></a>00442 <span class="comment">//                    cout &lt;&lt; point &lt;&lt; &quot;=&gt;&quot; &lt;&lt; moved &lt;&lt; &quot;\n&quot;;</span>
<a name="l00443"></a>00443                 }
<a name="l00444"></a>00444             }
<a name="l00445"></a>00445             painter.end();
<a name="l00446"></a>00446 
<a name="l00447"></a>00447             <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;setImage(QSharedPointer&lt;QImage&gt;(image));
<a name="l00448"></a>00448             delete_safe(buffer);
<a name="l00449"></a>00449             <span class="keywordflow">break</span>;
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 }
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">/*Seems like a trash*/</span>
<a name="l00455"></a><a class="code" href="classDistortionWidget.html#ac3994ee1565dbdee8d23e08367355774">00455</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#ac3994ee1565dbdee8d23e08367355774">DistortionWidget::printVectorPair</a>(<span class="keyword">const</span> <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> &amp;key, <span class="keyword">const</span> <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> &amp;value)
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457     QTableWidget *table = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget;
<a name="l00458"></a>00458     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;rowCount(); i ++)
<a name="l00459"></a>00459     {
<a name="l00460"></a>00460         <span class="keywordflow">if</span> (table-&gt;item(i, 3)-&gt;text().toDouble() == value.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() &amp;&amp;
<a name="l00461"></a>00461             table-&gt;item(i, 4)-&gt;text().toDouble() == value.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>())
<a name="l00462"></a>00462         {
<a name="l00463"></a>00463             table-&gt;item(i, 0)-&gt;setText(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#aec83d9ad04107cd9c2bb11abf33128c0" title="Helper functions to access elements.">x</a>()));
<a name="l00464"></a>00464             table-&gt;item(i, 1)-&gt;setText(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#a940d88447f20fac800d1fa510c981275">y</a>()));
<a name="l00465"></a>00465             table-&gt;item(i, 2)-&gt;setText(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#a4587f5d4984576c5c4c2d44a4140ce3f">z</a>()));
<a name="l00466"></a>00466             <span class="keywordflow">return</span>;
<a name="l00467"></a>00467         }
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;rowCount(); i ++)
<a name="l00470"></a>00470     {
<a name="l00471"></a>00471         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; table-&gt;columnCount(); j ++)
<a name="l00472"></a>00472             table-&gt;item(i, j)-&gt;setBackgroundColor(Qt::color0);
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474     table-&gt;insertRow(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget-&gt;rowCount());
<a name="l00475"></a>00475     <span class="keywordtype">int</span> row = table-&gt;rowCount() - 1;
<a name="l00476"></a>00476     table-&gt;setItem(row, 0, <span class="keyword">new</span> QTableWidgetItem(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#aec83d9ad04107cd9c2bb11abf33128c0" title="Helper functions to access elements.">x</a>())));
<a name="l00477"></a>00477     table-&gt;setItem(row, 1, <span class="keyword">new</span> QTableWidgetItem(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#a940d88447f20fac800d1fa510c981275">y</a>())));
<a name="l00478"></a>00478     table-&gt;setItem(row, 2, <span class="keyword">new</span> QTableWidgetItem(QString::number(key.<a class="code" href="classcorecvs_1_1Vector3d.html#a4587f5d4984576c5c4c2d44a4140ce3f">z</a>())));
<a name="l00479"></a>00479     table-&gt;setItem(row, 3, <span class="keyword">new</span> QTableWidgetItem(QString::number(value.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>())));
<a name="l00480"></a>00480     table-&gt;setItem(row, 4, <span class="keyword">new</span> QTableWidgetItem(QString::number(value.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>())));
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00485"></a><a class="code" href="classDistortionWidget.html#abe7f163ecb22928af447159edf53ab5a">00485</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#abe7f163ecb22928af447159edf53ab5a">DistortionWidget::addPointPair</a>(<span class="keyword">const</span> <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> &amp;key, <span class="keyword">const</span> <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> &amp;value)
<a name="l00486"></a>00486 {
<a name="l00487"></a>00487     <span class="keywordtype">unsigned</span> i = 0;
<a name="l00488"></a>00488     <span class="keywordflow">while</span> (i &lt; <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.size())
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490         <span class="keywordflow">if</span> ((<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.at(i).second - value).l2Metric() &lt; <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a>)
<a name="l00491"></a>00491         {
<a name="l00492"></a>00492             <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.erase(<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.begin() + i);
<a name="l00493"></a>00493         } <span class="keywordflow">else</span> {
<a name="l00494"></a>00494             i ++;
<a name="l00495"></a>00495         }
<a name="l00496"></a>00496     }
<a name="l00497"></a>00497     <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.push_back(QPair&lt;Vector3dd,Vector2dd&gt;(key, value));
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     <a class="code" href="classDistortionWidget.html#ac3994ee1565dbdee8d23e08367355774">printVectorPair</a>(key, value);
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;addVertex(value);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="classDistortionWidget.html#a9788089954e930460b2b84f4021641be">00505</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a9788089954e930460b2b84f4021641be">DistortionWidget::choosePoint</a>(<span class="keywordtype">int</span> row, <span class="keywordtype">int</span> <span class="comment">/*column*/</span>)
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507     QTableWidget *table = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;rowCount(); i ++)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; table-&gt;columnCount(); j ++)
<a name="l00512"></a>00512         {
<a name="l00513"></a>00513             table-&gt;item(i, j)-&gt;setBackgroundColor(Qt::color0);
<a name="l00514"></a>00514         }
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;columnCount(); i ++)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         table-&gt;item(row, i)-&gt;setBackgroundColor(Qt::yellow);
<a name="l00519"></a>00519     }
<a name="l00520"></a>00520     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageXSpinBox-&gt;setValue(table-&gt;item(row, 3)-&gt;text().toDouble());
<a name="l00521"></a>00521     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageYSpinBox-&gt;setValue(table-&gt;item(row, 4)-&gt;text().toDouble());
<a name="l00522"></a>00522     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;xCoordSpinBox-&gt;setValue(table-&gt;item(row, 0)-&gt;text().toDouble());
<a name="l00523"></a>00523     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;yCoordSpinBox-&gt;setValue(table-&gt;item(row, 1)-&gt;text().toDouble());
<a name="l00524"></a>00524     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;zCoordSpinBox-&gt;setValue(table-&gt;item(row, 2)-&gt;text().toDouble());
<a name="l00525"></a>00525     <span class="comment">//ui-&gt;widget-&gt;setCurrentPoint(QPointF(ui-&gt;dsbImageX-&gt;value(), ui-&gt;dsbImageY-&gt;value()));</span>
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="classDistortionWidget.html#a6796887461341fbd45081f0bcea3519b">00528</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a6796887461341fbd45081f0bcea3519b">DistortionWidget::deletePointPair</a>()
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530     QTableWidget *table = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget;
<a name="l00531"></a>00531     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> value(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageXSpinBox-&gt;value(), <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;imageYSpinBox-&gt;value());
<a name="l00532"></a>00532     <span class="keywordtype">unsigned</span> i = 0;
<a name="l00533"></a>00533     <span class="keywordflow">while</span> (i &lt; <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.size())
<a name="l00534"></a>00534     {
<a name="l00535"></a>00535         <span class="keywordflow">if</span> ((<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.at(i).second - value).l2Metric() &lt; <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a>)
<a name="l00536"></a>00536         {
<a name="l00537"></a>00537             <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.erase(<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.begin() + i);
<a name="l00538"></a>00538         } <span class="keywordflow">else</span> {
<a name="l00539"></a>00539             i ++;
<a name="l00540"></a>00540         }
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;rowCount(); i ++)
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545         <span class="keywordflow">if</span> (table-&gt;item(i, 3)-&gt;text().toDouble() == value.x() &amp;&amp;
<a name="l00546"></a>00546             table-&gt;item(i, 4)-&gt;text().toDouble() == value.y())
<a name="l00547"></a>00547         {
<a name="l00548"></a>00548             table-&gt;removeRow(i);
<a name="l00549"></a>00549             <span class="keywordflow">break</span>;
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552     <span class="comment">// TODO: PaintFeature</span>
<a name="l00553"></a>00553     <span class="comment">// ui-&gt;widget-&gt;deletePoint(QPointF(value.x(), value.y()));</span>
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a><a class="code" href="classDistortionWidget.html#a7977583220451f123886327a5b24d930">00556</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a7977583220451f123886327a5b24d930">DistortionWidget::editPoint</a>(<span class="keyword">const</span> QPointF &amp;prevPoint, <span class="keyword">const</span> QPointF &amp;newPoint)
<a name="l00557"></a>00557 {
<a name="l00558"></a>00558     QTableWidget *table = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;pointsTableWidget;
<a name="l00559"></a>00559     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; table-&gt;rowCount(); i ++)
<a name="l00560"></a>00560     {
<a name="l00561"></a>00561         QPointF tablePoint(table-&gt;item(i, 3)-&gt;text().toDouble(), table-&gt;item(i, 4)-&gt;text().toDouble());
<a name="l00562"></a>00562         <span class="keywordflow">if</span> ((prevPoint - tablePoint).manhattanLength() &lt; <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a>)
<a name="l00563"></a>00563         {
<a name="l00564"></a>00564             table-&gt;item(i, 3)-&gt;setText(QString::number(newPoint.x()));
<a name="l00565"></a>00565             table-&gt;item(i, 4)-&gt;setText(QString::number(newPoint.y()));
<a name="l00566"></a>00566             <a class="code" href="classDistortionWidget.html#a9788089954e930460b2b84f4021641be">choosePoint</a>(i, 0);
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> prevVector(prevPoint.x(), prevPoint.y());
<a name="l00570"></a>00570     <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> spacePos(-1, -1, -1);
<a name="l00571"></a>00571     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.size(); i ++)
<a name="l00572"></a>00572     {
<a name="l00573"></a>00573         <span class="keywordflow">if</span> ((<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.at(i).second - prevVector).l2Metric() &lt; <a class="code" href="distortionWidget_8cpp.html#a596344e5a2992d2beec43b76a6294de0">EPSILON</a>)
<a name="l00574"></a>00574         {
<a name="l00575"></a>00575             spacePos = <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.at(i).first;
<a name="l00576"></a>00576             <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.erase(<a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.begin() + i);
<a name="l00577"></a>00577             <span class="keywordflow">break</span>;
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580     <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> newVector(newPoint.x(), newPoint.y());
<a name="l00581"></a>00581     <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.push_back(<a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">Points</a>(spacePos, newVector));
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a><a class="code" href="classDistortionWidget.html#ab992ca12e76f4269a7aec54c405cde78">00584</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#ab992ca12e76f4269a7aec54c405cde78">DistortionWidget::doDefaultTransform</a>()
<a name="l00585"></a>00585 {
<a name="l00586"></a>00586     <span class="keyword">const</span> <span class="keywordtype">double</span> scale = 1.05;
<a name="l00587"></a>00587     <span class="keyword">const</span> <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a>  center(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a> * 0.5, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a> * 0.5);
<a name="l00588"></a>00588     <span class="keyword">const</span> <span class="keywordtype">double</span> k = 1024.0 / <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>; <span class="comment">//params for ueyecameras</span>
<a name="l00589"></a>00589     <span class="keyword">const</span> <span class="keywordtype">double</span> params[] = {
<a name="l00590"></a>00590             0.000657414 * k,
<a name="l00591"></a>00591            -6.97987e-05 * k * k,
<a name="l00592"></a>00592              7.9655e-07 * pow(k, 3),
<a name="l00593"></a>00593              -4.318e-09 * pow(k, 4),
<a name="l00594"></a>00594             1.33988e-11 * pow(k, 5),
<a name="l00595"></a>00595            -2.50562e-14 * pow(k, 6),
<a name="l00596"></a>00596             2.79465e-17 * pow(k, 7),
<a name="l00597"></a>00597            -1.71374e-20 * pow(k, 8),
<a name="l00598"></a>00598              4.4494e-24 * pow(k, 9)};
<a name="l00599"></a>00599     vector&lt;double&gt; straightParams(params, params + <a class="code" href="global_8h.html#adf7f0f5c34dedd7cc1eca0f7c55a73d2">CORE_COUNT_OF</a>(params));
<a name="l00600"></a>00600     <a class="code" href="classcorecvs_1_1LensCorrectionParametres.html" title="This structure holds the parameters to correct the image.">LensCorrectionParametres</a> lenCorrectionParams(straightParams, 0, 0, <span class="comment">/*p1, p2,*/</span> scale, 200.0,  center);
<a name="l00601"></a>00601     <a class="code" href="classcorecvs_1_1RadialCorrection.html">RadialCorrection</a> radCorrection(lenCorrectionParams);
<a name="l00602"></a>00602     <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(
<a name="l00603"></a>00603             <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>(&amp;radCorrection, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, <span class="keyword">true</span>)
<a name="l00604"></a>00604     );
<a name="l00605"></a>00605 }
<a name="l00606"></a>00606 
<a name="l00607"></a>00607 <span class="comment">/* Manual transform */</span>
<a name="l00608"></a>00608 
<a name="l00609"></a><a class="code" href="classDistortionWidget.html#ab999e924f68ea2d6e8089ca8f4717c32">00609</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#ab999e924f68ea2d6e8089ca8f4717c32">DistortionWidget::doManualTransform</a>()
<a name="l00610"></a>00610 {
<a name="l00611"></a>00611     <a class="code" href="classcorecvs_1_1LensCorrectionParametres.html" title="This structure holds the parameters to correct the image.">LensCorrectionParametres</a> &amp;lensParams = <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>.<a class="code" href="classcorecvs_1_1RadialCorrection.html#a37a674a2ec28a36aeb35dedc88e2581b">mParams</a>;
<a name="l00612"></a>00612     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a2145b5b7c4f6c0b7587bae2aa1e90211" title="The center of the distortion .">center</a>.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;centerXSpinBox-&gt;value();
<a name="l00613"></a>00613     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a2145b5b7c4f6c0b7587bae2aa1e90211" title="The center of the distortion .">center</a>.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;centerYSpinBox-&gt;value();
<a name="l00614"></a>00614     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a6c1b9a82e3bde3592ffefc24884ee03c" title="First tangent correction coefficient - .">p1</a> = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;tangential1SpinBox-&gt;value();
<a name="l00615"></a>00615     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#aadc60a3cb91599136009b99e23f71cfe" title="Second tangent correction coefficient - .">p2</a> = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;tangential2SpinBox-&gt;value();
<a name="l00616"></a>00616     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#abff21985b6f6a9c8c51fd649b73960f2" title="y/x matrix ratio">aspect</a> = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;scaleSpinBox-&gt;value();
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#adaff88b76030f4d217f2f978fe056420" title="Polynom to describe radial correction.">koeff</a>.clear();
<a name="l00619"></a>00619     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;rowCount(); i ++) {
<a name="l00620"></a>00620         QVariant value = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;item(i, 1)-&gt;data(Qt::DisplayRole);
<a name="l00621"></a>00621         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00622"></a>00622         <span class="keywordtype">double</span> koef = value.toDouble(&amp;ok);
<a name="l00623"></a>00623         qDebug() &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot;) =&quot;</span> &lt;&lt; koef &lt;&lt; <span class="stringliteral">&quot;[&quot;</span> &lt;&lt; ok &lt;&lt; <span class="stringliteral">&quot;]&quot;</span>;
<a name="l00624"></a>00624         lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#adaff88b76030f4d217f2f978fe056420" title="Polynom to describe radial correction.">koeff</a>.push_back(koef);
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627     <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a> = <a class="code" href="classcorecvs_1_1RadialCorrection.html">RadialCorrection</a>(lensParams);
<a name="l00628"></a>00628     <span class="keywordflow">if</span> (!<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;isInverseCheckBox-&gt;isChecked()) {
<a name="l00629"></a>00629         <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(<span class="keyword">new</span> <a class="code" href="classcorecvs_1_1DisplacementBuffer.html" title="This buffer stores a buffer deformation - a shift of the buffer pixels.">DisplacementBuffer</a>(&amp;<a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, <span class="keyword">true</span>));
<a name="l00630"></a>00630     } <span class="keywordflow">else</span> {
<a name="l00631"></a>00631         <a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a> = QSharedPointer&lt;DisplacementBuffer&gt;(DisplacementBuffer::CacheInverse(&amp;<a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>,
<a name="l00632"></a>00632             <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>,
<a name="l00633"></a>00633             0.0,0.0,
<a name="l00634"></a>00634             (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>, 0.5)
<a name="l00635"></a>00635         );
<a name="l00636"></a>00636     }
<a name="l00637"></a>00637     <a class="code" href="classDistortionWidget.html#a1f91c72ac0fb5b47dc766f8f850c8bd9">updateScore</a>();
<a name="l00638"></a>00638     <a class="code" href="classDistortionWidget.html#ad22920d93b2d23677fc3c5960945eada">updateAdditionalData</a>();
<a name="l00639"></a>00639 }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 
<a name="l00642"></a><a class="code" href="classDistortionWidget.html#ad22920d93b2d23677fc3c5960945eada">00642</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#ad22920d93b2d23677fc3c5960945eada">DistortionWidget::updateAdditionalData</a>()
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644     <a class="code" href="classcorecvs_1_1LensCorrectionParametres.html" title="This structure holds the parameters to correct the image.">LensCorrectionParametres</a> &amp;lensParams = <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>.<a class="code" href="classcorecvs_1_1RadialCorrection.html#a37a674a2ec28a36aeb35dedc88e2581b">mParams</a>;
<a name="l00645"></a>00645     <span class="comment">/* Updating graph */</span>
<a name="l00646"></a>00646     <span class="keywordtype">int</span> diagonal = <a class="code" href="namespacecorecvs.html#af76dfccc4f8b3f0a802cc2dd27a3b303">Vector2dd</a>(<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>, <a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>).<a class="code" href="classcorecvs_1_1VectorOperationsBase.html#acfcd4bcc60d1d076b00afcfeba9f9e8b" title="Euclidean distance.">l2Metric</a>();
<a name="l00647"></a>00647     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; diagonal; i++) {
<a name="l00648"></a>00648         <a class="code" href="classDistortionWidget.html#a1cb8aceee93b2f34804de153ecdb2186">mGraphDialog</a>.<a class="code" href="classGraphPlotDialog.html#aa9919d91a1219eb290eded597c3f230a">addGraphPoint</a>(0, <a class="code" href="classDistortionWidget.html#ab38e12d9b8ddab07752c2ab2d9bf4843">mLinesRadialCoorection</a>.<a class="code" href="classcorecvs_1_1RadialCorrection.html#a0390787ab3d7567171a68f9cf0d2d0e4">radialScale</a>(((<span class="keywordtype">double</span>)diagonal - i - 1) / diagonal), <span class="keyword">true</span>);
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650     <a class="code" href="classDistortionWidget.html#a1cb8aceee93b2f34804de153ecdb2186">mGraphDialog</a>.<a class="code" href="classGraphPlotDialog.html#a7ac2613d55686a6e35815b667c77d9fd">update</a>();
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="comment">/* Updating distortion*/</span>
<a name="l00653"></a>00653     <a class="code" href="classcorecvs_1_1Map2DFunction.html">Map2DFunction&lt;DisplacementBuffer&gt;</a> mapFunc(<a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>.data());
<a name="l00654"></a>00654     <a class="code" href="classcorecvs_1_1LengthFunction.html">LengthFunction</a> lengthFunc(&amp;mapFunc);
<a name="l00655"></a>00655     <a class="code" href="classcorecvs_1_1RGB24Buffer.html">RGB24Buffer</a> *output = <span class="keyword">new</span> <a class="code" href="classcorecvs_1_1RGB24Buffer.html">RGB24Buffer</a>(<a class="code" href="classDistortionWidget.html#a2b71fdbbc0244dc678f9380999d62cd7">mDistortionCorrectTransform</a>-&gt;getSize());
<a name="l00656"></a>00656     output-&gt;<a class="code" href="classcorecvs_1_1RGB24Buffer.html#af1eea99d617a211ad0e57c9f32153d7d">drawIsolines</a>(0.0, 0.0,
<a name="l00657"></a>00657             (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a>,  (<span class="keywordtype">double</span>)<a class="code" href="classDistortionWidget.html#a69ac1c3865c229718ffc3c14675d7576">mBufferInput</a>-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a>,
<a name="l00658"></a>00658             0.1, lengthFunc);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <a class="code" href="classDistortionWidget.html#a364dbb9776b0ae2e9a1a596716043ded">mLevelGraphDialog</a>.<a class="code" href="classAdvancedImageWidget.html#a365f213bdb320f2392d2693d6931abdd">setImage</a>(QSharedPointer&lt;QImage&gt;(<span class="keyword">new</span> <a class="code" href="classRGB24Image.html">RGB24Image</a>(output)));
<a name="l00661"></a>00661     delete_safe(output);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663     <span class="comment">/* Updating textual output */</span>
<a name="l00664"></a>00664     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;centerXSpinBox-&gt;setValue(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a2145b5b7c4f6c0b7587bae2aa1e90211" title="The center of the distortion .">center</a>.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>());
<a name="l00665"></a>00665     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;centerYSpinBox-&gt;setValue(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a2145b5b7c4f6c0b7587bae2aa1e90211" title="The center of the distortion .">center</a>.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>());
<a name="l00666"></a>00666     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;tangential1SpinBox-&gt;setValue(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#a6c1b9a82e3bde3592ffefc24884ee03c" title="First tangent correction coefficient - .">p1</a>);
<a name="l00667"></a>00667     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;tangential2SpinBox-&gt;setValue(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#aadc60a3cb91599136009b99e23f71cfe" title="Second tangent correction coefficient - .">p2</a>);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;scaleSpinBox-&gt;setValue(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#abff21985b6f6a9c8c51fd649b73960f2" title="y/x matrix ratio">aspect</a>);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;clear();
<a name="l00672"></a>00672     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setColumnCount(2);
<a name="l00673"></a>00673     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setRowCount(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#adaff88b76030f4d217f2f978fe056420" title="Polynom to describe radial correction.">koeff</a>.size());
<a name="l00674"></a>00674     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#adaff88b76030f4d217f2f978fe056420" title="Polynom to describe radial correction.">koeff</a>.size(); i ++) {
<a name="l00675"></a>00675         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setItem(i, 0, <span class="keyword">new</span> QTableWidgetItem(QString(<span class="stringliteral">&quot;x^%1&quot;</span>).arg(i + 1)));
<a name="l00676"></a>00676         QVariant value(QString::number(lensParams.<a class="code" href="classcorecvs_1_1LensCorrectionParametres.html#adaff88b76030f4d217f2f978fe056420" title="Polynom to describe radial correction.">koeff</a>[i], <span class="charliteral">&#39;g&#39;</span>, 15));
<a name="l00677"></a>00677         QTableWidgetItem *data = <span class="keyword">new</span> QTableWidgetItem();
<a name="l00678"></a>00678         data-&gt;setData(Qt::DisplayRole, value);
<a name="l00679"></a>00679         data-&gt;setFlags(data-&gt;flags() | Qt::ItemIsEditable);
<a name="l00680"></a>00680         <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setItem(i, 1, data);
<a name="l00681"></a>00681     }
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a><a class="code" href="classDistortionWidget.html#acd0a6baf382ed08a2e57de62b82bb5ce">00684</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#acd0a6baf382ed08a2e57de62b82bb5ce">DistortionWidget::addPower</a>()
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686     <span class="keywordtype">int</span> newRow = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;rowCount() + 1;
<a name="l00687"></a>00687     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setRowCount(newRow);
<a name="l00688"></a>00688     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setColumnCount(2);
<a name="l00689"></a>00689     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setItem(newRow - 1, 0, <span class="keyword">new</span> QTableWidgetItem(QString(<span class="stringliteral">&quot;x^%1&quot;</span>).arg(newRow)));
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a><a class="code" href="classDistortionWidget.html#a463f43ca659f3be87b5e8272595b2a9f">00692</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a463f43ca659f3be87b5e8272595b2a9f">DistortionWidget::delPower</a>()
<a name="l00693"></a>00693 {
<a name="l00694"></a>00694     <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;setRowCount(<a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;koefTableWidget-&gt;rowCount() - 1);
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 <span class="comment"></span>
<a name="l00697"></a>00697 <span class="comment">/**</span>
<a name="l00698"></a>00698 <span class="comment"> *   Loading and saving of current points</span>
<a name="l00699"></a>00699 <span class="comment"> **/</span>
<a name="l00700"></a>00700 
<a name="l00701"></a><a class="code" href="classDistortionWidget.html#aaf0d0497e8456730e85fd213731efd75">00701</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#aaf0d0497e8456730e85fd213731efd75" title="Saving/loading state.">DistortionWidget::savePoints</a>()
<a name="l00702"></a>00702 {
<a name="l00703"></a>00703     QSettings settings(<span class="stringliteral">&quot;distortionCorrection.conf&quot;</span>, QSettings::IniFormat);
<a name="l00704"></a>00704     settings.beginWriteArray(<span class="stringliteral">&quot;points&quot;</span>);
<a name="l00705"></a>00705     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.size(); i ++)
<a name="l00706"></a>00706     {
<a name="l00707"></a>00707         <a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">Points</a> points = <a class="code" href="classDistortionWidget.html#a54d23086220f5852603022babb7423c8">mCorrectionMap</a>.at(i);
<a name="l00708"></a>00708         settings.setArrayIndex(i);
<a name="l00709"></a>00709         settings.setValue(<span class="stringliteral">&quot;spacePoint_X&quot;</span>, points.first.x());
<a name="l00710"></a>00710         settings.setValue(<span class="stringliteral">&quot;spacePoint_Y&quot;</span>, points.first.y());
<a name="l00711"></a>00711         settings.setValue(<span class="stringliteral">&quot;spacePoint_Z&quot;</span>, points.first.z());
<a name="l00712"></a>00712         settings.setValue(<span class="stringliteral">&quot;imagePoint_X&quot;</span>, points.second.x());
<a name="l00713"></a>00713         settings.setValue(<span class="stringliteral">&quot;imagePoint_Y&quot;</span>, points.second.y());
<a name="l00714"></a>00714     }
<a name="l00715"></a>00715     settings.endArray();
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     vector&lt;vector&lt;Vector2dd&gt; &gt; straights = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget-&gt;getPaths();
<a name="l00718"></a>00718     settings.beginWriteArray(<span class="stringliteral">&quot;lines&quot;</span>);
<a name="l00719"></a>00719     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; straights.size(); i++) {
<a name="l00720"></a>00720         settings.setArrayIndex(i);
<a name="l00721"></a>00721         settings.beginWriteArray(<span class="stringliteral">&quot;subpoints&quot;</span>);
<a name="l00722"></a>00722         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j = 0; j &lt; straights[i].size(); j++) {
<a name="l00723"></a>00723             settings.setArrayIndex(j);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725             settings.setValue(<span class="stringliteral">&quot;point.x&quot;</span>, straights[i][j].x());
<a name="l00726"></a>00726             settings.setValue(<span class="stringliteral">&quot;point.y&quot;</span>, straights[i][j].y());
<a name="l00727"></a>00727         }
<a name="l00728"></a>00728         settings.endArray();
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     settings.endArray();
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="classDistortionWidget.html#a762c42384a71b91391fb7e010e625719">00733</a> <span class="keywordtype">void</span> <a class="code" href="classDistortionWidget.html#a762c42384a71b91391fb7e010e625719">DistortionWidget::loadPoints</a>()
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735     QSettings settings(<span class="stringliteral">&quot;distortionCorrection.conf&quot;</span>, QSettings::IniFormat);
<a name="l00736"></a>00736     <span class="keywordtype">int</span> size = settings.beginReadArray(<span class="stringliteral">&quot;points&quot;</span>);
<a name="l00737"></a>00737     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i ++)
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739         <a class="code" href="distortionWidget_8cpp.html#aad6ebad1efed086eb6a7d6932ad93431">Points</a> points;
<a name="l00740"></a>00740         settings.setArrayIndex(i);
<a name="l00741"></a>00741         points.first[0]  = settings.value(<span class="stringliteral">&quot;spacePoint_X&quot;</span>).toDouble();
<a name="l00742"></a>00742         points.first[1]  = settings.value(<span class="stringliteral">&quot;spacePoint_Y&quot;</span>).toDouble();
<a name="l00743"></a>00743         points.first[2]  = settings.value(<span class="stringliteral">&quot;spacePoint_Z&quot;</span>).toDouble();
<a name="l00744"></a>00744         points.second[0] = settings.value(<span class="stringliteral">&quot;imagePoint_X&quot;</span>).toDouble();
<a name="l00745"></a>00745         points.second[1] = settings.value(<span class="stringliteral">&quot;imagePoint_Y&quot;</span>).toDouble();
<a name="l00746"></a>00746         <a class="code" href="classDistortionWidget.html#abe7f163ecb22928af447159edf53ab5a">addPointPair</a>(points.first, points.second);
<a name="l00747"></a>00747     }
<a name="l00748"></a>00748     settings.endArray();
<a name="l00749"></a>00749 
<a name="l00750"></a>00750     <span class="comment">/* TODO: Make an interface for this */</span>
<a name="l00751"></a>00751     <a class="code" href="classPaintImageWidget.html">PaintImageWidget</a> *canvas = <a class="code" href="classDistortionWidget.html#abd96be5480ff746583072bd4f42df2d4">mUi</a>-&gt;widget;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     <span class="keywordtype">int</span> lines = settings.beginReadArray(<span class="stringliteral">&quot;lines&quot;</span>);
<a name="l00754"></a>00754     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lines; i++) {
<a name="l00755"></a>00755         canvas-&gt;<a class="code" href="classPaintImageWidget.html#a51a6b31fefd69479f2e281cce4e6e286" title="Pathes.">mPaths</a>.append(<a class="code" href="structPaintImageWidget_1_1VertexPath.html">PaintImageWidget::VertexPath</a>());
<a name="l00756"></a>00756         <a class="code" href="structPaintImageWidget_1_1VertexPath.html">PaintImageWidget::VertexPath</a> &amp;path = canvas-&gt;<a class="code" href="classPaintImageWidget.html#a51a6b31fefd69479f2e281cce4e6e286" title="Pathes.">mPaths</a>.last();
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         settings.setArrayIndex(i);
<a name="l00759"></a>00759         <span class="keywordtype">int</span> subpoints = settings.beginReadArray(<span class="stringliteral">&quot;subpoints&quot;</span>);
<a name="l00760"></a>00760         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; subpoints; j++) {
<a name="l00761"></a>00761             settings.setArrayIndex(j);
<a name="l00762"></a>00762             <a class="code" href="classcorecvs_1_1Vector2d.html">Vector2dd</a> pos;
<a name="l00763"></a>00763             pos.<a class="code" href="classcorecvs_1_1Vector2d.html#a944721c41f044c1388d9dc42ca899bce">x</a>() = settings.value(<span class="stringliteral">&quot;point.x&quot;</span>).toDouble();
<a name="l00764"></a>00764             pos.<a class="code" href="classcorecvs_1_1Vector2d.html#ae1ea2ad4c0821001408bf963cffa8413">y</a>() = settings.value(<span class="stringliteral">&quot;point.y&quot;</span>).toDouble();
<a name="l00765"></a>00765             canvas-&gt;<a class="code" href="classPaintImageWidget.html#a7d3e0eee6e65817b8d55c1e80a1719b1">addVertex</a>(pos);
<a name="l00766"></a>00766             canvas-&gt;<a class="code" href="classPaintImageWidget.html#a570ccd098d1ab60c3b6d923ea2a7320f">addVertexToPath</a>(&amp;canvas-&gt;<a class="code" href="classPaintImageWidget.html#af724b3ab8583238ac32c927ba115675a" title="Points.">mPoints</a>.last(), &amp;path);
<a name="l00767"></a>00767         }
<a name="l00768"></a>00768         settings.endArray();
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770     settings.endArray();
<a name="l00771"></a>00771 }
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:38 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
