<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: Distortion correction documentation page</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Distortion correction documentation page </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="author"><dt><b>Author:</b></dt><dd>Osechkina Maria</dd></dl>
<h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<p>This document is devoted to the implementation and details of spherical distortion correction. </p>
<h2><a class="anchor" id="Problem"></a>
Formulation</h2>
<p>For correction of cameras distortion we propose to find lines, that are straights in reality, and to construct a transformation, that straighten this lines. Us usual straights are mapped to arcs after cameras distortion. We have to construct reverse transform, that should maps some arcs to straights.</p>
<h2><a class="anchor" id="Algorithms"></a>
Algorithms</h2>
<p>In this section seveal algorithms of distortion correction are described and reffered to: <br/>
 <a class="el" href="pDistortionCorrection.html#subSectionInversion">Inversion</a> <br/>
 <a class="el" href="pDistortionCorrection.html#subSectionBarrel">Barrel Distortion Correction Algorithm.</a> <br/>
 <a class="el" href="pDistortionCorrection.html#subSectionTaylor">Taylor series</a> <br/>
</p>
<h3><a class="anchor" id="subSectionInversion"></a>
Inversion</h3>
<p>We assume that cameras distortion could be presented us sequence of projection of space to the plane, map of part plane to the segment of sphere and another projection. It is necessary to get image closed to the first projection. We have to construct continuous transform that maps sphere to the plane. As such transform we use inversion of the space <a href="http://en.wikipedia.org/wiki/Inversive_geometry">http://en.wikipedia.org/wiki/Inversive_geometry</a></p>
<p>Let <img class="formulaInl" alt="$(x_0, y_0, z_0)$" src="form_286.png"/> is a point on the sphere with center in the origin and radius <img class="formulaInl" alt="$R$" src="form_287.png"/>. Let <img class="formulaInl" alt="$(0, 0, -R)$" src="form_288.png"/> is the center of inverion, i. e. sphere contains inversion center and is mapped into the plane. Let <img class="formulaInl" alt="$r_0$" src="form_289.png"/> is inversion radius. The image of point is the point <img class="formulaInl" alt="$(x_1, y_1, z_1)$" src="form_290.png"/> belonging to the ray with initial point in inversion center, which contains preimage of point. By the inversion definition <img class="formulaInl" alt="$dist((x_0, y_0, z_0), (0, 0, -R)) * dist((x_1, y_1, z_1), (0, 0, -R)) = r_0 ^ 2 $" src="form_291.png"/>. <br/>
 <img class="formulaInl" alt="$(x_0, y_0, z_0) \in B((0, 0, 0), R)$" src="form_292.png"/> then <img class="formulaInl" alt="$z_0 = \sqrt(R ^ 2 - x_0 ^ 2 - y_0 ^ 2) $" src="form_293.png"/> <br/>
 <img class="formulaInl" alt="$\sqrt(x_0 ^ 2 + y_0 ^ 2 + (\sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2} + R) ^ 2) * \sqrt(x_1 ^ 2 + y_1 ^2 + (z_1 + R) ^ 2) = r_0 ^ 2$" src="form_294.png"/> <br/>
 <img class="formulaInl" alt="$(x_1, y_1, z_1)$" src="form_290.png"/> , <img class="formulaInl" alt="$(x_0, y_0, z_0)$" src="form_286.png"/> , <img class="formulaInl" alt="$(0, 0, -R)$" src="form_288.png"/> lie on the same line, then <img class="formulaInl" alt="$(x_1, y_1, z_1) = (x_0 * a, y_0 * a, - R + a *(z_0 + R))$" src="form_295.png"/> <br/>
</p>
<p><img class="formulaInl" alt="$\sqrt{2 * R ^ 2 + 2 * R * \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}} * \sqrt{(a*x_0) ^2 + (a * y_0) ^ 2 + (a * (z_0 + R)) ^ 2} = r_0 ^ 2$" src="form_296.png"/> ,i e <img class="formulaInl" alt="$ \left | a \right | *(2 * R ^ 2 + 2 * R * (R ^ 2 - x_0 ^ 2 - y_0 ^ 2)) = r_0^2$" src="form_297.png"/> <br/>
</p>
<p><img class="formulaInl" alt="$a$" src="form_98.png"/> is positive by the choice of ray direction. <br/>
</p>
<p>Image of the point <img class="formulaInl" alt="$(x_0, y_0, z_0)$" src="form_286.png"/> is <img class="formulaInl" alt="$(C * x_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, C * y_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, C * z_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}})$" src="form_298.png"/> , It is obvious that <img class="formulaInl" alt="$C$" src="form_299.png"/> only affects the scale. Picture size should be invariant, since <img class="formulaInl" alt="$C = R + \sqrt{R ^ 2 - 0. 25 * (image_w ^ 2 + image_h ^ 2)}$" src="form_300.png"/> (Consider the case <img class="formulaInl" alt="$R ^ 2 < 0. 25 * (image_w ^ 2 + image_h ^ 2)$" src="form_301.png"/>) <br/>
</p>
<p>After projective transform image of <img class="formulaInl" alt="$(x_0, y_0)$" src="form_302.png"/> is <img class="formulaInl" alt="$(x_0 * C \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, y_0 * C \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}} )$" src="form_303.png"/> <br/>
</p>
<h4><a class="anchor" id="sphereRad"></a>
Determination of sphere radius</h4>
<p>Let us known 3 points in the picture, images of which should lie on the same line after inversion. Then before projective transform these 3 points and inversion center should lie on the same circle. If we have <img class="formulaInl" alt="$(x_1, y_1, z_1)$" src="form_290.png"/> , <img class="formulaInl" alt="$(x_2, y_2, z_2)$" src="form_304.png"/> , <img class="formulaInl" alt="$(x_3, y_3, z_3)$" src="form_305.png"/>, where <img class="formulaInl" alt="$(x_i, y_i)$" src="form_306.png"/> is determined by user, then <img class="formulaInl" alt="$x_i ^ 2 + y_i ^2 + z_i ^ 2 = R ^ 2$" src="form_307.png"/>, <img class="formulaInl" alt="$A * x_i + B * y_i + C * z_i + D = 0$" src="form_308.png"/>. <br/>
</p>
<p>Moreover <img class="formulaInl" alt="$A * 0 + B * 0 - R * C + D = 0$" src="form_309.png"/>, since <img class="formulaInl" alt="$(0, 0, -R)$" src="form_288.png"/> and <img class="formulaInl" alt="$(x_1, y_1, z_1)$" src="form_290.png"/> <img class="formulaInl" alt="$(x_2, y_2, z_2)$" src="form_304.png"/> <img class="formulaInl" alt="$(x_3, y_3, z_3)$" src="form_305.png"/> lie in the same plane. <br/>
</p>
<p>Let <img class="formulaInl" alt="$C = 1$" src="form_310.png"/> then <img class="formulaInl" alt="$D = R$" src="form_311.png"/>, We got system of equations <img class="formulaInl" alt="$A * x_i + B * y_i + \sqrt(R^2 -x_i^2 - y_i ^2) + R = 0$" src="form_312.png"/> <img class="formulaInl" alt="$i=1,2,3$" src="form_313.png"/> <br/>
</p>
<p>We solve the system by Newton method. Let first approximation is : <img class="formulaInl" alt="$R = 500$" src="form_314.png"/> <br/>
 <img class="formulaInl" alt="$A = {y_1 * (R + \sqrt{R ^ 2 - x_2 ^ 2 - y_2 ^ 2}) - y_2 * (R + \sqrt{R ^ R - x_1 * x_1 - y_1 * y_1})} \over {x_1 * y_2 - x_2 * y_1}$" src="form_315.png"/> <br/>
 <img class="formulaInl" alt="$B = - {x_1 * (R + \sqrt{R * R - x_2 ^ 2 - y_2 ^ 2}) - x_2 * (R + \sqrt{ R * R - x_1 ^ 2 - y_1 ^ 2})} \over {x_1 * y_2 - x_2 * y_1}$" src="form_316.png"/> <br/>
</p>
<h3><a class="anchor" id="subSectionBarrel"></a>
Barrel Distortion Correction Algorithm.</h3>
<p><a href="http://www-ist.massey.ac.nz/dbailey/sprg/ivcnz/Proceedings/IVCNZ_73.pdf">http://www-ist.massey.ac.nz/dbailey/sprg/ivcnz/Proceedings/IVCNZ_73.pdf</a> <a href="http://mipav.cit.nih.gov/documentation/HTML%20Algorithms/BarrelDistortionCorrection.html">http://mipav.cit.nih.gov/documentation/HTML%20Algorithms/BarrelDistortionCorrection.html</a></p>
<h3><a class="anchor" id="subSectionTaylor"></a>
Taylor series</h3>
<p><a href="http://www.ipcbee.com/vol13/34-R012.pdf">http://www.ipcbee.com/vol13/34-R012.pdf</a> </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:42 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
