<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: utils/distortioncorrector/distortionCorrectionDoc.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">utils/distortioncorrector/distortionCorrectionDoc.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="distortionCorrectionDoc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*! \page pDistortionCorrection Distortion correction documentation page</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  \author Osechkina Maria</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">\section Introduction</span>
<a name="l00006"></a>00006 <span class="comment">    This document is devoted to the implementation and details of spherical distortion correction.</span>
<a name="l00007"></a>00007 <span class="comment">\section Problem formulation</span>
<a name="l00008"></a>00008 <span class="comment">    For correction of cameras distortion we propose to find lines, that are</span>
<a name="l00009"></a>00009 <span class="comment">straights in reality, and to construct a transformation, that straighten this lines.</span>
<a name="l00010"></a>00010 <span class="comment">Us usual straights are mapped to arcs after cameras distortion. We have to</span>
<a name="l00011"></a>00011 <span class="comment">construct reverse transform, that should maps some arcs to straights.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">\section Algorithms</span>
<a name="l00014"></a>00014 <span class="comment">    In this section seveal algorithms of distortion correction are described and reffered to: \n</span>
<a name="l00015"></a>00015 <span class="comment">    \ref subSectionInversion \n</span>
<a name="l00016"></a>00016 <span class="comment">    \ref subSectionBarrel \n</span>
<a name="l00017"></a>00017 <span class="comment">    \ref subSectionTaylor \n</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">\subsection subSectionInversion Inversion</span>
<a name="l00020"></a>00020 <span class="comment">    We assume that cameras distortion could be presented us sequence of projection</span>
<a name="l00021"></a>00021 <span class="comment">of space to the plane, map of part plane to the segment of sphere and another projection.</span>
<a name="l00022"></a>00022 <span class="comment">It is necessary to get image closed to the first projection. We have to construct</span>
<a name="l00023"></a>00023 <span class="comment">continuous transform that maps sphere to the plane. As such transform we use inversion of the space</span>
<a name="l00024"></a>00024 <span class="comment">http://en.wikipedia.org/wiki/Inversive_geometry</span>
<a name="l00025"></a>00025 <span class="comment"></span>
<a name="l00026"></a>00026 <span class="comment">    Let \f$(x_0, y_0, z_0)\f$ is a point on the sphere with center in the origin and radius \f$R\f$.</span>
<a name="l00027"></a>00027 <span class="comment">Let \f$(0, 0, -R)\f$ is the center of inverion, i. e. sphere contains inversion center and is mapped into the plane.</span>
<a name="l00028"></a>00028 <span class="comment">Let \f$r_0\f$  is inversion radius. The image of point is the point \f$(x_1, y_1, z_1)\f$ belonging to the ray with initial point</span>
<a name="l00029"></a>00029 <span class="comment">in inversion center, which contains preimage of point.</span>
<a name="l00030"></a>00030 <span class="comment">By the inversion definition \f$dist((x_0, y_0, z_0), (0, 0, -R)) * dist((x_1, y_1, z_1), (0, 0, -R)) = r_0 ^ 2 \f$. \n</span>
<a name="l00031"></a>00031 <span class="comment">  \f$(x_0, y_0, z_0)  \in B((0, 0, 0), R)\f$ then \f$z_0 = \sqrt(R ^ 2 - x_0 ^ 2 - y_0 ^ 2) \f$ \n</span>
<a name="l00032"></a>00032 <span class="comment">  \f$\sqrt(x_0 ^ 2 + y_0 ^ 2 + (\sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2} + R) ^ 2) * \sqrt(x_1 ^ 2 + y_1 ^2 + (z_1 + R) ^ 2) = r_0 ^ 2\f$ \n</span>
<a name="l00033"></a>00033 <span class="comment">   \f$(x_1, y_1, z_1)\f$ , \f$(x_0, y_0, z_0)\f$ , \f$(0, 0, -R)\f$ lie on the same line, then</span>
<a name="l00034"></a>00034 <span class="comment">   \f$(x_1, y_1, z_1) = (x_0 * a, y_0 * a, - R + a *(z_0 + R))\f$ \n</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="comment">  \f$\sqrt{2 * R ^ 2 + 2 * R * \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}} * \sqrt{(a*x_0) ^2  + (a * y_0) ^ 2 + (a * (z_0 + R)) ^ 2} = r_0 ^ 2\f$ ,i e</span>
<a name="l00037"></a>00037 <span class="comment">\f$ \left | a \right | *(2 * R ^ 2 + 2 * R * (R ^ 2 - x_0 ^ 2 - y_0 ^ 2)) = r_0^2\f$  \n</span>
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">\f$a\f$ is positive by the choice of ray direction. \n</span>
<a name="l00040"></a>00040 <span class="comment"></span>
<a name="l00041"></a>00041 <span class="comment">    Image of the point \f$(x_0, y_0, z_0)\f$ is</span>
<a name="l00042"></a>00042 <span class="comment">\f$(C * x_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, C * y_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, C * z_0 \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}})\f$ ,</span>
<a name="l00043"></a>00043 <span class="comment">It is obvious that \f$C\f$ only affects the scale. Picture size should be invariant, since \f$C = R + \sqrt{R ^ 2 - 0. 25 * (image_w ^ 2 + image_h ^ 2)}\f$</span>
<a name="l00044"></a>00044 <span class="comment">(Consider the case \f$R ^ 2 &lt; 0. 25 * (image_w ^ 2 + image_h ^ 2)\f$) \n</span>
<a name="l00045"></a>00045 <span class="comment"></span>
<a name="l00046"></a>00046 <span class="comment">After projective transform image of \f$(x_0, y_0)\f$ is \f$(x_0 * C \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}}, y_0 * C \over {R + \sqrt{R ^ 2 - x_0 ^ 2 - y_0 ^ 2}} )\f$ \n</span>
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">\subsubsection  sphereRad Determination of sphere radius</span>
<a name="l00049"></a>00049 <span class="comment"></span>
<a name="l00050"></a>00050 <span class="comment">    Let us known 3 points in the picture, images of which should lie on the same</span>
<a name="l00051"></a>00051 <span class="comment">line after inversion. Then before projective transform these 3 points and inversion</span>
<a name="l00052"></a>00052 <span class="comment">center should lie on the same circle. If we have \f$(x_1, y_1, z_1)\f$ , \f$(x_2, y_2, z_2)\f$ ,</span>
<a name="l00053"></a>00053 <span class="comment"> \f$(x_3, y_3, z_3)\f$, where \f$(x_i, y_i)\f$ is determined  by user, then</span>
<a name="l00054"></a>00054 <span class="comment">\f$x_i ^ 2 + y_i ^2 + z_i ^ 2 = R ^ 2\f$,</span>
<a name="l00055"></a>00055 <span class="comment">\f$A * x_i + B * y_i + C * z_i + D = 0\f$. \n</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">Moreover \f$A * 0 + B * 0 - R * C + D = 0\f$, since \f$(0, 0, -R)\f$ and</span>
<a name="l00058"></a>00058 <span class="comment">\f$(x_1, y_1, z_1)\f$ \f$(x_2, y_2, z_2)\f$ \f$(x_3, y_3, z_3)\f$ lie in the same plane. \n</span>
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">Let \f$C = 1\f$ then \f$D = R\f$,</span>
<a name="l00061"></a>00061 <span class="comment">We got system of equations</span>
<a name="l00062"></a>00062 <span class="comment">\f$A * x_i + B * y_i + \sqrt(R^2 -x_i^2 - y_i ^2) + R = 0\f$ \f$i=1,2,3\f$ \n</span>
<a name="l00063"></a>00063 <span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">We solve the system by Newton method.</span>
<a name="l00065"></a>00065 <span class="comment">Let first approximation is :</span>
<a name="l00066"></a>00066 <span class="comment">\f$R = 500\f$ \n</span>
<a name="l00067"></a>00067 <span class="comment">\f$A = {y_1 * (R + \sqrt{R ^ 2 - x_2 ^ 2 - y_2 ^ 2}) - y_2 * (R + \sqrt{R ^ R - x_1 * x_1 - y_1 * y_1})} \over {x_1 * y_2 - x_2 * y_1}\f$ \n</span>
<a name="l00068"></a>00068 <span class="comment">\f$B =  - {x_1 * (R + \sqrt{R * R - x_2 ^ 2 - y_2 ^ 2}) - x_2 * (R + \sqrt{ R * R - x_1 ^ 2 - y_1 ^ 2})} \over {x_1 * y_2 - x_2 * y_1}\f$ \n</span>
<a name="l00069"></a>00069 <span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">  \subsection subSectionBarrel  Barrel Distortion Correction Algorithm.</span>
<a name="l00071"></a>00071 <span class="comment">http://www-ist.massey.ac.nz/dbailey/sprg/ivcnz/Proceedings/IVCNZ_73.pdf</span>
<a name="l00072"></a>00072 <span class="comment">http://mipav.cit.nih.gov/documentation/HTML%20Algorithms/BarrelDistortionCorrection.html</span>
<a name="l00073"></a>00073 <span class="comment"></span>
<a name="l00074"></a>00074 <span class="comment">  \subsection subSectionTaylor Taylor series</span>
<a name="l00075"></a>00075 <span class="comment">http://www.ipcbee.com/vol13/34-R012.pdf</span>
<a name="l00076"></a>00076 <span class="comment">  */</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:38 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
