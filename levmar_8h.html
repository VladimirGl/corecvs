<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: core/clegacy/math/levmar.h File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">core/clegacy/math/levmar.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file is a header for the <a class="el" href="levmar_8c.html" title="This file contains the Levenberg-Marquardt algorithm for non-linear least squares solution...">levmar.c</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="levmar_8h__dep__incl.svg" width="208" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="levmar_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef double(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="levmar_8h.html#ad844e903863007b2f33f73997a3492fe">LMfunction</a> )(int num, double input[])</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A functor to describe a function to be modeled.  <a href="#ad844e903863007b2f33f73997a3492fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef double(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="levmar_8h.html#ad8bf7a570ba4cd8b14c2047ff029ee75">LMJ</a> )(int num, int component, double input[])</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A functor to describe a derivative of the function to be modeled.  <a href="#ad8bf7a570ba4cd8b14c2047ff029ee75"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef double(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="levmar_8h.html#ae9e7f1ab84a06213aa834b0941a56d56">LMY</a> )(int num)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A functor to describe a result of the measurement.  <a href="#ae9e7f1ab84a06213aa834b0941a56d56"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="levmar_8h.html#ae375945301d982d75b3280e484cfb114">doLMFit</a> (int num, int dimention, <a class="el" href="levmar_8h.html#ad844e903863007b2f33f73997a3492fe">LMfunction</a> ff, <a class="el" href="levmar_8h.html#ae9e7f1ab84a06213aa834b0941a56d56">LMY</a> yf, <a class="el" href="levmar_8h.html#ad8bf7a570ba4cd8b14c2047ff029ee75">LMJ</a> Jf, double startGuess[], double *lastGuess, int iterations)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">this function runs the Levenberg-Marquardt non-linear least squares solutions  <a href="#ae375945301d982d75b3280e484cfb114"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This file is a header for the <a class="el" href="levmar_8c.html" title="This file contains the Levenberg-Marquardt algorithm for non-linear least squares solution...">levmar.c</a>. </p>
<dl class="date"><dt><b>Date:</b></dt><dd>May 22, 2009 </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Alexander Pimenov </dd></dl>

<p>Definition in file <a class="el" href="levmar_8h_source.html">levmar.h</a>.</p>
</div><hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ad844e903863007b2f33f73997a3492fe"></a><!-- doxytag: member="levmar.h::LMfunction" ref="ad844e903863007b2f33f73997a3492fe" args=")(int num, double input[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef double(* <a class="el" href="levmar_8h.html#ad844e903863007b2f33f73997a3492fe">LMfunction</a>)(int num, double input[])</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A functor to describe a function to be modeled. </p>

<p>Definition at line <a class="el" href="levmar_8h_source.html#l00022">22</a> of file <a class="el" href="levmar_8h_source.html">levmar.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad8bf7a570ba4cd8b14c2047ff029ee75"></a><!-- doxytag: member="levmar.h::LMJ" ref="ad8bf7a570ba4cd8b14c2047ff029ee75" args=")(int num, int component, double input[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef double(* <a class="el" href="levmar_8h.html#ad8bf7a570ba4cd8b14c2047ff029ee75">LMJ</a>)(int num, int component, double input[])</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A functor to describe a derivative of the function to be modeled. </p>

<p>Definition at line <a class="el" href="levmar_8h_source.html#l00027">27</a> of file <a class="el" href="levmar_8h_source.html">levmar.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae9e7f1ab84a06213aa834b0941a56d56"></a><!-- doxytag: member="levmar.h::LMY" ref="ae9e7f1ab84a06213aa834b0941a56d56" args=")(int num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef double(* <a class="el" href="levmar_8h.html#ae9e7f1ab84a06213aa834b0941a56d56">LMY</a>)(int num)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A functor to describe a result of the measurement. </p>

<p>Definition at line <a class="el" href="levmar_8h_source.html#l00031">31</a> of file <a class="el" href="levmar_8h_source.html">levmar.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae375945301d982d75b3280e484cfb114"></a><!-- doxytag: member="levmar.h::doLMFit" ref="ae375945301d982d75b3280e484cfb114" args="(int num, int dimention, LMfunction ff, LMY yf, LMJ Jf, double startGuess[], double *lastGuess, int iterations)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="levmar_8h.html#ae375945301d982d75b3280e484cfb114">doLMFit</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dimention</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="levmar_8h.html#ad844e903863007b2f33f73997a3492fe">LMfunction</a>&#160;</td>
          <td class="paramname"><em>ff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="levmar_8h.html#ae9e7f1ab84a06213aa834b0941a56d56">LMY</a>&#160;</td>
          <td class="paramname"><em>yf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="levmar_8h.html#ad8bf7a570ba4cd8b14c2047ff029ee75">LMJ</a>&#160;</td>
          <td class="paramname"><em>Jf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>startGuess</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>lastGuess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>iterations</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>this function runs the Levenberg-Marquardt non-linear least squares solutions </p>

<p>Definition at line <a class="el" href="levmar_8c_source.html#l00036">36</a> of file <a class="el" href="levmar_8c_source.html">levmar.c</a>.</p>

<p>References <a class="el" href="clegacy_2math_2matrix_8h_source.html#l00024">Matrix_TAG::data</a>, <a class="el" href="clegacy_2math_2levenmarq_8cpp_source.html#l00013">corecvs::dimention</a>, <a class="el" href="global_8h_source.html#l00153">dv_free</a>, <a class="el" href="global_8h_source.html#l00151">dv_malloc</a>, <a class="el" href="clegacy_2math_2matrix_8h_source.html#l00029">ELEM</a>, <a class="el" href="levmar_8c_source.html#l00027">LAMBDA_FACTOR</a>, <a class="el" href="matrix_8c_source.html#l00192">matrixCopy()</a>, <a class="el" href="matrix_8c_source.html#l00030">matrixCreate()</a>, <a class="el" href="matrix_8c_source.html#l00148">matrixMultiply()</a>, <a class="el" href="matrix_8c_source.html#l00252">matrixSolveGaussian()</a>, and <a class="el" href="matrix_8c_source.html#l00220">matrixTranspose()</a>.</p>
<div class="fragment"><pre class="fragment">{
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *D = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(num, 1);
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *J = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(num, <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>);
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *JT = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>, num);

        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *A = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>, <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>);
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *Asolve = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>, <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>);
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *B = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>, 1);
        <a class="code" href="structMatrix__TAG.html" title="This structure holds the arbitrary size dense matrix.">Matrix</a> *Bsolve = <a class="code" href="matrix_8c.html#a0d0b833ccf4ed9ab4ca0980824bb4554" title="This function creates a matrix with all zero elements.">matrixCreate</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>, 1);

        <span class="keywordtype">double</span> *newGuess = (<span class="keywordtype">double</span> *) <a class="code" href="global_8h.html#ab61c97956d31fb1b51bfea6441c979f7">dv_malloc</a>(<a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));

        <span class="keywordtype">double</span> lambda = 0.01;

<span class="preprocessor">#ifdef TRACE</span>
<span class="preprocessor"></span>        printf (<span class="stringliteral">&quot;Matrix created...&quot;</span>);
        printf (<span class="stringliteral">&quot;Starting LM optimization...\n\n=================================\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>        <span class="keywordtype">int</span> count = 1;
        <span class="keywordtype">int</span> i;
        <span class="keywordtype">double</span> norm = 0;

        <span class="keywordflow">for</span> (i = 0; i &lt; num; i++)
        {
                <span class="keywordtype">double</span> value = yf(i) - ff(i, startGuess);
                <a class="code" href="clegacy_2math_2matrix_8h.html#a44bf31bf4a2ae74bd43258779dc106ef" title="This macro is used for fast matrix access.">ELEM</a>(D, i, 0) = value;
                norm += value * value;
        }

        <span class="keywordflow">while</span> (count &lt; <a class="code" href="namespacecorecvs.html#afd8c20887e3a20aa7413ece03c16a387">iterations</a>)
        {
                <span class="comment">// Fill the matrices</span>
                <span class="keywordtype">int</span> j;
                <span class="keywordflow">for</span> (i = 0; i &lt; num; i++)
                {
                        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>; j++)
                        {
                                <span class="comment">//printf(&quot;dimention %d dirivative\n&quot;, j);</span>
                                fflush(stdout);
                                <span class="keywordtype">double</span> result = Jf(i,j, startGuess);
                                <a class="code" href="clegacy_2math_2matrix_8h.html#a44bf31bf4a2ae74bd43258779dc106ef" title="This macro is used for fast matrix access.">ELEM</a>(J, i,j) = result;
                        }
                }
                <span class="comment">// Now form the equation</span>
                <span class="comment">// (trans(J) * J) * delta = trans(J) * (y - f(x))</span>
                <a class="code" href="matrix_8c.html#ad279b845ad0feda9b8ce561de7c840e9" title="Transpose the matrix.">matrixTranspose</a>(J, JT);
                <a class="code" href="matrix_8c.html#a54708f2c7cb79a124d894d8e099c14a4" title="Multiplies the two matrices.">matrixMultiply</a>(JT, J, A);
                <span class="comment">//printf(&quot;D size is %lf\n&quot;, norm);</span>
                <a class="code" href="matrix_8c.html#a54708f2c7cb79a124d894d8e099c14a4" title="Multiplies the two matrices.">matrixMultiply</a>(JT, D, B);

                <span class="keywordtype">int</span> k;

                <span class="keywordflow">while</span> (lambda &lt; 1e12)
                {
                        <a class="code" href="matrix_8c.html#a981b747a54dd61d674f7e2529c6d7d43" title="Copies the matrix The destanation have to be prepared.">matrixCopy</a>(A, Asolve);
                        <a class="code" href="matrix_8c.html#a981b747a54dd61d674f7e2529c6d7d43" title="Copies the matrix The destanation have to be prepared.">matrixCopy</a>(B, Bsolve);


                        <span class="keywordflow">for</span> (k = 0; k &lt; <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>; k++)
                        {
                                Asolve-&gt;<a class="code" href="structMatrix__TAG.html#a2e1e8c7fc1511be9e0bb73f87b4de5c7" title="Matrix data line after the line.">data</a>[k * dimention + k] *= (1.0 + lambda );
                        }

                        <span class="keywordflow">if</span> (<a class="code" href="matrix_8c.html#a21268d8b254f878ff0aaf1b285dae9b1" title="Solves the linear equation.">matrixSolveGaussian</a>(Asolve, Bsolve) != 0 )
                        {
                                printf(<span class="stringliteral">&quot;OOPS\n&quot;</span>);
                        }

                        <span class="comment">// Prepare new  guess vector;</span>
                        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>; j++)
                                newGuess[j] = Bsolve-&gt;<a class="code" href="structMatrix__TAG.html#a2e1e8c7fc1511be9e0bb73f87b4de5c7" title="Matrix data line after the line.">data</a>[j]  + startGuess[j];

                        <span class="comment">// Evaluate new deviation.</span>
                        <span class="keywordtype">double</span> norm1 = 0;
                        for (i = 0; i &lt; num; i++)
                        {
                                <span class="keywordtype">double</span> value = yf(i) - ff(i, newGuess);
                                <a class="code" href="clegacy_2math_2matrix_8h.html#a44bf31bf4a2ae74bd43258779dc106ef" title="This macro is used for fast matrix access.">ELEM</a>(D, i, 0) = value;
                                norm1 += value * value;
                        }
<span class="preprocessor">#ifdef TRACE</span>
<span class="preprocessor"></span>                        printf(<span class="stringliteral">&quot;CV %s: %lf %s %lf :&quot;</span>, (norm &gt; norm1) ? <span class="stringliteral">&quot;REJ&quot;</span> : <span class="stringliteral">&quot;ACC&quot;</span>, norm, (norm &gt; norm1) ? <span class="stringliteral">&quot;&gt;&quot;</span> : <span class="stringliteral">&quot;&lt;&quot;</span> ,norm1 );
                        <span class="comment">//printf(&quot;CV %lf  %lf :&quot;, norm, norm1 );</span>
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
                        <span class="comment">// Print new  guess vector;</span>
                        <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>; j++)
                        {
                                printf (<span class="stringliteral">&quot;%lf &quot;</span>, Bsolve-&gt;<a class="code" href="structMatrix__TAG.html#a2e1e8c7fc1511be9e0bb73f87b4de5c7" title="Matrix data line after the line.">data</a>[j]);
                        }
                        printf(<span class="stringliteral">&quot;\n&quot;</span>);
                        fflush(stdout);


                        <span class="keywordflow">if</span> (norm1 &lt; norm) <span class="comment">// If the currnet solution is better</span>
                        {
                                <span class="comment">//printf(&quot;Current solution is better&quot;);</span>
                                lambda /= <a class="code" href="levmar_8c.html#ab52fb0465ef96acb557e112564db396e">LAMBDA_FACTOR</a>;
                                <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="namespacecorecvs.html#a7ac74dea038e6ee901ef65423a8f4142">dimention</a>; j++)
                                {
                                        startGuess[j] = newGuess[j];
                                }
                                norm = norm1;
                                <span class="keywordflow">break</span>;
                        }
                        <span class="keywordflow">else</span>
                        {
<span class="preprocessor">#ifdef DEEP_TRACE</span>
<span class="preprocessor"></span>                                printf(<span class="stringliteral">&quot;Current solution is worse. Try new lambda\n&quot;</span>);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                                lambda *= <a class="code" href="levmar_8c.html#ab52fb0465ef96acb557e112564db396e">LAMBDA_FACTOR</a>;
                        }
                }

                <span class="comment">//printf(&quot;\n&quot;);</span>
                count ++;
        }
        <span class="keywordflow">if</span> (lastGuess != NULL)
        {
                memcpy (lastGuess, newGuess, dimention * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
                <a class="code" href="global_8h.html#af122ce751a03e5f7b15a5f2a9f622eb4">dv_free</a>(newGuess);
        }

        <span class="keywordflow">return</span> norm;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="levmar_8h_ae375945301d982d75b3280e484cfb114_cgraph.svg" width="288" height="254"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:40 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
