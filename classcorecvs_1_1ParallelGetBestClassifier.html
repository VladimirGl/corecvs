<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: corecvs::ParallelGetBestClassifier Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespacecorecvs.html">corecvs</a>      </li>
      <li class="navelem"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html">ParallelGetBestClassifier</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">corecvs::ParallelGetBestClassifier Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="corecvs::ParallelGetBestClassifier" --><div class="dynheader">
Collaboration diagram for corecvs::ParallelGetBestClassifier:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classcorecvs_1_1ParallelGetBestClassifier__coll__graph.svg" width="100%" height="351"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classcorecvs_1_1ParallelGetBestClassifier-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#ae0106608c86e4755869a9115b483956e">ParallelGetBestClassifier</a> (const <a class="el" href="classcorecvs_1_1AdaBoostInput.html">AdaBoostInput</a>&lt; <a class="el" href="classcorecvs_1_1VJInputImage.html">VJInputImage</a> &gt; &amp;_inputs, <a class="el" href="classcorecvs_1_1VJSimpleClassifierGenerator.html">VJSimpleClassifierGenerator</a> *_gen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#a170ad9c68061bcc25edc2da47dbbc54d">operator()</a> (const <a class="el" href="classcorecvs_1_1BlockedRange.html">BlockedRange</a>&lt; unsigned &gt; &amp;r) const </td></tr>
<tr><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classcorecvs_1_1AdaBoostInput.html">AdaBoostInput</a><br class="typebreak"/>
&lt; <a class="el" href="classcorecvs_1_1VJInputImage.html">VJInputImage</a> &gt; &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">inputs</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="classcorecvs_1_1VJSimpleClassifierGenerator.html">VJSimpleClassifierGenerator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="vjPattern_8cpp_source.html#l00026">26</a> of file <a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae0106608c86e4755869a9115b483956e"></a><!-- doxytag: member="corecvs::ParallelGetBestClassifier::ParallelGetBestClassifier" ref="ae0106608c86e4755869a9115b483956e" args="(const AdaBoostInput&lt; VJInputImage &gt; &amp;_inputs, VJSimpleClassifierGenerator *_gen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#ae0106608c86e4755869a9115b483956e">corecvs::ParallelGetBestClassifier::ParallelGetBestClassifier</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classcorecvs_1_1AdaBoostInput.html">AdaBoostInput</a>&lt; <a class="el" href="classcorecvs_1_1VJInputImage.html">VJInputImage</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>_inputs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classcorecvs_1_1VJSimpleClassifierGenerator.html">VJSimpleClassifierGenerator</a> *&#160;</td>
          <td class="paramname"><em>_gen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vjPattern_8cpp_source.html#l00033">33</a> of file <a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a>.</p>
<div class="fragment"><pre class="fragment">                                               :
        <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">inputs</a>(_inputs),
        <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>(_gen)
    {}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a170ad9c68061bcc25edc2da47dbbc54d"></a><!-- doxytag: member="corecvs::ParallelGetBestClassifier::operator()" ref="a170ad9c68061bcc25edc2da47dbbc54d" args="(const BlockedRange&lt; unsigned &gt; &amp;r) const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void corecvs::ParallelGetBestClassifier::operator() </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classcorecvs_1_1BlockedRange.html">BlockedRange</a>&lt; unsigned &gt; &amp;&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td> const<code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Now we should find the best threshold start with the one lower then the lowest result.</p>
<p>Calculate the epsilon of the error assuming all the results are predicted as faces</p>
<p>Now move threshold over the results from the list and see how epsilon changes</p>
<p>If we step over the real face we should be punished otherwise rewarded</p>

<p>Definition at line <a class="el" href="vjPattern_8cpp_source.html#l00041">41</a> of file <a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a>.</p>

<p>References <a class="el" href="vjPattern_8h_source.html#l00079">corecvs::VJPattern::applyToPoint()</a>, <a class="el" href="tbbWrapper_8h_source.html#l00043">corecvs::BlockedRange&lt; IndexType &gt;::begin()</a>, <a class="el" href="vjPattern_8h_source.html#l00587">corecvs::VJSimpleClassifierGenerator::bestPattern</a>, <a class="el" href="vjPattern_8h_source.html#l00588">corecvs::VJSimpleClassifierGenerator::bestZ</a>, <a class="el" href="tbbWrapper_8h_source.html#l00038">corecvs::BlockedRange&lt; IndexType &gt;::end()</a>, <a class="el" href="vjPattern_8cpp_source.html#l00029">gen</a>, <a class="el" href="vjPattern_8h_source.html#l00593">corecvs::VJSimpleClassifierGenerator::generators</a>, <a class="el" href="vjPattern_8h_source.html#l00590">corecvs::VJSimpleClassifierGenerator::globalCount</a>, <a class="el" href="vjPattern_8h_source.html#l00568">corecvs::VJResult::inputData</a>, <a class="el" href="vjPattern_8cpp_source.html#l00028">inputs</a>, <a class="el" href="vjPattern_8h_source.html#l00049">corecvs::VJInputImage::integral</a>, <a class="el" href="vjPattern_8h_source.html#l00586">corecvs::VJSimpleClassifierGenerator::minEpsilonGlobal</a>, <a class="el" href="adaBoost_8h_source.html#l00044">corecvs::AdaBoostInputData&lt; InputType &gt;::weight</a>, <a class="el" href="adaBoost_8h_source.html#l00042">corecvs::AdaBoostInputData&lt; InputType &gt;::x</a>, and <a class="el" href="adaBoost_8h_source.html#l00043">corecvs::AdaBoostInputData&lt; InputType &gt;::y</a>.</p>
<div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> iteration = r.<a class="code" href="classcorecvs_1_1BlockedRange.html#a6afc35b5d0d32070559723d5bb0a4f73">begin</a>(); iteration  &lt; r.<a class="code" href="classcorecvs_1_1BlockedRange.html#a6f7301fc298a428dde190df3e30551f7">end</a>(); iteration++)
        {
            vector&lt;VJResult&gt; results;
            results.reserve(<a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">inputs</a>.size());

            <span class="comment">/*Choosing random VJ pattern form one of the generators*/</span>
            <a class="code" href="classcorecvs_1_1VJPattern.html" title="Viola-Jones generic Haar wavelet.">VJPattern</a> *currentPattern = <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#ae54a2036207ffca5fadf105779ce58c8">generators</a>[rand() % <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#ae54a2036207ffca5fadf105779ce58c8">generators</a>.size()]-&gt;pattern();

            results.clear();
            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i = 0; i &lt; (<span class="keywordtype">unsigned</span> long)<a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">inputs</a>.size(); i++)
            {
                <span class="keyword">const</span> <a class="code" href="classcorecvs_1_1AdaBoostInputData.html">AdaBoostInputData&lt;VJInputImage&gt;</a> *data = &amp;<a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">inputs</a>[i];
                <a class="code" href="classcorecvs_1_1G12IntegralBuffer.html">G12IntegralBuffer</a> *integral = data-&gt;<a class="code" href="classcorecvs_1_1AdaBoostInputData.html#a10d8b616c354c57fe6f2e2fbb2b30c75" title="The input.">x</a>.<a class="code" href="classcorecvs_1_1VJInputImage.html#aceed79fb6693d6a7bd0509d81d783642">integral</a>;
                <span class="keywordtype">int</span> value = currentPattern-&gt;<a class="code" href="classcorecvs_1_1VJPattern.html#a75cf7fa5f71d5adb2204daa1060da5a2">applyToPoint</a>(integral,0,0);
                <a class="code" href="classcorecvs_1_1VJResult.html" title="AnyPattern2.">VJResult</a> result = <a class="code" href="classcorecvs_1_1VJResult.html" title="AnyPattern2.">VJResult</a>(value, data);
                results.push_back(result);
            }

            sort(results.begin(), results.end());
<span class="comment"></span>
<span class="comment">            /**</span>
<span class="comment">             *  Now we should find the best threshold start with the one lower</span>
<span class="comment">             *  then the lowest result.</span>
<span class="comment">             *</span>
<span class="comment">             **/</span>

            <span class="keywordtype">int</span> threshold = results[0].value - 1;
<span class="comment"></span>
<span class="comment">            /**</span>
<span class="comment">             * Calculate the epsilon of the error assuming all the</span>
<span class="comment">             * results are predicted as faces</span>
<span class="comment">             **/</span>
            <span class="keywordtype">double</span> startEpsilon = 0;
            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; results.size(); i++)
            {

                <span class="keywordflow">if</span> (! results[i].inputData-&gt;y)
                    startEpsilon += results[i].inputData-&gt;weight;
            }

            <span class="keywordtype">double</span> minEpsilon = startEpsilon;
            <span class="keywordtype">double</span> currentEpsilon = startEpsilon;
<span class="comment"></span>
<span class="comment">            /**</span>
<span class="comment">             * Now move threshold over the results from the list and</span>
<span class="comment">             * see how epsilon changes</span>
<span class="comment">             **/</span>
            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; results.size(); i++)
            {
                <a class="code" href="classcorecvs_1_1VJResult.html" title="AnyPattern2.">VJResult</a> *result = &amp;(results[i]);
<span class="comment"></span>
<span class="comment">                /**</span>
<span class="comment">                 * If we step over the real face we should be punished</span>
<span class="comment">                 * otherwise rewarded</span>
<span class="comment">                 **/</span>
                <span class="keywordflow">if</span> (result-&gt;<a class="code" href="classcorecvs_1_1VJResult.html#a2cd695d168d6584cc340f416412cd755">inputData</a>-&gt;<a class="code" href="classcorecvs_1_1AdaBoostInputData.html#aee99d54a593e069342df31704b182f65" title="Class to which input belongs.">y</a>)
                    currentEpsilon += result-&gt;<a class="code" href="classcorecvs_1_1VJResult.html#a2cd695d168d6584cc340f416412cd755">inputData</a>-&gt;<a class="code" href="classcorecvs_1_1AdaBoostInputData.html#a69c2db83d5d8a314e79e62643b8fc1ce" title="Current weight.">weight</a>;
                <span class="keywordflow">else</span>
                    currentEpsilon -= result-&gt;<a class="code" href="classcorecvs_1_1VJResult.html#a2cd695d168d6584cc340f416412cd755">inputData</a>-&gt;<a class="code" href="classcorecvs_1_1AdaBoostInputData.html#a69c2db83d5d8a314e79e62643b8fc1ce" title="Current weight.">weight</a>;

                <span class="keywordflow">if</span> (currentEpsilon &lt; minEpsilon)
                {
                    minEpsilon = currentEpsilon;
                    <span class="keywordflow">if</span> (i &lt; (results.size() - 1))
                    {
                        <span class="comment">// threshold = results[i].result;</span>
                        threshold = (results[i].value + results[i + 1].value) / 2;
                    }
                    <span class="keywordflow">else</span>
                    {
                        threshold = results[i].value;
                    }
                }
            }
            <span class="comment">/* TODO: Replace this with reduce operation */</span>
<span class="preprocessor">#ifdef WITH_TBB</span>
<span class="preprocessor"></span>            spin_mutex::scoped_lock lock;
            lock.acquire(<a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;VJSimpleClassifierGeneratorMutex);
            {
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (minEpsilon &lt; gen-&gt;minEpsilonGlobal)
                {
                    <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#ad0f503a407555fdd3b23d6a46164143d">minEpsilonGlobal</a> = minEpsilon;
                    <a class="code" href="classcorecvs_1_1VJPattern.html" title="Viola-Jones generic Haar wavelet.">VJPattern</a> *tmp = <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a55e186967b4946b8d12537ffe219a623">bestPattern</a>;
                    <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a55e186967b4946b8d12537ffe219a623">bestPattern</a> = currentPattern;
                    currentPattern = tmp;
                    <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a3f7496405e530cccab88edc102b78be0">bestZ</a> = threshold;
                }

                <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a956c883e86de1e41bdb79700acda4c62">globalCount</a>++;
                <span class="keywordflow">if</span> (<a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a956c883e86de1e41bdb79700acda4c62">globalCount</a> % 500 == 0)
                {
                    printf(<span class="stringliteral">&quot;Pattern attempt %d\n&quot;</span>, <a class="code" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">gen</a>-&gt;<a class="code" href="classcorecvs_1_1VJSimpleClassifierGenerator.html#a956c883e86de1e41bdb79700acda4c62">globalCount</a>);
                    fflush(stdout);
                }
<span class="preprocessor">#ifdef WITH_TBB</span>
<span class="preprocessor"></span>            }
            lock.release();
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
            <span class="keywordflow">if</span> (currentPattern != NULL)
                <span class="keyword">delete</span> currentPattern;
        }
    }
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="classcorecvs_1_1ParallelGetBestClassifier_a170ad9c68061bcc25edc2da47dbbc54d_cgraph.svg" width="100%" height="150"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="aaa014414bc309cc1880712dffe51eb20"></a><!-- doxytag: member="corecvs::ParallelGetBestClassifier::gen" ref="aaa014414bc309cc1880712dffe51eb20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcorecvs_1_1VJSimpleClassifierGenerator.html">VJSimpleClassifierGenerator</a>* <a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#aaa014414bc309cc1880712dffe51eb20">corecvs::ParallelGetBestClassifier::gen</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vjPattern_8cpp_source.html#l00029">29</a> of file <a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a>.</p>

<p>Referenced by <a class="el" href="vjPattern_8cpp_source.html#l00041">operator()()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a58843d120bba9bf6e802e078f321b0"></a><!-- doxytag: member="corecvs::ParallelGetBestClassifier::inputs" ref="a2a58843d120bba9bf6e802e078f321b0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classcorecvs_1_1AdaBoostInput.html">AdaBoostInput</a>&lt;<a class="el" href="classcorecvs_1_1VJInputImage.html">VJInputImage</a>&gt;&amp; <a class="el" href="classcorecvs_1_1ParallelGetBestClassifier.html#a2a58843d120bba9bf6e802e078f321b0">corecvs::ParallelGetBestClassifier::inputs</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vjPattern_8cpp_source.html#l00028">28</a> of file <a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a>.</p>

<p>Referenced by <a class="el" href="vjPattern_8cpp_source.html#l00041">operator()()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>core/boosting/<a class="el" href="vjPattern_8cpp_source.html">vjPattern.cpp</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:48 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
