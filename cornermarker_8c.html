<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: core/clegacy/cornermarker.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">core/clegacy/cornermarker.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file helps to highlight corners and interesting points to track on the image.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="cornermarker_8h_source.html">cornermarker.h</a>&quot;</code><br/>
<code>#include &quot;g12buffer.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="global_8h_source.html">global.h</a>&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for cornermarker.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="cornermarker_8c__incl.svg" width="459" height="195"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="cornermarker_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a>&#160;&#160;&#160;2</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">G12Buffer *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cornermarker_8c.html#acc5512037b03eb87d36dc61d47402406">findCornerPoints</a> (G12Buffer *input)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Highlights corners and interesting points to track on the image.  <a href="#acc5512037b03eb87d36dc61d47402406"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a> [2 *<a class="el" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a>+1]</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>This file helps to highlight corners and interesting points to track on the image. </p>
<dl class="date"><dt><b>Date:</b></dt><dd>Jun 3, 2009 </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Alexander Pimenov </dd></dl>

<p>Definition in file <a class="el" href="cornermarker_8c_source.html">cornermarker.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="ada3e6a50905d7a5add1566cdc742be1c"></a><!-- doxytag: member="cornermarker.c::APPERTURE" ref="ada3e6a50905d7a5add1566cdc742be1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define <a class="el" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a>&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cornermarker_8c_source.html#l00017">17</a> of file <a class="el" href="cornermarker_8c_source.html">cornermarker.c</a>.</p>

<p>Referenced by <a class="el" href="cornermarker_8c_source.html#l00040">findCornerPoints()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acc5512037b03eb87d36dc61d47402406"></a><!-- doxytag: member="cornermarker.c::findCornerPoints" ref="acc5512037b03eb87d36dc61d47402406" args="(G12Buffer *input)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">G12Buffer* <a class="el" href="cornermarker_8c.html#acc5512037b03eb87d36dc61d47402406">findCornerPoints</a> </td>
          <td>(</td>
          <td class="paramtype">G12Buffer *&#160;</td>
          <td class="paramname"><em>input</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Highlights corners and interesting points to track on the image. </p>
<p>The algorithm is used form here -</p>
<p><a href="http://en.wikipedia.org/wiki/Corner_detection#The_Harris_.26_Stephens_.2F_Plessey_corner_detection_algorithm">http://en.wikipedia.org/wiki/Corner_detection#The_Harris_.26_Stephens_.2F_Plessey_corner_detection_algorithm</a></p>
<p>This thing is only needed for recognizing calibration patterns. So no optimizations are done</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>this parameter stores an input image </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>will hold the resulting image with highlighted corners. The more is the value the more the pixel looks like a corner. </dd></dl>

<p>Definition at line <a class="el" href="cornermarker_8c_source.html#l00040">40</a> of file <a class="el" href="cornermarker_8c_source.html">cornermarker.c</a>.</p>

<p>References <a class="el" href="cornermarker_8c_source.html#l00017">APPERTURE</a>, and <a class="el" href="cornermarker_8c_source.html#l00018">weight</a>.</p>
<div class="fragment"><pre class="fragment">{
        <span class="keywordtype">int</span> h = input-&gt;h;
        <span class="keywordtype">int</span> w = input-&gt;w;
        <span class="keywordtype">int</span> i,j,k;

        <span class="comment">/*double *dx   = (double *)calloc(h * w, sizeof(double));</span>
<span class="comment">        double *dy   = (double *)calOtherAlgebraloc(h * w, sizeof(double));*/</span>
        <span class="keywordtype">double</span> *dxdx = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *dydy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *dxdy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));

        <span class="keywordtype">double</span> *sumhdxdx = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *sumhdydy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *sumhdxdy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));

        <span class="keywordtype">double</span> *sumdxdx = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *sumdydy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
        <span class="keywordtype">double</span> *sumdxdy = (<span class="keywordtype">double</span> *)calloc(h * w, <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));


        G12Buffer *result = g12BufferCreate(h,w);


        <span class="keywordflow">for</span> (i = 1; i &lt; h; i++)
        {
                <span class="keywordflow">for</span> (j = 1; j &lt; w; j++)
                {
                        <span class="keywordtype">double</span> cdx;
                        <span class="keywordtype">double</span> cdy;
                        cdx =   ( - (double)input-&gt;data[(i - 1) * w + j - 1] + input-&gt;data[(i - 1) * w + j + 1]
                                      + 2 * ( - input-&gt;data[      i * w + j - 1] + input-&gt;data[      i * w + j + 1])
                                                      - input-&gt;data[(i + 1) * w + j - 1] + input-&gt;data[(i + 1) * w + j + 1]) / 8.0;
                        cdy =   ( - (double)input-&gt;data[(i - 1) * w + j - 1] + input-&gt;data[(i + 1) * w + j - 1]
                                         + 2 * ( - input-&gt;data[(i - 1) * w + j    ] + input-&gt;data[(i + 1) * w + j    ])
                                          - input-&gt;data[(i - 1) * w + j + 1] + input-&gt;data[(i + 1) * w + j + 1]) / 8.0;
                        <span class="comment">/*dx  [i * w + j] = cdx;</span>
<span class="comment">                        dy  [i * w + j] = cdy;*/</span>
                        dxdx[i * w + j] = cdx * cdx;
                        dydy[i * w + j] = cdy * cdy;
                        dxdy[i * w + j] = cdx * cdy;
                }
        }



        <span class="keywordflow">for</span> (i = 1; i &lt; h - 1; i++)
        {
                <span class="keywordflow">for</span> (j = <a class="code" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a> ; j &lt; w - <a class="code" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a> ; j++)
                {
                        <span class="keywordtype">int</span> wcount = 0;
                        <span class="keywordflow">for</span> (k = -APPERTURE ; k &lt;= <a class="code" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a> ; k++, wcount++)
                        {
                                sumhdxdx[i * w + j] += (dxdx[i * w + j + k] / ( 2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                                sumhdydy[i * w + j] += (dydy[i * w + j + k] / ( 2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                                sumhdxdy[i * w + j] += (dxdy[i * w + j + k] / ( 2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                        }
                }
        }

        free (dxdx);
        free (dydy);
        free (dxdy);


        <span class="keywordflow">for</span> (i = APPERTURE; i &lt; h - <a class="code" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a> ; i++)
        {
                <span class="keywordflow">for</span> (j = 1 ; j &lt; w - 1; j++)
                {
                        <span class="keywordtype">int</span> wcount = 0;
                        <span class="keywordflow">for</span> (k = -APPERTURE  ; k &lt;= <a class="code" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a> ; k++, wcount++)
                        {
                                sumdxdx[i * w + j] += (sumhdxdx[(i + k) * w + j] / (2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                                sumdydy[i * w + j] += (sumhdydy[(i + k) * w + j] / (2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                                sumdxdy[i * w + j] += (sumhdxdy[(i + k) * w + j] / (2 * APPERTURE + 1)) * <a class="code" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[wcount];
                        }
                }
        }

        free (sumhdxdx);
        free (sumhdydy);
        free (sumhdxdy);



        <span class="keywordflow">for</span> (i = 5; i &lt; h - 5; i++)
        {
                <span class="keywordflow">for</span> (j = 5; j &lt; w - 5; j++)
                {
                        <span class="comment">// Counting eigenvalues</span>
                        <span class="keywordtype">double</span> a = 1;
                        <span class="keywordtype">double</span> b = - (sumdxdx[i * w + j] + sumdydy[i * w + j]);
                        <span class="keywordtype">double</span> c = sumdxdx[i * w + j] * sumdydy[i * w + j] - sumdxdy[i * w + j] * sumdxdy[i * w + j];

                        <span class="comment">/* TODO: solve quadric to other class*/</span>
                        <span class="keywordtype">double</span> D = b * b - 4 * a * c;
                        <span class="keywordflow">if</span> (D &lt; 0)
                        {
                                result-&gt;data[i * w + j] = 0;
                        }
                        <span class="keywordflow">else</span>
                        {
                                <span class="keywordtype">double</span> lambda1 = (-b + sqrt(D)) / (2 * a);
                                <span class="keywordtype">double</span> lambda2 = (-b - sqrt(D)) / (2 * a);
                                <span class="keywordflow">if</span> (lambda1 &gt; 2000 &amp;&amp; lambda2 &gt; 2000)
                                {
                                        result-&gt;data[i * w + j] = (lambda1 * lambda2)  / (1000.0 * 1000.0);
                                }
                        }
                }
        }

        free (sumdxdx);
        free (sumdydy);
        free (sumdxdy);
        <span class="keywordflow">return</span> result;

}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ad40c6e6341133bcb921a1a748c25be68"></a><!-- doxytag: member="cornermarker.c::weight" ref="ad40c6e6341133bcb921a1a748c25be68" args="[2 *APPERTURE+1]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="cornermarker_8c.html#ad40c6e6341133bcb921a1a748c25be68">weight</a>[2 *<a class="el" href="cornermarker_8c.html#ada3e6a50905d7a5add1566cdc742be1c">APPERTURE</a>+1]</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment">
        {1.0 / 10,
         2.0 / 10,
         4.0 / 10,
         2.0 / 10,
         1.0 / 10 }
</pre></div>
<p>Definition at line <a class="el" href="cornermarker_8c_source.html#l00018">18</a> of file <a class="el" href="cornermarker_8c_source.html">cornermarker.c</a>.</p>

<p>Referenced by <a class="el" href="cornermarker_8c_source.html#l00040">findCornerPoints()</a>, <a class="el" href="histogram_8h_source.html#l00218">corecvs::Histogram::getBottomInterval()</a>, and <a class="el" href="histogram_8h_source.html#l00197">corecvs::Histogram::getTopInterval()</a>.</p>

</div>
</div>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:39 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
