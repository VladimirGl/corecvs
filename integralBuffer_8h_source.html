<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: core/buffers/integralBuffer.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">core/buffers/integralBuffer.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="integralBuffer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef INTERGALBUFFER_H_</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define INTERGALBUFFER_H_</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="comment">/**</span>
<a name="l00004"></a>00004 <span class="comment"> * \file integralBuffer.h</span>
<a name="l00005"></a>00005 <span class="comment"> * \brief –ê header for IntergalBuffer.c</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * This file holds methods and data structures to support IntegralBuffer optimisation</span>
<a name="l00008"></a>00008 <span class="comment"> * for Viola-Jones optimizations</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * \ingroup cppcorefiles</span>
<a name="l00013"></a>00013 <span class="comment"> * \date Feb 23, 2010</span>
<a name="l00014"></a>00014 <span class="comment"> * \author: alexander</span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#ifdef WITH_SSE</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#include &lt;emmintrin.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;sseWrapper.h&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#endif</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="global_8h.html" title="This file holds the global includes, mostly for debuging, tracing and profiling.">global.h</a>&quot;</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="abstractBuffer_8h.html" title="a header for AbstractBuffer.cpp">abstractBuffer.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="g12Buffer_8h.html" title="This file holds the class description for 12 bit grayscale buffer.">g12Buffer.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="g8Buffer_8h.html" title="Add Comment Here.">g8Buffer.h</a>&quot;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="tbbWrapper_8h.html" title="This is a class that provides common TBB interface.">tbbWrapper.h</a>&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="keyword">namespace </span>corecvs {
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment"></span>
<a name="l00033"></a>00033 <span class="comment"> /**</span>
<a name="l00034"></a>00034 <span class="comment">  *</span>
<a name="l00035"></a>00035 <span class="comment">  * So each element of the integral buffer will hold the sum of the elements in a rectangle</span>
<a name="l00036"></a>00036 <span class="comment">  *</span>
<a name="l00037"></a>00037 <span class="comment">  *</span>
<a name="l00038"></a>00038 <span class="comment">  * \f[ Integ(x,y) = \sum_{i=0, j=0}^{j&lt;x,i&lt;y} I(j,i) \f]</span>
<a name="l00039"></a>00039 <span class="comment">  *</span>
<a name="l00040"></a>00040 <span class="comment">  **/</span>
<a name="l00041"></a>00041 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> ElementType, <span class="keyword">typename</span> BaseElementType, <span class="keyword">typename</span> IndexType&gt;
<a name="l00042"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html">00042</a> <span class="keyword">class </span><a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer</a> : <span class="keyword">public</span> <a class="code" href="classcorecvs_1_1AbstractBuffer.html" title="This is a common buffer template.">AbstractBuffer</a>&lt;ElementType, IndexType&gt; {
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">public</span>:
<a name="l00045"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#a9a3e33d010c94383072a6ab4c1602743">00045</a>     <span class="keyword">typedef</span> BaseElementType <a class="code" href="classcorecvs_1_1IntegralBuffer.html#a9a3e33d010c94383072a6ab4c1602743">InternalBaseElementType</a>;
<a name="l00046"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#a54397b8655350e5a24bed89a02a5f7d0">00046</a>     <span class="keyword">typedef</span> <a class="code" href="classcorecvs_1_1AbstractBuffer.html" title="This is a common buffer template.">AbstractBuffer&lt;BaseElementType, IndexType&gt;</a> <a class="code" href="classcorecvs_1_1IntegralBuffer.html#a54397b8655350e5a24bed89a02a5f7d0">SourceBufferType</a>;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#aac154afa11610789bc4685b3aaf85dd1">00049</a>     <a class="code" href="classcorecvs_1_1IntegralBuffer.html#aac154afa11610789bc4685b3aaf85dd1">IntegralBuffer</a>(<a class="code" href="classcorecvs_1_1AbstractBuffer.html" title="This is a common buffer template.">SourceBufferType</a> *input) :
<a name="l00050"></a>00050         <a class="code" href="classcorecvs_1_1AbstractBuffer.html" title="This is a common buffer template.">AbstractBuffer</a>&lt;<a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a>, IndexType&gt;(input-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a> + 1, input-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a> + 1, false)
<a name="l00051"></a>00051     {
<a name="l00052"></a>00052         IndexType i,j;
<a name="l00053"></a>00053         <span class="comment">// Scan the first line and column</span>
<a name="l00054"></a>00054         <span class="keywordflow">for</span> (j = 0; j &lt; this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a014b2b876125245234f7fcb13c6d02e9" title="Width getter.">getW</a>(); j++)
<a name="l00055"></a>00055             this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(0, j) = <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a>(0);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="keywordflow">for</span> (i = 0; i &lt; this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#ac9b5c7ae6adbc2d21b3d5fd7813992f6" title="Height getter.">getH</a>(); i++)
<a name="l00058"></a>00058             this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(i, 0) = <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a>(0);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060         <span class="comment">// Scan all the picture</span>
<a name="l00061"></a>00061         <span class="keywordflow">for</span> (i = 1; i &lt; this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#ac9b5c7ae6adbc2d21b3d5fd7813992f6" title="Height getter.">getH</a>(); i++)
<a name="l00062"></a>00062         {
<a name="l00063"></a>00063             <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> sum(0);
<a name="l00064"></a>00064             BaseElementType * baseOffset      = &amp;(input-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(i - 1, 0));
<a name="l00065"></a>00065             <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a>     * currentOffset   = &amp;(this-&gt; <a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(i    , 1));
<a name="l00066"></a>00066             <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a>     * prevOffset      = &amp;(this-&gt; <a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(i - 1, 1));
<a name="l00067"></a>00067 
<a name="l00068"></a>00068             <span class="keywordflow">for</span> (j = 1; j &lt; this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a014b2b876125245234f7fcb13c6d02e9" title="Width getter.">getW</a>(); j ++)
<a name="l00069"></a>00069             {
<a name="l00070"></a>00070 <span class="preprocessor">#ifdef ASSERTS</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="comment">//                ElementType test_sum = sum + input-&gt;element(i, j);</span>
<a name="l00072"></a>00072 <span class="comment">//                ASSERT_FALSE((test_sum &lt; sum || test_sum &lt; input-&gt;element(i, j)), &quot;Overflow while creating the integral buffer&quot;);</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="preprocessor">#endif</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>                sum += *baseOffset;
<a name="l00076"></a>00076                 *currentOffset = sum + *prevOffset;
<a name="l00077"></a>00077                 baseOffset++;
<a name="l00078"></a>00078                 currentOffset++;
<a name="l00079"></a>00079                 prevOffset++;
<a name="l00080"></a>00080             }
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084 <span class="comment"></span>
<a name="l00085"></a>00085 <span class="comment">    /**</span>
<a name="l00086"></a>00086 <span class="comment">     * This function returns the size of the buffer from which the intergal buffer was produced.</span>
<a name="l00087"></a>00087 <span class="comment">     *</span>
<a name="l00088"></a>00088 <span class="comment">     * */</span>
<a name="l00089"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#aed8022564c8de2b7f4c2d808209049c7">00089</a>     IndexType <a class="code" href="classcorecvs_1_1IntegralBuffer.html#aed8022564c8de2b7f4c2d808209049c7" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveH</a>()<span class="keyword"> const</span>
<a name="l00090"></a>00090 <span class="keyword">    </span>{
<a name="l00091"></a>00091         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a88e969182e3f07bb3600de841b409e9b">h</a> - 1;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 <span class="comment"></span>
<a name="l00094"></a>00094 <span class="comment">    /**</span>
<a name="l00095"></a>00095 <span class="comment">     * This function returns the size of the buffer from which the intergal buffer was produced.</span>
<a name="l00096"></a>00096 <span class="comment">     *</span>
<a name="l00097"></a>00097 <span class="comment">     * */</span>
<a name="l00098"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#af302bfac4741525136af3f895d1c0351">00098</a>     IndexType <a class="code" href="classcorecvs_1_1IntegralBuffer.html#af302bfac4741525136af3f895d1c0351" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveW</a>()<span class="keyword"> const</span>
<a name="l00099"></a>00099 <span class="keyword">    </span>{
<a name="l00100"></a>00100         <span class="keywordflow">return</span> this-&gt;<a class="code" href="classcorecvs_1_1AbstractBufferParams.html#a7ff3d372b9a613e451a379a4427e2623">w</a> - 1;
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 <span class="comment"></span>
<a name="l00103"></a>00103 <span class="comment">  /**</span>
<a name="l00104"></a>00104 <span class="comment">  *  This function calculates the sum inside the rectangle</span>
<a name="l00105"></a>00105 <span class="comment">     With the structure of the intergal buffer it can be done in 4 random accesses</span>
<a name="l00106"></a>00106 <span class="comment"></span>
<a name="l00107"></a>00107 <span class="comment">     \f[ \sum_{x=x_0}^{x &lt;= x_1}\sum_{y=y_0}^{y &lt;= y_1} I(x,y) = Integ(x_1 + 1, y_1 + 1) + Integ(x_0, y_0) - Integ(x_1 + 1, y_0) - Integ(x_0, y_1 + 1) \f]</span>
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">  **/</span>
<a name="l00110"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#ab49b84b64c6ddbef63134a4428b7cab3">00110</a>     <span class="keyword">inline</span> <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> <a class="code" href="classcorecvs_1_1IntegralBuffer.html#ab49b84b64c6ddbef63134a4428b7cab3" title="This function calculates the sum inside the rectangle With the structure of the intergal buffer it ca...">rectangle</a> (IndexType x1, IndexType y1, IndexType x2, IndexType y2)
<a name="l00111"></a>00111     {
<a name="l00112"></a>00112         <span class="keywordflow">return</span>    this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1, x1    ) + this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1, x2 + 1)
<a name="l00113"></a>00113                 - this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1, x2 + 1) - this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1, x1);
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> ReturnType&gt;
<a name="l00117"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html">00117</a>     <span class="keyword">class </span><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html">ParallelRectangularBlur</a>
<a name="l00118"></a>00118     {
<a name="l00119"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aa5f32b903389c9498fe32b2e6240a451">00119</a>         ReturnType *<a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aa5f32b903389c9498fe32b2e6240a451">toReturn</a>;
<a name="l00120"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aea7000140c033b0b0a7189a2b7c4808d">00120</a>         IndexType <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aea7000140c033b0b0a7189a2b7c4808d">hSizeHalf</a>;
<a name="l00121"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a4c828cb4dce1cee51abfa32d42dda764">00121</a>         IndexType <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a4c828cb4dce1cee51abfa32d42dda764">wSizeHalf</a>;
<a name="l00122"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a81c7fec5b6ed8902ece6eae94b1f5dbc">00122</a>         <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer&lt;ElementType, BaseElementType, IndexType&gt;</a> *<a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a81c7fec5b6ed8902ece6eae94b1f5dbc">buf</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124     <span class="keyword">public</span>:
<a name="l00125"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a8aa35be2e469f61dabf48f66ba9e9db3">00125</a>         <span class="keywordtype">void</span> <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a8aa35be2e469f61dabf48f66ba9e9db3">operator()</a>( <span class="keyword">const</span> <a class="code" href="classcorecvs_1_1BlockedRange.html">BlockedRange&lt;IndexType&gt;</a>&amp; r )<span class="keyword"> const</span>
<a name="l00126"></a>00126 <span class="keyword">        </span>{
<a name="l00127"></a>00127             IndexType hSize = <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aea7000140c033b0b0a7189a2b7c4808d">hSizeHalf</a> * 2;
<a name="l00128"></a>00128             IndexType wSize = <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a4c828cb4dce1cee51abfa32d42dda764">wSizeHalf</a> * 2;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130             IndexType area = (wSize + 1) * (hSize + 1);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132             <span class="keywordflow">for</span>( IndexType i = r.<a class="code" href="classcorecvs_1_1BlockedRange.html#a6afc35b5d0d32070559723d5bb0a4f73">begin</a>(); i &lt; r.<a class="code" href="classcorecvs_1_1BlockedRange.html#a6f7301fc298a428dde190df3e30551f7">end</a>(); i++ )
<a name="l00133"></a>00133             {
<a name="l00134"></a>00134                 <span class="comment">/* Holding the pointers to 4 corners of the blur zone */</span>
<a name="l00135"></a>00135                 <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> *aCorner = &amp;(<a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a81c7fec5b6ed8902ece6eae94b1f5dbc">buf</a>-&gt;element(i,0));
<a name="l00136"></a>00136                 <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> *cCorner = &amp;(<a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a81c7fec5b6ed8902ece6eae94b1f5dbc">buf</a>-&gt;element(i + hSize + 1,0));
<a name="l00137"></a>00137 
<a name="l00138"></a>00138                 <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> *bCorner = aCorner + (wSize + 1);
<a name="l00139"></a>00139                 <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> *dCorner = cCorner + (wSize + 1);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141                 <span class="keyword">typename</span> ReturnType::InternalElementType *dest = &amp;(<a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aa5f32b903389c9498fe32b2e6240a451">toReturn</a>-&gt;element(i,0));
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                 <span class="keywordflow">for</span> (IndexType j = 0; j &lt; <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aa5f32b903389c9498fe32b2e6240a451">toReturn</a>-&gt;w; j ++)
<a name="l00144"></a>00144                 {
<a name="l00145"></a>00145                    <a class="code" href="namespaceTriangulation.html#a0324dce9b522fe588d7be112ea3f4ad8">ElementType</a> value = *aCorner + *dCorner - *bCorner - *cCorner;
<a name="l00146"></a>00146                    *dest = value / area;
<a name="l00147"></a>00147                    aCorner++;
<a name="l00148"></a>00148                    bCorner++;
<a name="l00149"></a>00149                    cCorner++;
<a name="l00150"></a>00150                    dCorner++;
<a name="l00151"></a>00151                    dest++;
<a name="l00152"></a>00152                 }
<a name="l00153"></a>00153             }
<a name="l00154"></a>00154         }
<a name="l00155"></a><a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#ad56be1bebdeb4101bbf38407e3034aad">00155</a>         <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#ad56be1bebdeb4101bbf38407e3034aad">ParallelRectangularBlur</a>(ReturnType *_toReturn, IndexType _hSizeHalf,
<a name="l00156"></a>00156                                 IndexType _wSizeHalf,
<a name="l00157"></a>00157                                 <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer&lt;ElementType, BaseElementType, IndexType&gt;</a> *_buf) :
<a name="l00158"></a>00158         <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aa5f32b903389c9498fe32b2e6240a451">toReturn</a>(_toReturn), <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#aea7000140c033b0b0a7189a2b7c4808d">hSizeHalf</a>(_hSizeHalf), <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a4c828cb4dce1cee51abfa32d42dda764">wSizeHalf</a>(_wSizeHalf), <a class="code" href="classcorecvs_1_1IntegralBuffer_1_1ParallelRectangularBlur.html#a81c7fec5b6ed8902ece6eae94b1f5dbc">buf</a>(_buf)
<a name="l00159"></a>00159         {}
<a name="l00160"></a>00160     };
<a name="l00161"></a>00161 <span class="comment"></span>
<a name="l00162"></a>00162 <span class="comment">    /**</span>
<a name="l00163"></a>00163 <span class="comment">     * This function calculates the buffer that holds the mean values over the</span>
<a name="l00164"></a>00164 <span class="comment">     * squares of the size  (2 * wSizeHalf + 1) by (2 * hSizeHalf + 1)</span>
<a name="l00165"></a>00165 <span class="comment">     *</span>
<a name="l00166"></a>00166 <span class="comment">     **/</span>
<a name="l00167"></a>00167     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> ReturnType&gt;
<a name="l00168"></a><a class="code" href="classcorecvs_1_1IntegralBuffer.html#ab68cc41e75025fca687458b71a8c937a">00168</a>     <span class="keyword">inline</span> ReturnType *<a class="code" href="classcorecvs_1_1IntegralBuffer.html#ab68cc41e75025fca687458b71a8c937a" title="This function calculates the buffer that holds the mean values over the squares of the size (2 * wSiz...">rectangularBlur</a>(
<a name="l00169"></a>00169             IndexType hSizeHalf,
<a name="l00170"></a>00170             IndexType wSizeHalf,
<a name="l00171"></a>00171             <span class="keywordtype">bool</span> reduceSize = <span class="keyword">true</span>)
<a name="l00172"></a>00172     {
<a name="l00173"></a>00173 
<a name="l00174"></a>00174         ReturnType *toReturn;
<a name="l00175"></a>00175         <span class="keywordtype">int</span> newh = this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#aed8022564c8de2b7f4c2d808209049c7" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveH</a>() - 2 * hSizeHalf;
<a name="l00176"></a>00176         <span class="keywordtype">int</span> neww = this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#af302bfac4741525136af3f895d1c0351" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveW</a>() - 2 * wSizeHalf;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178         <span class="keywordflow">if</span> (reduceSize) {
<a name="l00179"></a>00179             toReturn = <span class="keyword">new</span> ReturnType( newh, neww, <span class="keyword">false</span>);
<a name="l00180"></a>00180             <a class="code" href="namespacecorecvs.html#a3bfefeb3d41c56bea61deddbce9632a8" title="This template provides the parallelable call of the function over the interval with or without TBB...">parallelable_for</a>(0, toReturn-&gt;h, ParallelRectangularBlur&lt;ReturnType&gt;(toReturn, hSizeHalf, wSizeHalf, <span class="keyword">this</span>));
<a name="l00181"></a>00181             <span class="keywordflow">return</span> toReturn;
<a name="l00182"></a>00182         } <span class="keywordflow">else</span> {
<a name="l00183"></a>00183             <span class="comment">// TODO: There is an overkill, it is enough to just zero the margins</span>
<a name="l00184"></a>00184             toReturn = <span class="keyword">new</span> ReturnType(this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#aed8022564c8de2b7f4c2d808209049c7" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveH</a>(), this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#af302bfac4741525136af3f895d1c0351" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveW</a>(), <span class="keyword">true</span>);
<a name="l00185"></a>00185             ReturnType *view = toReturn-&gt;template createView&lt;G12Buffer&gt;(hSizeHalf, wSizeHalf, newh, neww);
<a name="l00186"></a>00186             <a class="code" href="namespacecorecvs.html#a3bfefeb3d41c56bea61deddbce9632a8" title="This template provides the parallelable call of the function over the interval with or without TBB...">parallelable_for</a>(0, view-&gt;h, ParallelRectangularBlur&lt;ReturnType&gt;(view, hSizeHalf, wSizeHalf, <span class="keyword">this</span>));
<a name="l00187"></a>00187             <span class="keyword">delete</span> view;
<a name="l00188"></a>00188             <span class="keywordflow">return</span> toReturn;
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">/*</span>
<a name="l00193"></a>00193 <span class="comment">    ElementType rectangleBl (double x1, double y1, double x2, double y2)</span>
<a name="l00194"></a>00194 <span class="comment">    {</span>
<a name="l00195"></a>00195 <span class="comment">        int x1i = ceil(x1);</span>
<a name="l00196"></a>00196 <span class="comment">        int y1i = ceil(y1);</span>
<a name="l00197"></a>00197 <span class="comment"></span>
<a name="l00198"></a>00198 <span class="comment">        int x2i = floor(x2);</span>
<a name="l00199"></a>00199 <span class="comment">        int y2i = floor(y2);</span>
<a name="l00200"></a>00200 <span class="comment"></span>
<a name="l00201"></a>00201 <span class="comment">        ElementType sum(0);</span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment">        if (x2i &gt; x1i &amp;&amp; y2i &gt; y1i)</span>
<a name="l00204"></a>00204 <span class="comment">          sum =   this-&gt;element(y1i, x1i    ) + this-&gt;element(y2i + 1, x2i + 1)</span>
<a name="l00205"></a>00205 <span class="comment">                - this-&gt;element(y1i, x2i + 1) - this-&gt;element(y2i + 1, x1i);</span>
<a name="l00206"></a>00206 <span class="comment">      // Now we should add the float margins</span>
<a name="l00207"></a>00207 <span class="comment"></span>
<a name="l00208"></a>00208 <span class="comment"></span>
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">      return sum;</span>
<a name="l00211"></a>00211 <span class="comment">    }</span>
<a name="l00212"></a>00212 <span class="comment">*/</span>
<a name="l00213"></a>00213 };
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a><a class="code" href="classcorecvs_1_1G12IntegralBuffer.html">00216</a> <span class="keyword">class </span><a class="code" href="classcorecvs_1_1G12IntegralBuffer.html">G12IntegralBuffer</a> : <span class="keyword">public</span> <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer</a>&lt;uint32_t, G12Buffer::InternalElementType, int32_t&gt; {
<a name="l00217"></a>00217 <span class="keyword">public</span>:
<a name="l00218"></a><a class="code" href="classcorecvs_1_1G12IntegralBuffer.html#a44c8b0ff1c776e49de9e5b20031275d6">00218</a>     <a class="code" href="classcorecvs_1_1G12IntegralBuffer.html#a44c8b0ff1c776e49de9e5b20031275d6">G12IntegralBuffer</a>(<a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a> *input) :
<a name="l00219"></a>00219         <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer</a>&lt;<a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a>, <a class="code" href="classcorecvs_1_1G12Buffer.html" title="TODO: Add consts where it should go.">G12Buffer</a>::<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a526cc6a7f8e84e052215347b05d7caff" title="Type of the internal data type.">InternalElementType</a>, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a>&gt;(input) {};
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="preprocessor">#ifdef WITH_SSE</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span><span class="comment">    /**</span>
<a name="l00223"></a>00223 <span class="comment">     *  This functions could calculate 4 sum rectangle values with SSE2</span>
<a name="l00224"></a>00224 <span class="comment">     *</span>
<a name="l00225"></a>00225 <span class="comment">     *       32bit            32bit                32bit              32bit</span>
<a name="l00226"></a>00226 <span class="comment">     *  [x1,y1,x2,y2][x1 + 1,y1,x2 + 1,y2][x1 + 2,y1,x2 + 2,y2][x1 + 3,y1,x2 + 3,y2]</span>
<a name="l00227"></a>00227 <span class="comment">     *</span>
<a name="l00228"></a>00228 <span class="comment">     **/</span>
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> <span class="keyword">inline</span> __m128i rectangle_sse(<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x2, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y2)
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233             __m128i a = _mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,     x1    ));
<a name="l00234"></a>00234             __m128i b = _mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,     x2 + 1));
<a name="l00235"></a>00235             __m128i c = _mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1, x1    ));
<a name="l00236"></a>00236             __m128i d = _mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1, x2 + 1));
<a name="l00237"></a>00237 
<a name="l00238"></a>00238             <span class="keywordflow">return</span> _mm_sub_epi32(
<a name="l00239"></a>00239                        _mm_add_epi32(a,d),
<a name="l00240"></a>00240                        _mm_add_epi32(b,c)
<a name="l00241"></a>00241                    );
<a name="l00242"></a>00242   <span class="comment">//         Int32x4 a(&amp;this-&gt;element(y1,     x1    ));</span>
<a name="l00243"></a>00243   <span class="comment">//          return a + c - b - d;</span>
<a name="l00244"></a>00244     };
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> <span class="keyword">inline</span> Int32x4 rectangle_sse_new(<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x2, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y2)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248         Int32x4 a(&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,     x1    ));
<a name="l00249"></a>00249         Int32x4 b(&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,     x2 + 1));
<a name="l00250"></a>00250         Int32x4 c(&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1, x1    ));
<a name="l00251"></a>00251         Int32x4 d(&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1,  x2 + 1));
<a name="l00252"></a>00252         <span class="keywordflow">return</span> a + d - b - c;
<a name="l00253"></a>00253     };
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     <span class="keyword">class </span>ParallelRectangularBlurSSE
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         G12Buffer *toReturn;
<a name="l00258"></a>00258         <span class="keywordtype">int</span> hSizeHalf;
<a name="l00259"></a>00259         <span class="keywordtype">int</span> wSizeHalf;
<a name="l00260"></a>00260         <a class="code" href="classcorecvs_1_1G12IntegralBuffer.html#a44c8b0ff1c776e49de9e5b20031275d6">G12IntegralBuffer</a> *buf;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262     <span class="keyword">public</span>:
<a name="l00263"></a>00263         <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> <span class="keywordtype">void</span> operator()( <span class="keyword">const</span> BlockedRange&lt;int&gt;&amp; r )<span class="keyword"> const</span>
<a name="l00264"></a>00264 <span class="keyword">        </span>{
<a name="l00265"></a>00265             <span class="keywordtype">int</span> hSize = hSizeHalf * 2;
<a name="l00266"></a>00266             <span class="keywordtype">int</span> wSize = wSizeHalf * 2;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268             <span class="keywordtype">int</span> area = (wSize + 1) * (hSize + 1);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270             <span class="keywordtype">float</span> div = 1.0f / (area);
<a name="l00271"></a>00271             Float32x4 divisor(div);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = r.begin(); i &lt; r.end(); i++ )
<a name="l00274"></a>00274             {
<a name="l00275"></a>00275                 <span class="comment">/* Holding the pointers to 4 corners of the blur zone */</span>
<a name="l00276"></a>00276                 <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *aCorner = &amp;(buf-&gt;element(i,0));
<a name="l00277"></a>00277                 <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *cCorner = &amp;(buf-&gt;element(i + hSize + 1,0));
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                 <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *bCorner = aCorner + (wSize + 1);
<a name="l00280"></a>00280                 <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> *dCorner = cCorner + (wSize + 1);
<a name="l00281"></a>00281 
<a name="l00282"></a>00282                 <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> *dest = &amp;(toReturn-&gt;element(i,0));
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 <span class="keywordtype">int</span> j;
<a name="l00285"></a>00285                 <span class="keywordflow">for</span> ( j = 0; j + 3 &lt; toReturn-&gt;w; j += 8)
<a name="l00286"></a>00286                 {
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                     Int32x4 a(aCorner);
<a name="l00289"></a>00289                     Int32x4 b(bCorner);
<a name="l00290"></a>00290                     Int32x4 c(cCorner);
<a name="l00291"></a>00291                     Int32x4 d(dCorner);
<a name="l00292"></a>00292 
<a name="l00293"></a>00293                     Int32x4 sum = a + d - b - c;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295                     Float32x4 float_sum(sum);
<a name="l00296"></a>00296                     Float32x4 float_result = float_sum * divisor;
<a name="l00297"></a>00297                     Int32x4 result_hi = float_result.trunc();
<a name="l00298"></a>00298 
<a name="l00299"></a>00299                     a = Int32x4(aCorner + 4);
<a name="l00300"></a>00300                     b = Int32x4(bCorner + 4);
<a name="l00301"></a>00301                     c = Int32x4(cCorner + 4);
<a name="l00302"></a>00302                     d = Int32x4(dCorner + 4);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                     sum = a + d - b - c;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306                     float_sum = Float32x4(sum);
<a name="l00307"></a>00307                     float_result = float_sum * divisor;
<a name="l00308"></a>00308                     Int32x4 result_low = float_result.trunc();
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311                     Int16x8 result = <a class="code" href="classcorecvs_1_1Int16x8.html#a390d8b41974ce1e41d36c0b6138f460c" title="This functions packs the lower parts of each of elements of input registers into one.">Int16x8::pack</a>(result_hi, result_low);
<a name="l00312"></a>00312                     result.save(dest);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314                     aCorner+=8;
<a name="l00315"></a>00315                     bCorner+=8;
<a name="l00316"></a>00316                     cCorner+=8;
<a name="l00317"></a>00317                     dCorner+=8;
<a name="l00318"></a>00318                     dest+=8;
<a name="l00319"></a>00319                 }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321                 <span class="keywordflow">for</span> (    ; j  &lt; toReturn-&gt;w; j ++)
<a name="l00322"></a>00322                 {
<a name="l00323"></a>00323                    <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> value = *aCorner + *dCorner - *bCorner - *cCorner;
<a name="l00324"></a>00324                    *dest = value / area;
<a name="l00325"></a>00325                    aCorner++;
<a name="l00326"></a>00326                    bCorner++;
<a name="l00327"></a>00327                    cCorner++;
<a name="l00328"></a>00328                    dCorner++;
<a name="l00329"></a>00329                    dest++;
<a name="l00330"></a>00330                 }
<a name="l00331"></a>00331             }
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333         ParallelRectangularBlurSSE(G12Buffer *_toReturn, <span class="keywordtype">int</span> _hSizeHalf,
<a name="l00334"></a>00334                                 <span class="keywordtype">int</span> _wSizeHalf,
<a name="l00335"></a>00335                                 <a class="code" href="classcorecvs_1_1G12IntegralBuffer.html#a44c8b0ff1c776e49de9e5b20031275d6">G12IntegralBuffer</a> *_buf) :
<a name="l00336"></a>00336         toReturn(_toReturn), hSizeHalf(_hSizeHalf), wSizeHalf(_wSizeHalf), buf(_buf)
<a name="l00337"></a>00337         {}
<a name="l00338"></a>00338     };
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> <span class="keyword">inline</span> G12Buffer *rectangularBlurSSE(
<a name="l00341"></a>00341             <span class="keywordtype">int</span> hSizeHalf, <span class="keywordtype">int</span> wSizeHalf)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343         G12Buffer *toReturn = <span class="keyword">new</span> G12Buffer(
<a name="l00344"></a>00344                 this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#aed8022564c8de2b7f4c2d808209049c7" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveH</a>() - 2 * hSizeHalf,
<a name="l00345"></a>00345                 this-&gt;<a class="code" href="classcorecvs_1_1IntegralBuffer.html#af302bfac4741525136af3f895d1c0351" title="This function returns the size of the buffer from which the intergal buffer was produced.">getEffectiveW</a>() - 2 * wSizeHalf,
<a name="l00346"></a>00346                 <span class="keyword">false</span>);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <a class="code" href="namespacecorecvs.html#a3bfefeb3d41c56bea61deddbce9632a8" title="This template provides the parallelable call of the function over the interval with or without TBB...">parallelable_for</a>(0, toReturn-&gt;h, ParallelRectangularBlurSSE(toReturn, hSizeHalf, wSizeHalf, <span class="keyword">this</span>));
<a name="l00349"></a>00349         <span class="keywordflow">return</span> toReturn;
<a name="l00350"></a>00350     };
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="preprocessor">#endif</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>};
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="classcorecvs_1_1G8IntegralBuffer.html">00357</a>     <span class="keyword">class </span><a class="code" href="classcorecvs_1_1G8IntegralBuffer.html">G8IntegralBuffer</a> : <span class="keyword">public</span> <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer</a>&lt;uint32_t, G8Buffer::InternalElementType, int32_t&gt; {
<a name="l00358"></a>00358 <span class="keyword">public</span>:
<a name="l00359"></a><a class="code" href="classcorecvs_1_1G8IntegralBuffer.html#ac18b58a3902b3f76ed1db3b840db3453">00359</a>     <a class="code" href="classcorecvs_1_1G8IntegralBuffer.html#ac18b58a3902b3f76ed1db3b840db3453">G8IntegralBuffer</a>(<a class="code" href="classcorecvs_1_1G8Buffer.html">G8Buffer</a> *input) :
<a name="l00360"></a>00360         <a class="code" href="classcorecvs_1_1IntegralBuffer.html" title="So each element of the integral buffer will hold the sum of the elements in a rectangle.">IntegralBuffer</a>&lt;<a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a>, <a class="code" href="classcorecvs_1_1G8Buffer.html">G8Buffer</a>::<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a526cc6a7f8e84e052215347b05d7caff" title="Type of the internal data type.">InternalElementType</a>, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a>&gt;(input) {};
<a name="l00361"></a>00361 
<a name="l00362"></a>00362 <span class="preprocessor">#ifdef WITH_SSE</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span><span class="comment">    /**</span>
<a name="l00364"></a>00364 <span class="comment">     *  This functions could calculate 4 sum rectangle values with SSE2</span>
<a name="l00365"></a>00365 <span class="comment">     *</span>
<a name="l00366"></a>00366 <span class="comment">     *       32bit            32bit                32bit              32bit</span>
<a name="l00367"></a>00367 <span class="comment">     *  [x1,y1,x2,y2][x1 + 1,y1,x2 + 1,y2][x1 + 2,y1,x2 + 2,y2][x1 + 3,y1,x2 + 3,y2]</span>
<a name="l00368"></a>00368 <span class="comment">     *</span>
<a name="l00369"></a>00369 <span class="comment">     **/</span>
<a name="l00370"></a>00370     <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> __m128i rectangle_sse(<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x2, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y2)
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372         <span class="keywordflow">return</span> _mm_sub_epi32(_mm_add_epi32(_mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,x1    )),_mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1,x2 + 1))),
<a name="l00373"></a>00373                              _mm_add_epi32(_mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,x2 + 1)),_mm_loadu_si128((__m128i*)&amp;this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1,x1    ))));
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     <a class="code" href="global_8h.html#ad916c53bdcf1b2f32825696398c0a737">ALIGN_STACK_SSE</a> Int32x4 rectangle_sse_new(<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y1, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> x2, <a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a> y2)
<a name="l00376"></a>00376     {
<a name="l00377"></a>00377         Int32x4 a(this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,    x1    ));
<a name="l00378"></a>00378         Int32x4 b(this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1,x2 + 1));
<a name="l00379"></a>00379         Int32x4 c(this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y1,x2 + 1));
<a name="l00380"></a>00380         Int32x4 d(this-&gt;<a class="code" href="classcorecvs_1_1AbstractBuffer.html#a98f72526738a0c4ce8a0b72a3b5c28b9" title="The element getter.">element</a>(y2 + 1,x1    ));
<a name="l00381"></a>00381         <span class="keywordflow">return</span> a + b - c - d;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 <span class="preprocessor">#endif</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>};
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 } <span class="comment">//namespace corecvs</span>
<a name="l00389"></a>00389 <span class="preprocessor">#endif  //INTERGALBUFFER_H_</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:35 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
