<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: core/clegacy/math/algebra.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">core/clegacy/math/algebra.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="algebra_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**</span>
<a name="l00002"></a>00002 <span class="comment"> * \file algebra.c</span>
<a name="l00003"></a>00003 <span class="comment"> * \brief This files contains the fast implementation for algebraic functions, such as sqrt(), atan2(), etc.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> *  \ingroup corefiles</span>
<a name="l00007"></a>00007 <span class="comment"> *  \date Jul 10, 2009</span>
<a name="l00008"></a>00008 <span class="comment"> *  \author Alexander Pimenov</span>
<a name="l00009"></a>00009 <span class="comment"> */</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;<a class="code" href="algebra_8h.html" title="Header for algebra.c.">algebra.h</a>&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="algebra_8c.html#ab77df89019d5eec59daacc66614b89c5">00015</a> <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> <a class="code" href="algebra_8c.html#ab77df89019d5eec59daacc66614b89c5">rootLUT</a>[128] = {
<a name="l00016"></a>00016             0 <span class="comment">/*   0 */</span>,     1 <span class="comment">/*   1 */</span>,     4 <span class="comment">/*   2 */</span>,     9 <span class="comment">/*   3 */</span>,
<a name="l00017"></a>00017            16 <span class="comment">/*   4 */</span>,    25 <span class="comment">/*   5 */</span>,    36 <span class="comment">/*   6 */</span>,    49 <span class="comment">/*   7 */</span>,
<a name="l00018"></a>00018            64 <span class="comment">/*   8 */</span>,    81 <span class="comment">/*   9 */</span>,   100 <span class="comment">/*  10 */</span>,   121 <span class="comment">/*  11 */</span>,
<a name="l00019"></a>00019           144 <span class="comment">/*  12 */</span>,   169 <span class="comment">/*  13 */</span>,   196 <span class="comment">/*  14 */</span>,   225 <span class="comment">/*  15 */</span>,
<a name="l00020"></a>00020           256 <span class="comment">/*  16 */</span>,   289 <span class="comment">/*  17 */</span>,   324 <span class="comment">/*  18 */</span>,   361 <span class="comment">/*  19 */</span>,
<a name="l00021"></a>00021           400 <span class="comment">/*  20 */</span>,   441 <span class="comment">/*  21 */</span>,   484 <span class="comment">/*  22 */</span>,   529 <span class="comment">/*  23 */</span>,
<a name="l00022"></a>00022           576 <span class="comment">/*  24 */</span>,   625 <span class="comment">/*  25 */</span>,   676 <span class="comment">/*  26 */</span>,   729 <span class="comment">/*  27 */</span>,
<a name="l00023"></a>00023           784 <span class="comment">/*  28 */</span>,   841 <span class="comment">/*  29 */</span>,   900 <span class="comment">/*  30 */</span>,   961 <span class="comment">/*  31 */</span>,
<a name="l00024"></a>00024          1024 <span class="comment">/*  32 */</span>,  1089 <span class="comment">/*  33 */</span>,  1156 <span class="comment">/*  34 */</span>,  1225 <span class="comment">/*  35 */</span>,
<a name="l00025"></a>00025          1296 <span class="comment">/*  36 */</span>,  1369 <span class="comment">/*  37 */</span>,  1444 <span class="comment">/*  38 */</span>,  1521 <span class="comment">/*  39 */</span>,
<a name="l00026"></a>00026          1600 <span class="comment">/*  40 */</span>,  1681 <span class="comment">/*  41 */</span>,  1764 <span class="comment">/*  42 */</span>,  1849 <span class="comment">/*  43 */</span>,
<a name="l00027"></a>00027          1936 <span class="comment">/*  44 */</span>,  2025 <span class="comment">/*  45 */</span>,  2116 <span class="comment">/*  46 */</span>,  2209 <span class="comment">/*  47 */</span>,
<a name="l00028"></a>00028          2304 <span class="comment">/*  48 */</span>,  2401 <span class="comment">/*  49 */</span>,  2500 <span class="comment">/*  50 */</span>,  2601 <span class="comment">/*  51 */</span>,
<a name="l00029"></a>00029          2704 <span class="comment">/*  52 */</span>,  2809 <span class="comment">/*  53 */</span>,  2916 <span class="comment">/*  54 */</span>,  3025 <span class="comment">/*  55 */</span>,
<a name="l00030"></a>00030          3136 <span class="comment">/*  56 */</span>,  3249 <span class="comment">/*  57 */</span>,  3364 <span class="comment">/*  58 */</span>,  3481 <span class="comment">/*  59 */</span>,
<a name="l00031"></a>00031          3600 <span class="comment">/*  60 */</span>,  3721 <span class="comment">/*  61 */</span>,  3844 <span class="comment">/*  62 */</span>,  3969 <span class="comment">/*  63 */</span>,
<a name="l00032"></a>00032          4096 <span class="comment">/*  64 */</span>,  4225 <span class="comment">/*  65 */</span>,  4356 <span class="comment">/*  66 */</span>,  4489 <span class="comment">/*  67 */</span>,
<a name="l00033"></a>00033          4624 <span class="comment">/*  68 */</span>,  4761 <span class="comment">/*  69 */</span>,  4900 <span class="comment">/*  70 */</span>,  5041 <span class="comment">/*  71 */</span>,
<a name="l00034"></a>00034          5184 <span class="comment">/*  72 */</span>,  5329 <span class="comment">/*  73 */</span>,  5476 <span class="comment">/*  74 */</span>,  5625 <span class="comment">/*  75 */</span>,
<a name="l00035"></a>00035          5776 <span class="comment">/*  76 */</span>,  5929 <span class="comment">/*  77 */</span>,  6084 <span class="comment">/*  78 */</span>,  6241 <span class="comment">/*  79 */</span>,
<a name="l00036"></a>00036          6400 <span class="comment">/*  80 */</span>,  6561 <span class="comment">/*  81 */</span>,  6724 <span class="comment">/*  82 */</span>,  6889 <span class="comment">/*  83 */</span>,
<a name="l00037"></a>00037          7056 <span class="comment">/*  84 */</span>,  7225 <span class="comment">/*  85 */</span>,  7396 <span class="comment">/*  86 */</span>,  7569 <span class="comment">/*  87 */</span>,
<a name="l00038"></a>00038          7744 <span class="comment">/*  88 */</span>,  7921 <span class="comment">/*  89 */</span>,  8100 <span class="comment">/*  90 */</span>,  8281 <span class="comment">/*  91 */</span>,
<a name="l00039"></a>00039          8464 <span class="comment">/*  92 */</span>,  8649 <span class="comment">/*  93 */</span>,  8836 <span class="comment">/*  94 */</span>,  9025 <span class="comment">/*  95 */</span>,
<a name="l00040"></a>00040          9216 <span class="comment">/*  96 */</span>,  9409 <span class="comment">/*  97 */</span>,  9604 <span class="comment">/*  98 */</span>,  9801 <span class="comment">/*  99 */</span>,
<a name="l00041"></a>00041         10000 <span class="comment">/* 100 */</span>, 10201 <span class="comment">/* 101 */</span>, 10404 <span class="comment">/* 102 */</span>, 10609 <span class="comment">/* 103 */</span>,
<a name="l00042"></a>00042         10816 <span class="comment">/* 104 */</span>, 11025 <span class="comment">/* 105 */</span>, 11236 <span class="comment">/* 106 */</span>, 11449 <span class="comment">/* 107 */</span>,
<a name="l00043"></a>00043         11664 <span class="comment">/* 108 */</span>, 11881 <span class="comment">/* 109 */</span>, 12100 <span class="comment">/* 110 */</span>, 12321 <span class="comment">/* 111 */</span>,
<a name="l00044"></a>00044         12544 <span class="comment">/* 112 */</span>, 12769 <span class="comment">/* 113 */</span>, 12996 <span class="comment">/* 114 */</span>, 13225 <span class="comment">/* 115 */</span>,
<a name="l00045"></a>00045         13456 <span class="comment">/* 116 */</span>, 13689 <span class="comment">/* 117 */</span>, 13924 <span class="comment">/* 118 */</span>, 14161 <span class="comment">/* 119 */</span>,
<a name="l00046"></a>00046         14400 <span class="comment">/* 120 */</span>, 14641 <span class="comment">/* 121 */</span>, 14884 <span class="comment">/* 122 */</span>, 15129 <span class="comment">/* 123 */</span>,
<a name="l00047"></a>00047         15376 <span class="comment">/* 124 */</span>, 15625 <span class="comment">/* 125 */</span>, 15876 <span class="comment">/* 126 */</span>, 16129 <span class="comment">/* 127 */</span>
<a name="l00048"></a>00048 };
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="namespacecorecvs.html#a7e82697e2e2900fb5b5f8db27be818e2">00051</a> <a class="code" href="stdint__win_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> <a class="code" href="algebra_8c.html#a2b9b480d69cc1e20d8d204e606c47e1d">getDirection5bit</a>(<a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> dx, <a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> dy)
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053         <a class="code" href="stdint__win_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> accumulator = 0;
<a name="l00054"></a>00054         <a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> rx;
<a name="l00055"></a>00055         <a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> ry;
<a name="l00056"></a>00056         <span class="comment">/* \todo TODO: Make this faster*/</span>
<a name="l00057"></a>00057         <span class="comment">// Reduce the circle to the 1st quadrant</span>
<a name="l00058"></a>00058         <span class="keywordflow">if</span> (dx &lt; 0)
<a name="l00059"></a>00059         {
<a name="l00060"></a>00060                 <span class="keywordflow">if</span> (dy &lt; 0)
<a name="l00061"></a>00061                 {
<a name="l00062"></a>00062                         accumulator = 16;
<a name="l00063"></a>00063                         rx = -dx;
<a name="l00064"></a>00064                         ry = -dy;
<a name="l00065"></a>00065                 }
<a name="l00066"></a>00066                 <span class="keywordflow">else</span>
<a name="l00067"></a>00067                 {
<a name="l00068"></a>00068                         accumulator = 8;
<a name="l00069"></a>00069                         rx =  dy;
<a name="l00070"></a>00070                         ry = -dx;
<a name="l00071"></a>00071                 }
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073         <span class="keywordflow">else</span>
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075                 <span class="keywordflow">if</span> (dy &lt; 0)
<a name="l00076"></a>00076                 {
<a name="l00077"></a>00077                         accumulator = 24;
<a name="l00078"></a>00078                         rx = -dy;
<a name="l00079"></a>00079                         ry = dx;
<a name="l00080"></a>00080                 }
<a name="l00081"></a>00081                 <span class="keywordflow">else</span>
<a name="l00082"></a>00082                 {
<a name="l00083"></a>00083                         accumulator = 0;
<a name="l00084"></a>00084                         rx = dx;
<a name="l00085"></a>00085                         ry = dy;
<a name="l00086"></a>00086                 }
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">// Do the tree search</span>
<a name="l00090"></a>00090         <span class="keywordflow">if</span> (ry &lt;= rx)
<a name="l00091"></a>00091         {<span class="comment"></span>
<a name="l00092"></a>00092 <span class="comment">                /// @todo So far use double. Later no double should be used.</span>
<a name="l00093"></a>00093 <span class="comment"></span>                <span class="keywordflow">if</span> (rx &lt;= 0.414213562 * ry)
<a name="l00094"></a>00094                 {
<a name="l00095"></a>00095                         <span class="keywordflow">if</span> (rx &lt;= 0.198912367 * ry)
<a name="l00096"></a>00096                                 <span class="keywordflow">return</span> accumulator;
<a name="l00097"></a>00097                         <span class="keywordflow">else</span>
<a name="l00098"></a>00098                                 <span class="keywordflow">return</span> accumulator + 1;
<a name="l00099"></a>00099                 }
<a name="l00100"></a>00100                 <span class="keywordflow">else</span>
<a name="l00101"></a>00101                 {
<a name="l00102"></a>00102                         <span class="keywordflow">if</span> (rx &lt;= 0.668178638 * ry)
<a name="l00103"></a>00103                                 <span class="keywordflow">return</span> accumulator + 2;
<a name="l00104"></a>00104                         <span class="keywordflow">else</span>
<a name="l00105"></a>00105                                 <span class="keywordflow">return</span> accumulator + 3;
<a name="l00106"></a>00106                 }
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108         <span class="keywordflow">else</span>
<a name="l00109"></a>00109         {
<a name="l00110"></a>00110                 <span class="keywordflow">if</span> (ry &lt;= 0.414213562 * rx)
<a name="l00111"></a>00111                 {
<a name="l00112"></a>00112                         <span class="keywordflow">if</span> (ry &lt;= 0.198912367 * rx)
<a name="l00113"></a>00113                                 <span class="keywordflow">return</span> accumulator + 7;
<a name="l00114"></a>00114                         <span class="keywordflow">else</span>
<a name="l00115"></a>00115                                 <span class="keywordflow">return</span> accumulator + 6;
<a name="l00116"></a>00116                 }
<a name="l00117"></a>00117                 <span class="keywordflow">else</span>
<a name="l00118"></a>00118                 {
<a name="l00119"></a>00119                         <span class="keywordflow">if</span> (ry &lt;= 0.668178638 * rx)
<a name="l00120"></a>00120                                 <span class="keywordflow">return</span> accumulator + 5;
<a name="l00121"></a>00121                         <span class="keywordflow">else</span>
<a name="l00122"></a>00122                                 <span class="keywordflow">return</span> accumulator + 4;
<a name="l00123"></a>00123                 }
<a name="l00124"></a>00124         }
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 <span class="comment"></span>
<a name="l00127"></a>00127 <span class="comment">/**</span>
<a name="l00128"></a>00128 <span class="comment"> * Expecting two Sobel derivatives of the 12bit image</span>
<a name="l00129"></a>00129 <span class="comment"> *   This will make the range 12 + 3 bits for the</span>
<a name="l00130"></a>00130 <span class="comment"> *   derivatives (due to Sobel matrix coefficients)</span>
<a name="l00131"></a>00131 <span class="comment"> *</span>
<a name="l00132"></a>00132 <span class="comment"> *  \param dx - X Sobel derivative</span>
<a name="l00133"></a>00133 <span class="comment"> *  \param dy - Y Sobel derivative</span>
<a name="l00134"></a>00134 <span class="comment"> *</span>
<a name="l00135"></a>00135 <span class="comment"> **/</span>
<a name="l00136"></a><a class="code" href="namespacecorecvs.html#af40e71e98a16e27c799a340c583dd59b">00136</a> <a class="code" href="stdint__win_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> <a class="code" href="algebra_8c.html#ad4ba292cd009c404d0122c19d9f13e16" title="Expecting two Sobel derivatives of the 12bit image This will make the range 12 + 3 bits for the deriv...">getMagnitude7bit</a>(<a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> dx, <a class="code" href="stdint__win_8h.html#a044293bfeff56852a28ed6c2cfbb2649">int16_t</a> dy)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <span class="comment">//                        24bit      +       24bit          = 25bit</span>
<a name="l00139"></a>00139         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> distsq = ((<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a>)dx * dx) + ((<a class="code" href="stdint__win_8h.html#a37994e3b11c72957c6f454c6ec96d43d">int32_t</a>)dy * dy);
<a name="l00140"></a>00140         <span class="comment">//   reduce to 14bits</span>
<a name="l00141"></a>00141         distsq &gt;&gt;= 11;
<a name="l00142"></a>00142         <span class="comment">//   And now use search in LUT</span>
<a name="l00143"></a>00143         <a class="code" href="stdint__win_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> start = 0, end = 127;
<a name="l00144"></a>00144         <span class="keywordflow">while</span> (start != end) {
<a name="l00145"></a>00145                 <a class="code" href="stdint__win_8h.html#a9a941819355e6f658991890ff66b4b0e">uint8_t</a> middle = (start + end) &gt;&gt; 1;
<a name="l00146"></a>00146                 <span class="keywordflow">if</span> (<a class="code" href="algebra_8c.html#ab77df89019d5eec59daacc66614b89c5">rootLUT</a>[middle] == distsq)
<a name="l00147"></a>00147                         <span class="keywordflow">return</span> middle;
<a name="l00148"></a>00148                 <span class="keywordflow">if</span> (<a class="code" href="algebra_8c.html#ab77df89019d5eec59daacc66614b89c5">rootLUT</a>[middle] &gt; distsq)
<a name="l00149"></a>00149                 {
<a name="l00150"></a>00150                         end = middle - 1;
<a name="l00151"></a>00151                 }
<a name="l00152"></a>00152                 <span class="keywordflow">else</span>
<a name="l00153"></a>00153                 {
<a name="l00154"></a>00154                         start = middle + 1;
<a name="l00155"></a>00155                 }
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157         <span class="keywordflow">return</span> start;
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="namespacecorecvs.html#abf118be3fec05767b452ad0949d2423e">00161</a> <span class="keywordtype">double</span> <a class="code" href="algebra_8c.html#ac35612b9ebd9e49d567a4ec9041d998c">getLengthStable</a> (<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163         <span class="keywordtype">double</span> ma = (a &gt; 0) ? a : -a;
<a name="l00164"></a>00164         <span class="keywordtype">double</span> mb = (b &gt; 0) ? b : -b;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (ma == 0 &amp;&amp; mb == 0) <span class="keywordflow">return</span> 0;
<a name="l00167"></a>00167         <span class="keywordflow">if</span> (ma &gt; mb)
<a name="l00168"></a>00168         {
<a name="l00169"></a>00169                 <span class="keywordtype">double</span> div = (mb / ma);
<a name="l00170"></a>00170                 <span class="keywordflow">return</span> ma * sqrt(1.0 + div * div );
<a name="l00171"></a>00171         }
<a name="l00172"></a>00172         <span class="keywordflow">else</span>
<a name="l00173"></a>00173         {
<a name="l00174"></a>00174                 <span class="keywordtype">double</span> div = (ma / mb);
<a name="l00175"></a>00175                 <span class="keywordflow">return</span> mb * sqrt(1.0 + div * div );
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="comment"></span>
<a name="l00180"></a>00180 <span class="comment">/**</span>
<a name="l00181"></a>00181 <span class="comment"> *</span>
<a name="l00182"></a>00182 <span class="comment"> *  The fast approximation of the square root with the method similar to Newton&#39;s</span>
<a name="l00183"></a>00183 <span class="comment"> *</span>
<a name="l00184"></a>00184 <span class="comment"> *</span>
<a name="l00185"></a>00185 <span class="comment"> *  */</span>
<a name="l00186"></a><a class="code" href="algebra_8c.html#a813b8ba4bade438e91533e0ae58f950b">00186</a> <span class="keyword">inline</span> <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> <a class="code" href="algebra_8c.html#a813b8ba4bade438e91533e0ae58f950b" title="The fast approximation of the square root with the method similar to Newton&#39;s.">getIntegerRootFast</a>(<a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> input)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> x;
<a name="l00189"></a>00189         x = (input / 0x3f + 0x3f) &gt;&gt; 1;
<a name="l00190"></a>00190         x = (input / x + x) &gt;&gt; 1;
<a name="l00191"></a>00191         x = (input / x + x) &gt;&gt; 1;
<a name="l00192"></a>00192 <span class="comment">/*        x = (input / x + x) &gt;&gt; 1;</span>
<a name="l00193"></a>00193 <span class="comment">        x = (input / x + x) &gt;&gt; 1;</span>
<a name="l00194"></a>00194 <span class="comment">        x = (input / x + x) &gt;&gt; 1;</span>
<a name="l00195"></a>00195 <span class="comment">        x = (input / x + x) &gt;&gt; 1;*/</span>
<a name="l00196"></a>00196         <span class="keywordflow">return</span> x;
<a name="l00197"></a>00197 }
<a name="l00198"></a>00198 <span class="comment"></span>
<a name="l00199"></a>00199 <span class="comment">/**</span>
<a name="l00200"></a>00200 <span class="comment"> * As 1/25 is</span>
<a name="l00201"></a>00201 <span class="comment"> *   0b0.(00001010001111010111)</span>
<a name="l00202"></a>00202 <span class="comment"> *</span>
<a name="l00203"></a>00203 <span class="comment"> * The period is presented as follows:</span>
<a name="l00204"></a>00204 <span class="comment"> *</span>
<a name="l00205"></a>00205 <span class="comment"> * |1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20|21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40</span>
<a name="l00206"></a>00206 <span class="comment"> * |0  0  0  0  1  0  1  0  0  0  1  1  1  1  0  1  0  1  1  1| 0  0  0  0  1  0  1  0  0  0  1  1  1  1  0  1  0  1  1  1</span>
<a name="l00207"></a>00207 <span class="comment"> *</span>
<a name="l00208"></a>00208 <span class="comment"> *</span>
<a name="l00209"></a>00209 <span class="comment"> * the division result could be computed as the addition of the shifted values.</span>
<a name="l00210"></a>00210 <span class="comment"> *</span>
<a name="l00211"></a>00211 <span class="comment"> * This version is for 16bit</span>
<a name="l00212"></a>00212 <span class="comment"> *</span>
<a name="l00213"></a>00213 <span class="comment"> */</span>
<a name="l00214"></a><a class="code" href="algebra_8c.html#a25fd76a00bc58b348e008079f192586e">00214</a> <span class="keyword">inline</span> <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> <a class="code" href="algebra_8c.html#a25fd76a00bc58b348e008079f192586e" title="As 1/25 is 0b0.">divideBy25_16</a> (<a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> <a class="code" href="structin.html">in</a>)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216         <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> in0_101 = (in &gt;&gt; 1)  + (in &gt;&gt; 3);
<a name="l00217"></a>00217         <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> in0_111 = in0_101 + (in &gt;&gt; 2);
<a name="l00218"></a>00218         <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> result = ((in0_101) + (in0_101 &gt;&gt; 9) + (in0_111 &gt;&gt; 6) + (in0_111 &gt;&gt; 13)) &gt;&gt; 4;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> r = in - result * 25;
<a name="l00221"></a>00221         <span class="keywordflow">if</span> (r &gt;= 25) result++;
<a name="l00222"></a>00222         <span class="keywordflow">return</span> result;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 <span class="comment"></span>
<a name="l00225"></a>00225 <span class="comment">/**</span>
<a name="l00226"></a>00226 <span class="comment"> * As 1/25 is</span>
<a name="l00227"></a>00227 <span class="comment"> *   0b0.(00001010001111010111)</span>
<a name="l00228"></a>00228 <span class="comment"> *</span>
<a name="l00229"></a>00229 <span class="comment"> * The period is presented as follows:</span>
<a name="l00230"></a>00230 <span class="comment"> *</span>
<a name="l00231"></a>00231 <span class="comment"> * |1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20|21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40</span>
<a name="l00232"></a>00232 <span class="comment"> * |0  0  0  0  1  0  1  0  0  0  1  1  1  1  0  1  0  1  1  1| 0  0  0  0  1  0  1  0  0  0  1  1  1  1  0  1  0  1  1  1</span>
<a name="l00233"></a>00233 <span class="comment"> *</span>
<a name="l00234"></a>00234 <span class="comment"> *</span>
<a name="l00235"></a>00235 <span class="comment"> * the division result could be computed as the addition of the shifted values.</span>
<a name="l00236"></a>00236 <span class="comment"> *</span>
<a name="l00237"></a>00237 <span class="comment"> * This version is for 32bit</span>
<a name="l00238"></a>00238 <span class="comment"> *</span>
<a name="l00239"></a>00239 <span class="comment"> */</span>
<a name="l00240"></a><a class="code" href="algebra_8c.html#a06fd1022bf3d7f6a97be394c361eb211">00240</a> <span class="keyword">inline</span> <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> <a class="code" href="algebra_8c.html#a06fd1022bf3d7f6a97be394c361eb211" title="As 1/25 is 0b0.">divideBy25_32</a> (<a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> <a class="code" href="structin.html">in</a>)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> in0_101 = (in &gt;&gt; 1)  + (in &gt;&gt; 3);
<a name="l00243"></a>00243         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> in0_111 = in0_101 + (in &gt;&gt; 2);
<a name="l00244"></a>00244         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> in0_00001010001111010111 = ((in0_101) + (in0_101 &gt;&gt; 9) + (in0_111 &gt;&gt; 6) + (in0_111 &gt;&gt; 13)) &gt;&gt; 4;
<a name="l00245"></a>00245         <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> result = (in0_00001010001111010111) + (in0_00001010001111010111 &gt;&gt; 20);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <a class="code" href="stdint__win_8h.html#a30af71eaf40c925c9832eb289a48da35">uint16_t</a> r = in - result * 25;
<a name="l00248"></a>00248         <span class="keywordflow">if</span> (r &gt;= 25) result++;
<a name="l00249"></a>00249         <span class="keywordflow">if</span> (r &gt;= 50) result++;
<a name="l00250"></a>00250         <span class="keywordflow">return</span> result;
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="algebra_8c.html#a032503e76d6f69bc67e99e909c8125da">00253</a> <span class="preprocessor">#define TABLE_SIZE 512</span>
<a name="l00254"></a><a class="code" href="algebra_8c.html#a911ecfe019d407694b8fadd68b53efc6">00254</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_FUCTION_VALUE  (0xFFFFFF)</span>
<a name="l00255"></a><a class="code" href="algebra_8c.html#a445300242f33311fdde3524f222e3686">00255</a> <span class="preprocessor"></span><span class="preprocessor">#define MIN_FUCTION_VALUE  (0)</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>
<a name="l00257"></a><a class="code" href="algebra_8c.html#a7b97ce112ba2bcf695a2feabc2837843">00257</a> <span class="preprocessor">#define SLOPE_MULTIPLIER_SHIFT (23)</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="algebra_8c.html#aad7aae225518d4b6b6765e694d333baf">00260</a> <a class="code" href="stdint__win_8h.html#a6eb1e68cc391dd753bc8ce896dbb8315">uint32_t</a> <a class="code" href="algebra_8c.html#aad7aae225518d4b6b6765e694d333baf">sqare_root_lut</a>[<a class="code" href="algebra_8c.html#a032503e76d6f69bc67e99e909c8125da">TABLE_SIZE</a>];
<a name="l00261"></a>00261 <span class="comment">/*</span>
<a name="l00262"></a>00262 <span class="comment">void squareRootLUTPrepare ()</span>
<a name="l00263"></a>00263 <span class="comment">{</span>
<a name="l00264"></a>00264 <span class="comment">        uint32_t i;</span>
<a name="l00265"></a>00265 <span class="comment">        for (i = 0; i &lt; TABLE_SIZE; i++)</span>
<a name="l00266"></a>00266 <span class="comment">        {</span>
<a name="l00267"></a>00267 <span class="comment">                uint32_t start = i * (MAX_SQRT_VALUE / TABLE_SIZE);</span>
<a name="l00268"></a>00268 <span class="comment">                uint32_t end   = (i + 1)  * (MAX_SQRT_VALUE / TABLE_SIZE);</span>
<a name="l00269"></a>00269 <span class="comment"></span>
<a name="l00270"></a>00270 <span class="comment">                uint32_t sqrtstart = sqrt((double) start);</span>
<a name="l00271"></a>00271 <span class="comment">                uint32_t sqrtend = sqrt((double) end);</span>
<a name="l00272"></a>00272 <span class="comment">                double slope = ((double)sqrtend - sqrtstart) / ((double)MAX_SQRT_VALUE / TABLE_SIZE);</span>
<a name="l00273"></a>00273 <span class="comment">                uint32_t packedStart = (uint32_t) sqrtstart;</span>
<a name="l00274"></a>00274 <span class="comment">                uint32_t packedSlope = (uint32_t) (slope * (1 &lt;&lt; SLOPE_MULTIPLIER_SHIFT));</span>
<a name="l00275"></a>00275 <span class="comment">                sqare_root_lut[i] = (packedStart &lt;&lt; 16) | packedSlope;</span>
<a name="l00276"></a>00276 <span class="comment"></span>
<a name="l00277"></a>00277 <span class="comment">                printf(&quot;Start = %u, End = %u, slope = %2.5lf, 0x%x\n &quot;, start, end, slope, packedSlope);</span>
<a name="l00278"></a>00278 <span class="comment">        }</span>
<a name="l00279"></a>00279 <span class="comment"></span>
<a name="l00280"></a>00280 <span class="comment">}</span>
<a name="l00281"></a>00281 <span class="comment"></span>
<a name="l00282"></a>00282 <span class="comment">uint32_t squareRoot (uint32_t value)</span>
<a name="l00283"></a>00283 <span class="comment">{</span>
<a name="l00284"></a>00284 <span class="comment">        if (value &gt; MAX_SQRT_VALUE)</span>
<a name="l00285"></a>00285 <span class="comment">                return 0;</span>
<a name="l00286"></a>00286 <span class="comment">        uint32_t packedId = (value &gt;&gt; (24 - 9));</span>
<a name="l00287"></a>00287 <span class="comment">        uint32_t packed = sqare_root_lut[packedId];</span>
<a name="l00288"></a>00288 <span class="comment">        uint32_t packedStart = packed &gt;&gt; 16;</span>
<a name="l00289"></a>00289 <span class="comment">        uint32_t packedSlope = packed &amp; 0xFFFF;</span>
<a name="l00290"></a>00290 <span class="comment">        uint32_t result = packedStart + ((packedSlope * (value &amp; 0x7FFF)) &gt;&gt; SLOPE_MULTIPLIER_SHIFT);</span>
<a name="l00291"></a>00291 <span class="comment">        printf(&quot;packedId = %u\n&quot;, packedId);</span>
<a name="l00292"></a>00292 <span class="comment">        return result;</span>
<a name="l00293"></a>00293 <span class="comment">}*/</span>
<a name="l00294"></a>00294 <span class="comment">/*</span>
<a name="l00295"></a>00295 <span class="comment">int main (void)</span>
<a name="l00296"></a>00296 <span class="comment">{</span>
<a name="l00297"></a>00297 <span class="comment">        squareRootLUTPrepare();</span>
<a name="l00298"></a>00298 <span class="comment">        unsigned i;</span>
<a name="l00299"></a>00299 <span class="comment">        for (i = 0; i &lt; TABLE_SIZE; i++)</span>
<a name="l00300"></a>00300 <span class="comment">        {</span>
<a name="l00301"></a>00301 <span class="comment">                uint32_t st = sqare_root_lut[i];</span>
<a name="l00302"></a>00302 <span class="comment">                printf(&quot;%u %u =&gt; %u %u %u\n&quot;, i, st, i * (0xFFF / TABLE_SIZE), st &gt;&gt; 16, st &amp; 0xFFFF);</span>
<a name="l00303"></a>00303 <span class="comment">        }</span>
<a name="l00304"></a>00304 <span class="comment"></span>
<a name="l00305"></a>00305 <span class="comment">        for (i = 0; i &lt; 0xFFFFFF; i+=0xFFFFF )</span>
<a name="l00306"></a>00306 <span class="comment">        {</span>
<a name="l00307"></a>00307 <span class="comment">                printf(&quot;%u %u %u\n&quot;, i, (uint32_t)sqrt(i), squareRoot(i));</span>
<a name="l00308"></a>00308 <span class="comment"></span>
<a name="l00309"></a>00309 <span class="comment">        }</span>
<a name="l00310"></a>00310 <span class="comment"></span>
<a name="l00311"></a>00311 <span class="comment">        return 0;</span>
<a name="l00312"></a>00312 <span class="comment">}*/</span>
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">/*</span>
<a name="l00315"></a>00315 <span class="comment">int main (void)</span>
<a name="l00316"></a>00316 <span class="comment">{</span>
<a name="l00317"></a>00317 <span class="comment">        uint32_t i;</span>
<a name="l00318"></a>00318 <span class="comment">        for (i = 0; i &lt; 0xFFFFFFFF; i+=1)</span>
<a name="l00319"></a>00319 <span class="comment">        {</span>
<a name="l00320"></a>00320 <span class="comment">                uint32_t real = i / 25;</span>
<a name="l00321"></a>00321 <span class="comment">                uint32_t ours = divideBy25_32(i);</span>
<a name="l00322"></a>00322 <span class="comment">                if (real != ours)</span>
<a name="l00323"></a>00323 <span class="comment">                        printf(&quot;!!!%u (%u : %u) %u\n&quot;, i, ours, i - ours * 25, real);</span>
<a name="l00324"></a>00324 <span class="comment">                if ((i % 1000000) == 0)</span>
<a name="l00325"></a>00325 <span class="comment">                        printf(&quot;Processing %u (%lf)\n&quot;, i, (double)i / (0xFFFFFFFF) * 100.0);</span>
<a name="l00326"></a>00326 <span class="comment">        }</span>
<a name="l00327"></a>00327 <span class="comment">        return 0;</span>
<a name="l00328"></a>00328 <span class="comment">}</span>
<a name="l00329"></a>00329 <span class="comment">*/</span>
<a name="l00330"></a>00330 <span class="comment">/*</span>
<a name="l00331"></a>00331 <span class="comment">#define main_test_root main</span>
<a name="l00332"></a>00332 <span class="comment">#define TEST_CYCLES 1000</span>
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">int main_test_root (void)</span>
<a name="l00335"></a>00335 <span class="comment">{</span>
<a name="l00336"></a>00336 <span class="comment">        int i,j;</span>
<a name="l00337"></a>00337 <span class="comment">        long int time, startTime;</span>
<a name="l00338"></a>00338 <span class="comment">        printf(&quot;Testing quality...\n&quot;);</span>
<a name="l00339"></a>00339 <span class="comment">        int maxdiff = 0;</span>
<a name="l00340"></a>00340 <span class="comment">        double meandiff = 0;</span>
<a name="l00341"></a>00341 <span class="comment">        for (i = 1; i &lt; 0xFFFF; i++)</span>
<a name="l00342"></a>00342 <span class="comment">        {</span>
<a name="l00343"></a>00343 <span class="comment">                int res = getRootFast(i);</span>
<a name="l00344"></a>00344 <span class="comment">                double root = sqrt(i);</span>
<a name="l00345"></a>00345 <span class="comment">                int real = round(root);</span>
<a name="l00346"></a>00346 <span class="comment">                int diff = res &gt; real ? res - real : real - res;</span>
<a name="l00347"></a>00347 <span class="comment">                if (diff &gt; maxdiff)</span>
<a name="l00348"></a>00348 <span class="comment">                        maxdiff = diff;</span>
<a name="l00349"></a>00349 <span class="comment">                meandiff += diff;</span>
<a name="l00350"></a>00350 <span class="comment">                printf(&quot;%d &quot;, diff);</span>
<a name="l00351"></a>00351 <span class="comment">        }</span>
<a name="l00352"></a>00352 <span class="comment"></span>
<a name="l00353"></a>00353 <span class="comment">        meandiff /= 0xFFFF;</span>
<a name="l00354"></a>00354 <span class="comment"></span>
<a name="l00355"></a>00355 <span class="comment">        printf(&quot;Max diff %d mean = %lf\n&quot;, maxdiff, meandiff);</span>
<a name="l00356"></a>00356 <span class="comment"></span>
<a name="l00357"></a>00357 <span class="comment">        int saver = 1;</span>
<a name="l00358"></a>00358 <span class="comment">        printf(&quot;Speed test...\n&quot;);</span>
<a name="l00359"></a>00359 <span class="comment">        startTime = clock();</span>
<a name="l00360"></a>00360 <span class="comment">        for (j = 0; j &lt; TEST_CYCLES ; j++)</span>
<a name="l00361"></a>00361 <span class="comment">        {</span>
<a name="l00362"></a>00362 <span class="comment">                for (i = 1; i &lt; 0xFFFF - TEST_CYCLES; i++)</span>
<a name="l00363"></a>00363 <span class="comment">                {</span>
<a name="l00364"></a>00364 <span class="comment">                        int res = getRootFast(i+j);</span>
<a name="l00365"></a>00365 <span class="comment">                        saver += res;</span>
<a name="l00366"></a>00366 <span class="comment">                }</span>
<a name="l00367"></a>00367 <span class="comment">        }</span>
<a name="l00368"></a>00368 <span class="comment">        time = clock() - startTime;</span>
<a name="l00369"></a>00369 <span class="comment">        printf(&quot;Our version   : %d\n&quot;, time);</span>
<a name="l00370"></a>00370 <span class="comment"></span>
<a name="l00371"></a>00371 <span class="comment"></span>
<a name="l00372"></a>00372 <span class="comment"></span>
<a name="l00373"></a>00373 <span class="comment">        startTime = clock();</span>
<a name="l00374"></a>00374 <span class="comment">        for (j = 0; j &lt; TEST_CYCLES ; j++)</span>
<a name="l00375"></a>00375 <span class="comment">        {</span>
<a name="l00376"></a>00376 <span class="comment">                for (i = 1; i &lt; 0xFFFF - TEST_CYCLES; i++)</span>
<a name="l00377"></a>00377 <span class="comment">                {</span>
<a name="l00378"></a>00378 <span class="comment">                        double real = sqrt(i+j);</span>
<a name="l00379"></a>00379 <span class="comment">                        saver += real;</span>
<a name="l00380"></a>00380 <span class="comment">                }</span>
<a name="l00381"></a>00381 <span class="comment">        }</span>
<a name="l00382"></a>00382 <span class="comment">        time = clock() - startTime;</span>
<a name="l00383"></a>00383 <span class="comment">        printf(&quot;Double version: %d\n&quot;, time);</span>
<a name="l00384"></a>00384 <span class="comment"></span>
<a name="l00385"></a>00385 <span class="comment">        return saver &gt; 0 ? 1 : 0;</span>
<a name="l00386"></a>00386 <span class="comment">}</span>
<a name="l00387"></a>00387 <span class="comment">*/</span>
</pre></div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:36 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
