<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>DeepView: PLYLoader Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">DeepView
   &#160;<span id="projectnumber">0.02</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">PLYLoader Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="PLYLoader" -->
<p><code>#include &lt;<a class="el" href="plyLoader_8h_source.html">plyLoader.h</a>&gt;</code></p>

<p><a href="classPLYLoader-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPLYLoader.html#ab0bec8e3869c3c7b32eea0e212f0b89f">PLYLoader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPLYLoader.html#aa367a87873b96072922dcd5f6a2e5368">loadPLY</a> (istream &amp;input, <a class="el" href="classcorecvs_1_1Mesh3D.html">Mesh3D</a> &amp;mesh)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">format ascii 1.0 comment author: Greg Turk comment object: another cube element vertex 8 property float x property float y property float z property uchar red { start of vertex color } property uchar green property uchar blue element face 7 property list uchar int vertex_index { number of vertices for each face } element edge 5 { five edges in object } property int vertex1 { index to first vertex of edge } property int vertex2 { index to second vertex } property uchar red { start of edge color } property uchar green property uchar blue  <a href="#aa367a87873b96072922dcd5f6a2e5368"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPLYLoader.html#ac0bf6a480d7709e8185c479434688ea7">~PLYLoader</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="plyLoader_8h_source.html#l00018">18</a> of file <a class="el" href="plyLoader_8h_source.html">plyLoader.h</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ab0bec8e3869c3c7b32eea0e212f0b89f"></a><!-- doxytag: member="PLYLoader::PLYLoader" ref="ab0bec8e3869c3c7b32eea0e212f0b89f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPLYLoader.html#ab0bec8e3869c3c7b32eea0e212f0b89f">PLYLoader::PLYLoader</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="plyLoader_8cpp_source.html#l00011">11</a> of file <a class="el" href="plyLoader_8cpp_source.html">plyLoader.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac0bf6a480d7709e8185c479434688ea7"></a><!-- doxytag: member="PLYLoader::~PLYLoader" ref="ac0bf6a480d7709e8185c479434688ea7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classPLYLoader.html#ac0bf6a480d7709e8185c479434688ea7">PLYLoader::~PLYLoader</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="plyLoader_8cpp_source.html#l00245">245</a> of file <a class="el" href="plyLoader_8cpp_source.html">plyLoader.cpp</a>.</p>
<div class="fragment"><pre class="fragment">{
}
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aa367a87873b96072922dcd5f6a2e5368"></a><!-- doxytag: member="PLYLoader::loadPLY" ref="aa367a87873b96072922dcd5f6a2e5368" args="(istream &amp;input, Mesh3D &amp;mesh)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="classPLYLoader.html#aa367a87873b96072922dcd5f6a2e5368">PLYLoader::loadPLY</a> </td>
          <td>(</td>
          <td class="paramtype">istream &amp;&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classcorecvs_1_1Mesh3D.html">Mesh3D</a> &amp;&#160;</td>
          <td class="paramname"><em>mesh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>format ascii 1.0 comment author: Greg Turk comment object: another cube element vertex 8 property float x property float y property float z property uchar red { start of vertex color } property uchar green property uchar blue element face 7 property list uchar int vertex_index { number of vertices for each face } element edge 5 { five edges in object } property int vertex1 { index to first vertex of edge } property int vertex2 { index to second vertex } property uchar red { start of edge color } property uchar green property uchar blue </p>

<p>Definition at line <a class="el" href="plyLoader_8cpp_source.html#l00041">41</a> of file <a class="el" href="plyLoader_8cpp_source.html">plyLoader.cpp</a>.</p>

<p>References <a class="el" href="mesh3d_8h_source.html#l00113">corecvs::Mesh3D::faces</a>, <a class="el" href="vector3d_8h_source.html#l00162">corecvs::Vector3d&lt; ElementType &gt;::isInCube()</a>, <a class="el" href="global_8h_source.html#l00137">SYNC_PRINT</a>, <a class="el" href="mesh3d_8h_source.html#l00112">corecvs::Mesh3D::vertexes</a>, <a class="el" href="vector3d_8h_source.html#l00052">corecvs::Vector3d&lt; ElementType &gt;::x()</a>, <a class="el" href="vector3d_8h_source.html#l00057">corecvs::Vector3d&lt; ElementType &gt;::y()</a>, and <a class="el" href="vector3d_8h_source.html#l00062">corecvs::Vector3d&lt; ElementType &gt;::z()</a>.</p>

<p>Referenced by <a class="el" href="cloudViewDialog_8cpp_source.html#l00031">CloudViewDialog::CloudViewDialog()</a>, and <a class="el" href="cloudViewDialog_8cpp_source.html#l00733">CloudViewDialog::loadMesh()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordtype">char</span> line[300];
    input.getline(line, <span class="keyword">sizeof</span>(line) - 1);
    <span class="keywordflow">if</span> (strcmp(line, <span class="stringliteral">&quot;ply&quot;</span>) != 0) {
        <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Not a PLY file\n&quot;</span>));
        <span class="keywordflow">return</span> 1;
    }

    <span class="keyword">const</span> <span class="keywordtype">char</span> *com_format     = <span class="stringliteral">&quot;format&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *com_comment    = <span class="stringliteral">&quot;comment&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *com_element    = <span class="stringliteral">&quot;element&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *com_property   = <span class="stringliteral">&quot;property&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *com_end_header = <span class="stringliteral">&quot;end_header&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *form_ascii     = <span class="stringliteral">&quot;ascii&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *form_binaryle  = <span class="stringliteral">&quot;binary_little_endian&quot;</span>;



    <span class="keyword">const</span> <span class="keywordtype">char</span> *el_vertex = <span class="stringliteral">&quot;vertex&quot;</span>;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *el_face   = <span class="stringliteral">&quot;face&quot;</span>;

    <span class="keywordtype">int</span> vertex_number = -1;
    <span class="keywordtype">int</span> face_number = -1;

    <span class="keyword">enum</span> PlyFormat {
        ASCII,
        BINARY_LITTLE_ENDIAN,
        OTHER
    };

    PlyFormat plyFormat = OTHER;

    <span class="keywordflow">while</span> (!input.eof())
    {
        input.getline(line, <span class="keyword">sizeof</span>(line) - 1);
        <span class="keywordtype">char</span> *work = line;
        <span class="keywordflow">if</span> (strncmp(work, com_format, strlen(com_format)) == 0)
        {
            work += strlen(com_format);
            <span class="keywordflow">while</span>(*work == <span class="charliteral">&#39; &#39;</span> &amp;&amp; *work != 0) work++;
            <span class="keywordtype">char</span> *format = work;
            <span class="keywordflow">if</span> (strncmp(format, form_ascii, strlen(form_ascii)) == 0)
            {
                plyFormat = ASCII;
                <span class="comment">//SYNC_PRINT((&quot;PLY ascii format\n&quot;));</span>
                <span class="keywordflow">continue</span>;
            }

            <span class="keywordflow">if</span> (strncmp(format, form_binaryle, strlen(form_binaryle)) == 0)
            {
                plyFormat = BINARY_LITTLE_ENDIAN;
                <span class="comment">//SYNC_PRINT((&quot;PLY binary format\n&quot;));</span>
                <span class="keywordflow">continue</span>;
            }

            <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;PLY format not supported. Format here &lt;%s&gt;\n&quot;</span>, format));
            <span class="keywordflow">return</span> 1;
        }

        <span class="keywordflow">if</span> (strncmp(work, com_comment, strlen(com_comment)) == 0)
        {
            work += strlen(com_comment);
            <span class="comment">//printf(&quot;Skipping comment &lt;%s&gt;\n&quot;, work);</span>
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">if</span> (strncmp(work, com_property, strlen(com_property)) == 0)
        {
            work += strlen(com_property);

            <span class="keywordflow">while</span>(*work == <span class="charliteral">&#39; &#39;</span> &amp;&amp; *work != 0) work++;

            <span class="keywordflow">if</span> (strncmp(work, el_vertex, strlen(el_vertex)) == 0)
            {
               work += strlen(el_vertex);
               <span class="keywordflow">if</span> (sscanf(work, <span class="stringliteral">&quot;%d&quot;</span>, &amp;vertex_number) != 1) {
                   <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Vertex number is not found&quot;</span>));
                   <span class="keywordflow">continue</span>;
               }
               <span class="comment">//SYNC_PRINT((&quot;Vertex number %d&quot;, vertex_number));</span>
               <span class="keywordflow">continue</span>;
            }

            <span class="keywordflow">if</span> (strncmp(work, el_face, strlen(el_face)) == 0)
            {
               work += strlen(el_face);
               <span class="keywordflow">if</span> (sscanf(work, <span class="stringliteral">&quot;%d&quot;</span>, &amp;face_number) != 1) {
                   <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Face number is not found&quot;</span>));
                   <span class="keywordflow">continue</span>;
               }
               <span class="comment">//SYNC_PRINT((&quot;Face number %d&quot;, face_number));</span>
               <span class="keywordflow">continue</span>;
            }
            <span class="comment">//SYNC_PRINT((&quot;Found unsupported property &lt;%s&gt;\n&quot;, work));</span>
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">if</span> (strncmp(work, com_element, strlen(com_element)) == 0)
        {
            work += strlen(com_element);

            <span class="keywordflow">while</span>(*work == <span class="charliteral">&#39; &#39;</span> &amp;&amp; *work != 0) work++;

            <span class="keywordflow">if</span> (strncmp(work, el_vertex, strlen(el_vertex)) == 0)
            {
               work += strlen(el_vertex);
               <span class="keywordflow">if</span> (sscanf(work, <span class="stringliteral">&quot;%d&quot;</span>, &amp;vertex_number) != 1) {
                   <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Vertex number is not found&quot;</span>));
                   <span class="keywordflow">continue</span>;
               }
               <span class="comment">//SYNC_PRINT((&quot;Vertex number %d\n&quot;, vertex_number));</span>
               <span class="keywordflow">continue</span>;
            }

            <span class="keywordflow">if</span> (strncmp(work, el_face, strlen(el_face)) == 0)
            {
               work += strlen(el_face);
               <span class="keywordflow">if</span> (sscanf(work, <span class="stringliteral">&quot;%d&quot;</span>, &amp;face_number) != 1) {
                   <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Face number is not found&quot;</span>));
                   <span class="keywordflow">continue</span>;
               }
               <span class="comment">//SYNC_PRINT((&quot;Face number %d\n&quot;, face_number));</span>
               <span class="keywordflow">continue</span>;
            }
            printf(<span class="stringliteral">&quot;Found unsupported element &lt;%s&gt;\n&quot;</span>, work);
            <span class="keywordflow">continue</span>;
        }

        <span class="keywordflow">if</span> (strncmp(work, com_end_header, strlen(com_end_header)) == 0)
        {
            <span class="keywordflow">break</span>;
        }
    }

    <span class="keywordflow">if</span> (vertex_number == -1 || face_number == -1)
    {
        <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Necessary data was missing form the header\n&quot;</span>));
        <span class="keywordflow">return</span> 1;
    }

    <span class="keywordflow">if</span> (plyFormat == ASCII)
    {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vertex_number; i++)
        {
            input.getline(line, <span class="keyword">sizeof</span>(line) - 1);
            <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> vertex;
            <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">&quot;%lf %lf %lf&quot;</span>, &amp;(vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#aec83d9ad04107cd9c2bb11abf33128c0" title="Helper functions to access elements.">x</a>()), &amp;(vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#a940d88447f20fac800d1fa510c981275">y</a>()), &amp;(vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#a4587f5d4984576c5c4c2d44a4140ce3f">z</a>())) != 3) {
                <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Corrupted vertex %d &lt;%s&gt;\n&quot;</span>, i, line));
                <span class="keywordflow">return</span> 1;
            }
            mesh.<a class="code" href="classcorecvs_1_1Mesh3D.html#a347da546f5dddb328d7aa13a6f2d1a92">vertexes</a>.push_back(vertex);
        }

        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; face_number; i++)
        {
            input.getline(line, <span class="keyword">sizeof</span>(line) - 1);
            <span class="keywordtype">char</span> *work = line;
            <span class="keywordflow">while</span>(*work == <span class="charliteral">&#39; &#39;</span> &amp;&amp; *work != 0) work++;
            <span class="keywordtype">int</span> points;
            <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">&quot;%d&quot;</span>, &amp;points) != 1) {
                <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Corrupted face number %d\n&quot;</span>, i));
                <span class="keywordflow">return</span> 1;
            }
            <span class="keywordflow">if</span> (points != 3) {
                <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;We only support faces with 3 sides not %d\n&quot;</span>, points));
                <span class="keywordflow">continue</span>;
            }

            <span class="keywordflow">while</span>(*work != <span class="charliteral">&#39; &#39;</span> &amp;&amp; *work != 0) work++;
            <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3d32</a> face;

            <span class="keywordflow">if</span> (sscanf(work, <span class="stringliteral">&quot;%d %d %d&quot;</span>, &amp;(face.<a class="code" href="classcorecvs_1_1Vector3d.html#aec83d9ad04107cd9c2bb11abf33128c0" title="Helper functions to access elements.">x</a>()), &amp;(face.<a class="code" href="classcorecvs_1_1Vector3d.html#a940d88447f20fac800d1fa510c981275">y</a>()), &amp;(face.<a class="code" href="classcorecvs_1_1Vector3d.html#a4587f5d4984576c5c4c2d44a4140ce3f">z</a>())) != 3) {
                <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Corrupted face number %d\n&quot;</span>, i));
                <span class="keywordflow">return</span> 1;
            }

            <span class="keywordflow">if</span> (!face.<a class="code" href="classcorecvs_1_1Vector3d.html#a9d8a0d7866b1ead163ee33c5dac51a57">isInCube</a>(
                    <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3d32</a>(                0,                 0,                0),
                    <a class="code" href="namespacecorecvs.html#a41056366eafa7bc9b220dec6ad201d25">Vector3d32</a>(vertex_number - 1, vertex_number - 1, vertex_number - 1)))
            {
                <a class="code" href="global_8h.html#a49199ac38fc95393d7b14a6f0524e46d">SYNC_PRINT</a>((<span class="stringliteral">&quot;Vertex index is wrong on face %i\n&quot;</span>, i));
                <span class="keywordflow">return</span> 1;
            }
            <span class="comment">//printf(&quot;%d %d %d\n&quot;, face.x(), face.y(), face.z());</span>

            mesh.<a class="code" href="classcorecvs_1_1Mesh3D.html#a26b6c03c4f091b6bc9b19576483dfeb0">faces</a>.push_back(face);
        }
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; vertex_number; i++)
        {
            <span class="keywordtype">float</span> f;
            <a class="code" href="classcorecvs_1_1Vector3d.html">Vector3dd</a> vertex;
            input.read((<span class="keywordtype">char</span> *)&amp;f, <span class="keyword">sizeof</span>(f)); vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#aec83d9ad04107cd9c2bb11abf33128c0" title="Helper functions to access elements.">x</a>() = f;
            input.read((<span class="keywordtype">char</span> *)&amp;f, <span class="keyword">sizeof</span>(f)); vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#a940d88447f20fac800d1fa510c981275">y</a>() = f;
            input.read((<span class="keywordtype">char</span> *)&amp;f, <span class="keyword">sizeof</span>(f)); vertex.<a class="code" href="classcorecvs_1_1Vector3d.html#a4587f5d4984576c5c4c2d44a4140ce3f">z</a>() = f;
            mesh.<a class="code" href="classcorecvs_1_1Mesh3D.html#a347da546f5dddb328d7aa13a6f2d1a92">vertexes</a>.push_back(vertex);
        }
    }

    <span class="keywordflow">return</span> 0;
}
</pre></div>
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="classPLYLoader_aa367a87873b96072922dcd5f6a2e5368_cgraph.svg" width="400" height="200"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>core/fileformats/<a class="el" href="plyLoader_8h_source.html">plyLoader.h</a></li>
<li>core/fileformats/<a class="el" href="plyLoader_8cpp_source.html">plyLoader.cpp</a></li>
</ul>
</div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 12 2013 23:44:45 for DeepView by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
